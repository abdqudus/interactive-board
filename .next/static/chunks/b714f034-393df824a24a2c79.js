"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[463],{78155:function(e,t,i){let n,s,a,r;i.d(t,{Bl:function(){return U},GR:function(){return s6},Jq:function(){return e5},OX:function(){return nh},PP:function(){return ef},Uq:function(){return O},VJ:function(){return i3},_J:function(){return iM}}),i(95051);var o,l,c,d,h,u,p,g,m,f,y,b,v,k,w,T,C,S,R,E,I,D,_,P,N,U,A,O,L,B=i(17782),j=i(82044),F=i(55222),W=i(90505),V=i(2807),M=i(42741),x=i(29829),H=i(80735),z=i(7908),q=i(40376),K=i(12031),G=i(88137),$=i(97225),J=i(31379),Q=i(33627),X=i(53105),Y=i(45698),Z=i(99299),ee=i(81571),et=i(6216),ei=i(30025),en=i(74294),es=i(24451),ea=i(29612),er=i(78238),eo=i(37808),el=i(96141),ec=i(84655),ed=i(38227),eh=i(25049),eu=i(66554),ep=i(66337),eg=i(66033),em=i(49079);let ef={BLOCK_USERS:"block-users",CREATE_CALL:"create-call",CREATE_REACTION:"create-reaction",END_CALL:"end-call",JOIN_BACKSTAGE:"join-backstage",JOIN_CALL:"join-call",JOIN_ENDED_CALL:"join-ended-call",MUTE_USERS:"mute-users",PIN_FOR_EVERYONE:"pin-for-everyone",READ_CALL:"read-call",REMOVE_CALL_MEMBER:"remove-call-member",SCREENSHARE:"screenshare",SEND_AUDIO:"send-audio",SEND_VIDEO:"send-video",START_BROADCAST_CALL:"start-broadcast-call",START_RECORD_CALL:"start-record-call",START_TRANSCRIPTION_CALL:"start-transcription-call",STOP_BROADCAST_CALL:"stop-broadcast-call",STOP_RECORD_CALL:"stop-record-call",STOP_TRANSCRIPTION_CALL:"stop-transcription-call",UPDATE_CALL:"update-call",UPDATE_CALL_MEMBER:"update-call-member",UPDATE_CALL_PERMISSIONS:"update-call-permissions",UPDATE_CALL_SETTINGS:"update-call-settings"};class ey extends Error{}(o=T||(T={}))[o.NULL_VALUE=0]="NULL_VALUE";class eb extends B.C{internalJsonWrite(e,t){let i={};for(let[t,n]of Object.entries(e.fields))i[t]=ew.toJson(n);return i}internalJsonRead(e,t,i){if(!(0,j.b)(e))throw new globalThis.Error("Unable to parse message "+this.typeName+" from JSON "+(0,j.Z)(e)+".");for(let[t,n]of(i||(i=this.create()),globalThis.Object.entries(e)))i.fields[t]=ew.fromJson(n);return i}create(e){let t={fields:{}};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();if(1===t)this.binaryReadMap1(s.fields,e,i);else{let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}binaryReadMap1(e,t,i){let n=t.uint32(),s=t.pos+n,a,r;for(;t.pos<s;){let[e,n]=t.tag();switch(e){case 1:a=t.string();break;case 2:r=ew.internalBinaryRead(t,t.uint32(),i);break;default:throw new globalThis.Error("unknown map entry field for field google.protobuf.Struct.fields")}}e[null!=a?a:""]=null!=r?r:ew.create()}internalBinaryWrite(e,t,i){for(let n of Object.keys(e.fields))t.tag(1,V.TD.LengthDelimited).fork().tag(1,V.TD.LengthDelimited).string(n),t.tag(2,V.TD.LengthDelimited).fork(),ew.internalBinaryWrite(e.fields[n],t,i),t.join().join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("google.protobuf.Struct",[{no:1,name:"fields",kind:"map",K:9,V:{kind:"message",T:()=>ew}}])}}let ev=new eb;class ek extends B.C{internalJsonWrite(e,t){if(void 0===e.kind.oneofKind)throw new globalThis.Error;switch(e.kind.oneofKind){case void 0:throw new globalThis.Error;case"boolValue":return e.kind.boolValue;case"nullValue":return null;case"numberValue":return e.kind.numberValue;case"stringValue":return e.kind.stringValue;case"listValue":let i=this.fields.find(e=>6===e.no);if((null==i?void 0:i.kind)!=="message")throw new globalThis.Error;return i.T().toJson(e.kind.listValue);case"structValue":let n=this.fields.find(e=>5===e.no);if((null==n?void 0:n.kind)!=="message")throw new globalThis.Error;return n.T().toJson(e.kind.structValue)}}internalJsonRead(e,t,i){switch(i||(i=this.create()),typeof e){case"number":i.kind={oneofKind:"numberValue",numberValue:e};break;case"string":i.kind={oneofKind:"stringValue",stringValue:e};break;case"boolean":i.kind={oneofKind:"boolValue",boolValue:e};break;case"object":null===e?i.kind={oneofKind:"nullValue",nullValue:T.NULL_VALUE}:globalThis.Array.isArray(e)?i.kind={oneofKind:"listValue",listValue:eC.fromJson(e)}:i.kind={oneofKind:"structValue",structValue:ev.fromJson(e)};break;default:throw new globalThis.Error("Unable to parse "+this.typeName+" from JSON "+(0,j.Z)(e))}return i}create(e){let t={kind:{oneofKind:void 0}};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.kind={oneofKind:"nullValue",nullValue:e.int32()};break;case 2:s.kind={oneofKind:"numberValue",numberValue:e.double()};break;case 3:s.kind={oneofKind:"stringValue",stringValue:e.string()};break;case 4:s.kind={oneofKind:"boolValue",boolValue:e.bool()};break;case 5:s.kind={oneofKind:"structValue",structValue:ev.internalBinaryRead(e,e.uint32(),i,s.kind.structValue)};break;case 6:s.kind={oneofKind:"listValue",listValue:eC.internalBinaryRead(e,e.uint32(),i,s.kind.listValue)};break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){"nullValue"===e.kind.oneofKind&&t.tag(1,V.TD.Varint).int32(e.kind.nullValue),"numberValue"===e.kind.oneofKind&&t.tag(2,V.TD.Bit64).double(e.kind.numberValue),"stringValue"===e.kind.oneofKind&&t.tag(3,V.TD.LengthDelimited).string(e.kind.stringValue),"boolValue"===e.kind.oneofKind&&t.tag(4,V.TD.Varint).bool(e.kind.boolValue),"structValue"===e.kind.oneofKind&&ev.internalBinaryWrite(e.kind.structValue,t.tag(5,V.TD.LengthDelimited).fork(),i).join(),"listValue"===e.kind.oneofKind&&eC.internalBinaryWrite(e.kind.listValue,t.tag(6,V.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("google.protobuf.Value",[{no:1,name:"null_value",kind:"enum",oneof:"kind",T:()=>["google.protobuf.NullValue",T]},{no:2,name:"number_value",kind:"scalar",oneof:"kind",T:1},{no:3,name:"string_value",kind:"scalar",oneof:"kind",T:9},{no:4,name:"bool_value",kind:"scalar",oneof:"kind",T:8},{no:5,name:"struct_value",kind:"message",oneof:"kind",T:()=>ev},{no:6,name:"list_value",kind:"message",oneof:"kind",T:()=>eC}])}}let ew=new ek;class eT extends B.C{internalJsonWrite(e,t){return e.values.map(e=>ew.toJson(e))}internalJsonRead(e,t,i){if(!globalThis.Array.isArray(e))throw new globalThis.Error("Unable to parse "+this.typeName+" from JSON "+(0,j.Z)(e));i||(i=this.create());let n=e.map(e=>ew.fromJson(e));return i.values.push(...n),i}create(e){let t={values:[]};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();if(1===t)s.values.push(ew.internalBinaryRead(e,e.uint32(),i));else{let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){for(let n=0;n<e.values.length;n++)ew.internalBinaryWrite(e.values[n],t.tag(1,V.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("google.protobuf.ListValue",[{no:1,name:"values",kind:"message",repeat:1,T:()=>ew}])}}let eC=new eT;class eS extends B.C{now(){let e=this.create(),t=Date.now();return e.seconds=M.MJ.from(Math.floor(t/1e3)).toString(),e.nanos=t%1e3*1e6,e}toDate(e){return new Date(1e3*M.MJ.from(e.seconds).toNumber()+Math.ceil(e.nanos/1e6))}fromDate(e){let t=this.create(),i=e.getTime();return t.seconds=M.MJ.from(Math.floor(i/1e3)).toString(),t.nanos=i%1e3*1e6,t}internalJsonWrite(e,t){let i=1e3*M.MJ.from(e.seconds).toNumber();if(i<Date.parse("0001-01-01T00:00:00Z")||i>Date.parse("9999-12-31T23:59:59Z"))throw Error("Unable to encode Timestamp to JSON. Must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive.");if(e.nanos<0)throw Error("Unable to encode invalid Timestamp to JSON. Nanos must not be negative.");let n="Z";if(e.nanos>0){let t=(e.nanos+1e9).toString().substring(1);n="000000"===t.substring(3)?"."+t.substring(0,3)+"Z":"000"===t.substring(6)?"."+t.substring(0,6)+"Z":"."+t+"Z"}return new Date(i).toISOString().replace(".000Z",n)}internalJsonRead(e,t,i){if("string"!=typeof e)throw Error("Unable to parse Timestamp from JSON "+(0,j.Z)(e)+".");let n=e.match(/^([0-9]{4})-([0-9]{2})-([0-9]{2})T([0-9]{2}):([0-9]{2}):([0-9]{2})(?:Z|\.([0-9]{3,9})Z|([+-][0-9][0-9]:[0-9][0-9]))$/);if(!n)throw Error("Unable to parse Timestamp from JSON. Invalid format.");let s=Date.parse(n[1]+"-"+n[2]+"-"+n[3]+"T"+n[4]+":"+n[5]+":"+n[6]+(n[8]?n[8]:"Z"));if(Number.isNaN(s))throw Error("Unable to parse Timestamp from JSON. Invalid value.");if(s<Date.parse("0001-01-01T00:00:00Z")||s>Date.parse("9999-12-31T23:59:59Z"))throw new globalThis.Error("Unable to parse Timestamp from JSON. Must be from 0001-01-01T00:00:00Z to 9999-12-31T23:59:59Z inclusive.");return i||(i=this.create()),i.seconds=M.MJ.from(s/1e3).toString(),i.nanos=0,n[7]&&(i.nanos=parseInt("1"+n[7]+"0".repeat(9-n[7].length))-1e9),i}create(e){let t={seconds:"0",nanos:0};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.seconds=e.int64().toString();break;case 2:s.nanos=e.int32();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){"0"!==e.seconds&&t.tag(1,V.TD.Varint).int64(e.seconds),0!==e.nanos&&t.tag(2,V.TD.Varint).int32(e.nanos);let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("google.protobuf.Timestamp",[{no:1,name:"seconds",kind:"scalar",T:3},{no:2,name:"nanos",kind:"scalar",T:5}])}}let eR=new eS;(l=C||(C={}))[l.PUBLISHER_UNSPECIFIED=0]="PUBLISHER_UNSPECIFIED",l[l.SUBSCRIBER=1]="SUBSCRIBER",(c=S||(S={}))[c.UNSPECIFIED=0]="UNSPECIFIED",c[c.POOR=1]="POOR",c[c.GOOD=2]="GOOD",c[c.EXCELLENT=3]="EXCELLENT",(d=R||(R={}))[d.LOW_UNSPECIFIED=0]="LOW_UNSPECIFIED",d[d.MID=1]="MID",d[d.HIGH=2]="HIGH",d[d.OFF=3]="OFF",(h=E||(E={}))[h.UNSPECIFIED=0]="UNSPECIFIED",h[h.AUDIO=1]="AUDIO",h[h.VIDEO=2]="VIDEO",h[h.SCREEN_SHARE=3]="SCREEN_SHARE",h[h.SCREEN_SHARE_AUDIO=4]="SCREEN_SHARE_AUDIO",(u=I||(I={}))[u.UNSPECIFIED=0]="UNSPECIFIED",u[u.PUBLISH_TRACK_NOT_FOUND=100]="PUBLISH_TRACK_NOT_FOUND",u[u.PUBLISH_TRACKS_MISMATCH=101]="PUBLISH_TRACKS_MISMATCH",u[u.PUBLISH_TRACK_OUT_OF_ORDER=102]="PUBLISH_TRACK_OUT_OF_ORDER",u[u.PUBLISH_TRACK_VIDEO_LAYER_NOT_FOUND=103]="PUBLISH_TRACK_VIDEO_LAYER_NOT_FOUND",u[u.LIVE_ENDED=104]="LIVE_ENDED",u[u.PARTICIPANT_NOT_FOUND=200]="PARTICIPANT_NOT_FOUND",u[u.PARTICIPANT_MIGRATING_OUT=201]="PARTICIPANT_MIGRATING_OUT",u[u.PARTICIPANT_MIGRATION_FAILED=202]="PARTICIPANT_MIGRATION_FAILED",u[u.PARTICIPANT_MIGRATING=203]="PARTICIPANT_MIGRATING",u[u.PARTICIPANT_RECONNECT_FAILED=204]="PARTICIPANT_RECONNECT_FAILED",u[u.PARTICIPANT_MEDIA_TRANSPORT_FAILURE=205]="PARTICIPANT_MEDIA_TRANSPORT_FAILURE",u[u.CALL_NOT_FOUND=300]="CALL_NOT_FOUND",u[u.REQUEST_VALIDATION_FAILED=400]="REQUEST_VALIDATION_FAILED",u[u.UNAUTHENTICATED=401]="UNAUTHENTICATED",u[u.PERMISSION_DENIED=403]="PERMISSION_DENIED",u[u.TOO_MANY_REQUESTS=429]="TOO_MANY_REQUESTS",u[u.INTERNAL_SERVER_ERROR=500]="INTERNAL_SERVER_ERROR",u[u.SFU_SHUTTING_DOWN=600]="SFU_SHUTTING_DOWN",u[u.SFU_FULL=700]="SFU_FULL",(p=D||(D={}))[p.UNSPECIFIED=0]="UNSPECIFIED",p[p.REACT=1]="REACT",p[p.ANGULAR=2]="ANGULAR",p[p.ANDROID=3]="ANDROID",p[p.IOS=4]="IOS",p[p.FLUTTER=5]="FLUTTER",p[p.REACT_NATIVE=6]="REACT_NATIVE",p[p.UNITY=7]="UNITY",(g=_||(_={}))[g.UNSPECIFIED=0]="UNSPECIFIED",g[g.USER_MUTED=1]="USER_MUTED",g[g.PERMISSION_REVOKED=2]="PERMISSION_REVOKED",g[g.MODERATION=3]="MODERATION",(m=P||(P={}))[m.UNSPECIFIED=0]="UNSPECIFIED",m[m.SHUTTING_DOWN=1]="SHUTTING_DOWN",m[m.REBALANCE=2]="REBALANCE";class eE extends B.C{create(e){let t={participants:[],pins:[]};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.participants.push(eA.internalBinaryRead(e,e.uint32(),i));break;case 2:s.startedAt=eR.internalBinaryRead(e,e.uint32(),i,s.startedAt);break;case 3:s.participantCount=e_.internalBinaryRead(e,e.uint32(),i,s.participantCount);break;case 4:s.pins.push(eN.internalBinaryRead(e,e.uint32(),i));break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){for(let n=0;n<e.participants.length;n++)eA.internalBinaryWrite(e.participants[n],t.tag(1,V.TD.LengthDelimited).fork(),i).join();e.startedAt&&eR.internalBinaryWrite(e.startedAt,t.tag(2,V.TD.LengthDelimited).fork(),i).join(),e.participantCount&&e_.internalBinaryWrite(e.participantCount,t.tag(3,V.TD.LengthDelimited).fork(),i).join();for(let n=0;n<e.pins.length;n++)eN.internalBinaryWrite(e.pins[n],t.tag(4,V.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.models.CallState",[{no:1,name:"participants",kind:"message",repeat:1,T:()=>eA},{no:2,name:"started_at",kind:"message",T:()=>eR},{no:3,name:"participant_count",kind:"message",T:()=>e_},{no:4,name:"pins",kind:"message",repeat:1,T:()=>eN}])}}let eI=new eE;class eD extends B.C{create(e){let t={total:0,anonymous:0};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.total=e.uint32();break;case 2:s.anonymous=e.uint32();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){0!==e.total&&t.tag(1,V.TD.Varint).uint32(e.total),0!==e.anonymous&&t.tag(2,V.TD.Varint).uint32(e.anonymous);let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.models.ParticipantCount",[{no:1,name:"total",kind:"scalar",T:13},{no:2,name:"anonymous",kind:"scalar",T:13}])}}let e_=new eD;class eP extends B.C{create(e){let t={userId:"",sessionId:""};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.userId=e.string();break;case 2:s.sessionId=e.string();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){""!==e.userId&&t.tag(1,V.TD.LengthDelimited).string(e.userId),""!==e.sessionId&&t.tag(2,V.TD.LengthDelimited).string(e.sessionId);let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.models.Pin",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9}])}}let eN=new eP;class eU extends B.C{create(e){let t={userId:"",sessionId:"",publishedTracks:[],trackLookupPrefix:"",connectionQuality:0,isSpeaking:!1,isDominantSpeaker:!1,audioLevel:0,name:"",image:"",roles:[]};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.userId=e.string();break;case 2:s.sessionId=e.string();break;case 3:if(n===V.TD.LengthDelimited)for(let t=e.int32()+e.pos;e.pos<t;)s.publishedTracks.push(e.int32());else s.publishedTracks.push(e.int32());break;case 4:s.joinedAt=eR.internalBinaryRead(e,e.uint32(),i,s.joinedAt);break;case 5:s.trackLookupPrefix=e.string();break;case 6:s.connectionQuality=e.int32();break;case 7:s.isSpeaking=e.bool();break;case 8:s.isDominantSpeaker=e.bool();break;case 9:s.audioLevel=e.float();break;case 10:s.name=e.string();break;case 11:s.image=e.string();break;case 12:s.custom=ev.internalBinaryRead(e,e.uint32(),i,s.custom);break;case 13:s.roles.push(e.string());break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){if(""!==e.userId&&t.tag(1,V.TD.LengthDelimited).string(e.userId),""!==e.sessionId&&t.tag(2,V.TD.LengthDelimited).string(e.sessionId),e.publishedTracks.length){t.tag(3,V.TD.LengthDelimited).fork();for(let i=0;i<e.publishedTracks.length;i++)t.int32(e.publishedTracks[i]);t.join()}e.joinedAt&&eR.internalBinaryWrite(e.joinedAt,t.tag(4,V.TD.LengthDelimited).fork(),i).join(),""!==e.trackLookupPrefix&&t.tag(5,V.TD.LengthDelimited).string(e.trackLookupPrefix),0!==e.connectionQuality&&t.tag(6,V.TD.Varint).int32(e.connectionQuality),!1!==e.isSpeaking&&t.tag(7,V.TD.Varint).bool(e.isSpeaking),!1!==e.isDominantSpeaker&&t.tag(8,V.TD.Varint).bool(e.isDominantSpeaker),0!==e.audioLevel&&t.tag(9,V.TD.Bit32).float(e.audioLevel),""!==e.name&&t.tag(10,V.TD.LengthDelimited).string(e.name),""!==e.image&&t.tag(11,V.TD.LengthDelimited).string(e.image),e.custom&&ev.internalBinaryWrite(e.custom,t.tag(12,V.TD.LengthDelimited).fork(),i).join();for(let i=0;i<e.roles.length;i++)t.tag(13,V.TD.LengthDelimited).string(e.roles[i]);let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.models.Participant",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"published_tracks",kind:"enum",repeat:1,T:()=>["stream.video.sfu.models.TrackType",E,"TRACK_TYPE_"]},{no:4,name:"joined_at",kind:"message",T:()=>eR},{no:5,name:"track_lookup_prefix",kind:"scalar",T:9},{no:6,name:"connection_quality",kind:"enum",T:()=>["stream.video.sfu.models.ConnectionQuality",S,"CONNECTION_QUALITY_"]},{no:7,name:"is_speaking",kind:"scalar",T:8},{no:8,name:"is_dominant_speaker",kind:"scalar",T:8},{no:9,name:"audio_level",kind:"scalar",T:2},{no:10,name:"name",kind:"scalar",T:9},{no:11,name:"image",kind:"scalar",T:9},{no:12,name:"custom",kind:"message",T:()=>ev},{no:13,name:"roles",kind:"scalar",repeat:2,T:9}])}}let eA=new eU;class eO extends B.C{create(e){let t={videoQuality:0,userId:""};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.videoQuality=e.int32();break;case 2:s.userId=e.string();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){0!==e.videoQuality&&t.tag(1,V.TD.Varint).int32(e.videoQuality),""!==e.userId&&t.tag(2,V.TD.LengthDelimited).string(e.userId);let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.models.StreamQuality",[{no:1,name:"video_quality",kind:"enum",T:()=>["stream.video.sfu.models.VideoQuality",R,"VIDEO_QUALITY_"]},{no:2,name:"user_id",kind:"scalar",T:9}])}}let eL=new eO;class eB extends B.C{create(e){let t={width:0,height:0};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.width=e.uint32();break;case 2:s.height=e.uint32();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){0!==e.width&&t.tag(1,V.TD.Varint).uint32(e.width),0!==e.height&&t.tag(2,V.TD.Varint).uint32(e.height);let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.models.VideoDimension",[{no:1,name:"width",kind:"scalar",T:13},{no:2,name:"height",kind:"scalar",T:13}])}}let ej=new eB;class eF extends B.C{create(e){let t={rid:"",bitrate:0,fps:0,quality:0};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.rid=e.string();break;case 2:s.videoDimension=ej.internalBinaryRead(e,e.uint32(),i,s.videoDimension);break;case 4:s.bitrate=e.uint32();break;case 5:s.fps=e.uint32();break;case 6:s.quality=e.int32();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){""!==e.rid&&t.tag(1,V.TD.LengthDelimited).string(e.rid),e.videoDimension&&ej.internalBinaryWrite(e.videoDimension,t.tag(2,V.TD.LengthDelimited).fork(),i).join(),0!==e.bitrate&&t.tag(4,V.TD.Varint).uint32(e.bitrate),0!==e.fps&&t.tag(5,V.TD.Varint).uint32(e.fps),0!==e.quality&&t.tag(6,V.TD.Varint).int32(e.quality);let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.models.VideoLayer",[{no:1,name:"rid",kind:"scalar",T:9},{no:2,name:"video_dimension",kind:"message",T:()=>ej},{no:4,name:"bitrate",kind:"scalar",T:13},{no:5,name:"fps",kind:"scalar",T:13},{no:6,name:"quality",kind:"enum",T:()=>["stream.video.sfu.models.VideoQuality",R,"VIDEO_QUALITY_"]}])}}let eW=new eF;class eV extends B.C{create(e){let t={payloadType:0,name:"",fmtpLine:"",clockRate:0,encodingParameters:"",feedbacks:[]};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.payloadType=e.uint32();break;case 2:s.name=e.string();break;case 3:s.fmtpLine=e.string();break;case 4:s.clockRate=e.uint32();break;case 5:s.encodingParameters=e.string();break;case 6:s.feedbacks.push(e.string());break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){0!==e.payloadType&&t.tag(1,V.TD.Varint).uint32(e.payloadType),""!==e.name&&t.tag(2,V.TD.LengthDelimited).string(e.name),""!==e.fmtpLine&&t.tag(3,V.TD.LengthDelimited).string(e.fmtpLine),0!==e.clockRate&&t.tag(4,V.TD.Varint).uint32(e.clockRate),""!==e.encodingParameters&&t.tag(5,V.TD.LengthDelimited).string(e.encodingParameters);for(let i=0;i<e.feedbacks.length;i++)t.tag(6,V.TD.LengthDelimited).string(e.feedbacks[i]);let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.models.Codec",[{no:1,name:"payload_type",kind:"scalar",T:13},{no:2,name:"name",kind:"scalar",T:9},{no:3,name:"fmtp_line",kind:"scalar",T:9},{no:4,name:"clock_rate",kind:"scalar",T:13},{no:5,name:"encoding_parameters",kind:"scalar",T:9},{no:6,name:"feedbacks",kind:"scalar",repeat:2,T:9}])}}let eM=new eV,ex=new class extends B.C{create(e){let t={peerType:0,iceCandidate:"",sessionId:""};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.peerType=e.int32();break;case 2:s.iceCandidate=e.string();break;case 3:s.sessionId=e.string();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){0!==e.peerType&&t.tag(1,V.TD.Varint).int32(e.peerType),""!==e.iceCandidate&&t.tag(2,V.TD.LengthDelimited).string(e.iceCandidate),""!==e.sessionId&&t.tag(3,V.TD.LengthDelimited).string(e.sessionId);let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.models.ICETrickle",[{no:1,name:"peer_type",kind:"enum",T:()=>["stream.video.sfu.models.PeerType",C,"PEER_TYPE_"]},{no:2,name:"ice_candidate",kind:"scalar",T:9},{no:3,name:"session_id",kind:"scalar",T:9}])}};class eH extends B.C{create(e){let t={trackId:"",trackType:0,layers:[],mid:"",dtx:!1,stereo:!1,red:!1};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.trackId=e.string();break;case 2:s.trackType=e.int32();break;case 5:s.layers.push(eW.internalBinaryRead(e,e.uint32(),i));break;case 6:s.mid=e.string();break;case 7:s.dtx=e.bool();break;case 8:s.stereo=e.bool();break;case 9:s.red=e.bool();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){""!==e.trackId&&t.tag(1,V.TD.LengthDelimited).string(e.trackId),0!==e.trackType&&t.tag(2,V.TD.Varint).int32(e.trackType);for(let n=0;n<e.layers.length;n++)eW.internalBinaryWrite(e.layers[n],t.tag(5,V.TD.LengthDelimited).fork(),i).join();""!==e.mid&&t.tag(6,V.TD.LengthDelimited).string(e.mid),!1!==e.dtx&&t.tag(7,V.TD.Varint).bool(e.dtx),!1!==e.stereo&&t.tag(8,V.TD.Varint).bool(e.stereo),!1!==e.red&&t.tag(9,V.TD.Varint).bool(e.red);let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.models.TrackInfo",[{no:1,name:"track_id",kind:"scalar",T:9},{no:2,name:"track_type",kind:"enum",T:()=>["stream.video.sfu.models.TrackType",E,"TRACK_TYPE_"]},{no:5,name:"layers",kind:"message",repeat:1,T:()=>eW},{no:6,name:"mid",kind:"scalar",T:9},{no:7,name:"dtx",kind:"scalar",T:8},{no:8,name:"stereo",kind:"scalar",T:8},{no:9,name:"red",kind:"scalar",T:8}])}}let ez=new eH;class eq extends B.C{create(e){let t={type:"",id:"",createdByUserId:"",hostUserId:""};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.type=e.string();break;case 2:s.id=e.string();break;case 3:s.createdByUserId=e.string();break;case 4:s.hostUserId=e.string();break;case 5:s.custom=ev.internalBinaryRead(e,e.uint32(),i,s.custom);break;case 6:s.createdAt=eR.internalBinaryRead(e,e.uint32(),i,s.createdAt);break;case 7:s.updatedAt=eR.internalBinaryRead(e,e.uint32(),i,s.updatedAt);break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){""!==e.type&&t.tag(1,V.TD.LengthDelimited).string(e.type),""!==e.id&&t.tag(2,V.TD.LengthDelimited).string(e.id),""!==e.createdByUserId&&t.tag(3,V.TD.LengthDelimited).string(e.createdByUserId),""!==e.hostUserId&&t.tag(4,V.TD.LengthDelimited).string(e.hostUserId),e.custom&&ev.internalBinaryWrite(e.custom,t.tag(5,V.TD.LengthDelimited).fork(),i).join(),e.createdAt&&eR.internalBinaryWrite(e.createdAt,t.tag(6,V.TD.LengthDelimited).fork(),i).join(),e.updatedAt&&eR.internalBinaryWrite(e.updatedAt,t.tag(7,V.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.models.Call",[{no:1,name:"type",kind:"scalar",T:9},{no:2,name:"id",kind:"scalar",T:9},{no:3,name:"created_by_user_id",kind:"scalar",T:9},{no:4,name:"host_user_id",kind:"scalar",T:9},{no:5,name:"custom",kind:"message",T:()=>ev},{no:6,name:"created_at",kind:"message",T:()=>eR},{no:7,name:"updated_at",kind:"message",T:()=>eR}])}}let eK=new eq,eG=new class extends B.C{create(e){let t={code:0,message:"",shouldRetry:!1};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.code=e.int32();break;case 2:s.message=e.string();break;case 3:s.shouldRetry=e.bool();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){0!==e.code&&t.tag(1,V.TD.Varint).int32(e.code),""!==e.message&&t.tag(2,V.TD.LengthDelimited).string(e.message),!1!==e.shouldRetry&&t.tag(3,V.TD.Varint).bool(e.shouldRetry);let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.models.Error",[{no:1,name:"code",kind:"enum",T:()=>["stream.video.sfu.models.ErrorCode",I,"ERROR_CODE_"]},{no:2,name:"message",kind:"scalar",T:9},{no:3,name:"should_retry",kind:"scalar",T:8}])}};class e$ extends B.C{create(e){let t={};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.sdk=eX.internalBinaryRead(e,e.uint32(),i,s.sdk);break;case 2:s.os=eZ.internalBinaryRead(e,e.uint32(),i,s.os);break;case 3:s.browser=e1.internalBinaryRead(e,e.uint32(),i,s.browser);break;case 4:s.device=e3.internalBinaryRead(e,e.uint32(),i,s.device);break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){e.sdk&&eX.internalBinaryWrite(e.sdk,t.tag(1,V.TD.LengthDelimited).fork(),i).join(),e.os&&eZ.internalBinaryWrite(e.os,t.tag(2,V.TD.LengthDelimited).fork(),i).join(),e.browser&&e1.internalBinaryWrite(e.browser,t.tag(3,V.TD.LengthDelimited).fork(),i).join(),e.device&&e3.internalBinaryWrite(e.device,t.tag(4,V.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.models.ClientDetails",[{no:1,name:"sdk",kind:"message",T:()=>eX},{no:2,name:"os",kind:"message",T:()=>eZ},{no:3,name:"browser",kind:"message",T:()=>e1},{no:4,name:"device",kind:"message",T:()=>e3}])}}let eJ=new e$;class eQ extends B.C{create(e){let t={type:0,major:"",minor:"",patch:""};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.type=e.int32();break;case 2:s.major=e.string();break;case 3:s.minor=e.string();break;case 4:s.patch=e.string();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){0!==e.type&&t.tag(1,V.TD.Varint).int32(e.type),""!==e.major&&t.tag(2,V.TD.LengthDelimited).string(e.major),""!==e.minor&&t.tag(3,V.TD.LengthDelimited).string(e.minor),""!==e.patch&&t.tag(4,V.TD.LengthDelimited).string(e.patch);let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.models.Sdk",[{no:1,name:"type",kind:"enum",T:()=>["stream.video.sfu.models.SdkType",D,"SDK_TYPE_"]},{no:2,name:"major",kind:"scalar",T:9},{no:3,name:"minor",kind:"scalar",T:9},{no:4,name:"patch",kind:"scalar",T:9}])}}let eX=new eQ;class eY extends B.C{create(e){let t={name:"",version:"",architecture:""};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.name=e.string();break;case 2:s.version=e.string();break;case 3:s.architecture=e.string();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){""!==e.name&&t.tag(1,V.TD.LengthDelimited).string(e.name),""!==e.version&&t.tag(2,V.TD.LengthDelimited).string(e.version),""!==e.architecture&&t.tag(3,V.TD.LengthDelimited).string(e.architecture);let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.models.OS",[{no:1,name:"name",kind:"scalar",T:9},{no:2,name:"version",kind:"scalar",T:9},{no:3,name:"architecture",kind:"scalar",T:9}])}}let eZ=new eY;class e0 extends B.C{create(e){let t={name:"",version:""};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.name=e.string();break;case 2:s.version=e.string();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){""!==e.name&&t.tag(1,V.TD.LengthDelimited).string(e.name),""!==e.version&&t.tag(2,V.TD.LengthDelimited).string(e.version);let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.models.Browser",[{no:1,name:"name",kind:"scalar",T:9},{no:2,name:"version",kind:"scalar",T:9}])}}let e1=new e0;class e2 extends B.C{create(e){let t={name:"",version:""};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.name=e.string();break;case 2:s.version=e.string();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){""!==e.name&&t.tag(1,V.TD.LengthDelimited).string(e.name),""!==e.version&&t.tag(2,V.TD.LengthDelimited).string(e.version);let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.models.Device",[{no:1,name:"name",kind:"scalar",T:9},{no:2,name:"version",kind:"scalar",T:9}])}}let e3=new e2;class e9 extends B.C{create(e){let t={canPublishAudio:!1,canPublishVideo:!1,canScreenshare:!1};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.canPublishAudio=e.bool();break;case 2:s.canPublishVideo=e.bool();break;case 3:s.canScreenshare=e.bool();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){!1!==e.canPublishAudio&&t.tag(1,V.TD.Varint).bool(e.canPublishAudio),!1!==e.canPublishVideo&&t.tag(2,V.TD.Varint).bool(e.canPublishVideo),!1!==e.canScreenshare&&t.tag(3,V.TD.Varint).bool(e.canScreenshare);let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.models.CallGrants",[{no:1,name:"can_publish_audio",kind:"scalar",T:8},{no:2,name:"can_publish_video",kind:"scalar",T:8},{no:3,name:"can_screenshare",kind:"scalar",T:8}])}}let e4=new e9;var e5=Object.freeze({__proto__:null,Browser:e1,Call:eK,CallGrants:e4,CallState:eI,ClientDetails:eJ,Codec:eM,get ConnectionQuality(){return S},Device:e3,Error:eG,get ErrorCode(){return I},get GoAwayReason(){return P},ICETrickle:ex,OS:eZ,Participant:eA,ParticipantCount:e_,get PeerType(){return C},Pin:eN,Sdk:eX,get SdkType(){return D},StreamQuality:eL,TrackInfo:ez,get TrackType(){return E},get TrackUnpublishReason(){return _},VideoDimension:ej,VideoLayer:eW,get VideoQuality(){return R}});class e6 extends B.C{create(e){let t={sessionId:"",peerType:0};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.sessionId=e.string();break;case 2:s.peerType=e.int32();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){""!==e.sessionId&&t.tag(1,V.TD.LengthDelimited).string(e.sessionId),0!==e.peerType&&t.tag(2,V.TD.Varint).int32(e.peerType);let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.signal.ICERestartRequest",[{no:1,name:"session_id",kind:"scalar",T:9},{no:2,name:"peer_type",kind:"enum",T:()=>["stream.video.sfu.models.PeerType",C,"PEER_TYPE_"]}])}}let e8=new e6;class e7 extends B.C{create(e){let t={};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();if(1===t)s.error=eG.internalBinaryRead(e,e.uint32(),i,s.error);else{let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){e.error&&eG.internalBinaryWrite(e.error,t.tag(1,V.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.signal.ICERestartResponse",[{no:1,name:"error",kind:"message",T:()=>eG}])}}let te=new e7;class tt extends B.C{create(e){let t={sessionId:"",muteStates:[]};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.sessionId=e.string();break;case 3:s.muteStates.push(tr.internalBinaryRead(e,e.uint32(),i));break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){""!==e.sessionId&&t.tag(1,V.TD.LengthDelimited).string(e.sessionId);for(let n=0;n<e.muteStates.length;n++)tr.internalBinaryWrite(e.muteStates[n],t.tag(3,V.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.signal.UpdateMuteStatesRequest",[{no:1,name:"session_id",kind:"scalar",T:9},{no:3,name:"mute_states",kind:"message",repeat:1,T:()=>tr}])}}let ti=new tt;class tn extends B.C{create(e){let t={};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();if(4===t)s.error=eG.internalBinaryRead(e,e.uint32(),i,s.error);else{let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){e.error&&eG.internalBinaryWrite(e.error,t.tag(4,V.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.signal.UpdateMuteStatesResponse",[{no:4,name:"error",kind:"message",T:()=>eG}])}}let ts=new tn;class ta extends B.C{create(e){let t={trackType:0,muted:!1};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.trackType=e.int32();break;case 2:s.muted=e.bool();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){0!==e.trackType&&t.tag(1,V.TD.Varint).int32(e.trackType),!1!==e.muted&&t.tag(2,V.TD.Varint).bool(e.muted);let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.signal.TrackMuteState",[{no:1,name:"track_type",kind:"enum",T:()=>["stream.video.sfu.models.TrackType",E,"TRACK_TYPE_"]},{no:2,name:"muted",kind:"scalar",T:8}])}}let tr=new ta;class to extends B.C{create(e){let t={muted:!1};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();if(1===t)s.muted=e.bool();else{let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){!1!==e.muted&&t.tag(1,V.TD.Varint).bool(e.muted);let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.signal.AudioMuteChanged",[{no:1,name:"muted",kind:"scalar",T:8}])}}new to;class tl extends B.C{create(e){let t={muted:!1};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();if(2===t)s.muted=e.bool();else{let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){!1!==e.muted&&t.tag(2,V.TD.Varint).bool(e.muted);let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.signal.VideoMuteChanged",[{no:2,name:"muted",kind:"scalar",T:8}])}}new tl;class tc extends B.C{create(e){let t={sessionId:"",tracks:[]};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 2:s.sessionId=e.string();break;case 3:s.tracks.push(tg.internalBinaryRead(e,e.uint32(),i));break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){""!==e.sessionId&&t.tag(2,V.TD.LengthDelimited).string(e.sessionId);for(let n=0;n<e.tracks.length;n++)tg.internalBinaryWrite(e.tracks[n],t.tag(3,V.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.signal.UpdateSubscriptionsRequest",[{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"tracks",kind:"message",repeat:1,T:()=>tg}])}}let td=new tc;class th extends B.C{create(e){let t={};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();if(4===t)s.error=eG.internalBinaryRead(e,e.uint32(),i,s.error);else{let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){e.error&&eG.internalBinaryWrite(e.error,t.tag(4,V.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.signal.UpdateSubscriptionsResponse",[{no:4,name:"error",kind:"message",T:()=>eG}])}}let tu=new th;class tp extends B.C{create(e){let t={userId:"",sessionId:"",trackType:0};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.userId=e.string();break;case 2:s.sessionId=e.string();break;case 3:s.trackType=e.int32();break;case 4:s.dimension=ej.internalBinaryRead(e,e.uint32(),i,s.dimension);break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){""!==e.userId&&t.tag(1,V.TD.LengthDelimited).string(e.userId),""!==e.sessionId&&t.tag(2,V.TD.LengthDelimited).string(e.sessionId),0!==e.trackType&&t.tag(3,V.TD.Varint).int32(e.trackType),e.dimension&&ej.internalBinaryWrite(e.dimension,t.tag(4,V.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.signal.TrackSubscriptionDetails",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"track_type",kind:"enum",T:()=>["stream.video.sfu.models.TrackType",E,"TRACK_TYPE_"]},{no:4,name:"dimension",kind:"message",T:()=>ej}])}}let tg=new tp;class tm extends B.C{create(e){let t={peerType:0,sdp:"",sessionId:""};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.peerType=e.int32();break;case 2:s.sdp=e.string();break;case 3:s.sessionId=e.string();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){0!==e.peerType&&t.tag(1,V.TD.Varint).int32(e.peerType),""!==e.sdp&&t.tag(2,V.TD.LengthDelimited).string(e.sdp),""!==e.sessionId&&t.tag(3,V.TD.LengthDelimited).string(e.sessionId);let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.signal.SendAnswerRequest",[{no:1,name:"peer_type",kind:"enum",T:()=>["stream.video.sfu.models.PeerType",C,"PEER_TYPE_"]},{no:2,name:"sdp",kind:"scalar",T:9},{no:3,name:"session_id",kind:"scalar",T:9}])}}let tf=new tm;class ty extends B.C{create(e){let t={};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();if(4===t)s.error=eG.internalBinaryRead(e,e.uint32(),i,s.error);else{let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){e.error&&eG.internalBinaryWrite(e.error,t.tag(4,V.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.signal.SendAnswerResponse",[{no:4,name:"error",kind:"message",T:()=>eG}])}}let tb=new ty;class tv extends B.C{create(e){let t={};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();if(4===t)s.error=eG.internalBinaryRead(e,e.uint32(),i,s.error);else{let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){e.error&&eG.internalBinaryWrite(e.error,t.tag(4,V.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.signal.ICETrickleResponse",[{no:4,name:"error",kind:"message",T:()=>eG}])}}let tk=new tv;class tw extends B.C{create(e){let t={sdp:"",sessionId:"",tracks:[]};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.sdp=e.string();break;case 2:s.sessionId=e.string();break;case 3:s.tracks.push(ez.internalBinaryRead(e,e.uint32(),i));break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){""!==e.sdp&&t.tag(1,V.TD.LengthDelimited).string(e.sdp),""!==e.sessionId&&t.tag(2,V.TD.LengthDelimited).string(e.sessionId);for(let n=0;n<e.tracks.length;n++)ez.internalBinaryWrite(e.tracks[n],t.tag(3,V.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.signal.SetPublisherRequest",[{no:1,name:"sdp",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"tracks",kind:"message",repeat:1,T:()=>ez}])}}let tT=new tw;class tC extends B.C{create(e){let t={sdp:"",sessionId:"",iceRestart:!1};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.sdp=e.string();break;case 2:s.sessionId=e.string();break;case 3:s.iceRestart=e.bool();break;case 4:s.error=eG.internalBinaryRead(e,e.uint32(),i,s.error);break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){""!==e.sdp&&t.tag(1,V.TD.LengthDelimited).string(e.sdp),""!==e.sessionId&&t.tag(2,V.TD.LengthDelimited).string(e.sessionId),!1!==e.iceRestart&&t.tag(3,V.TD.Varint).bool(e.iceRestart),e.error&&eG.internalBinaryWrite(e.error,t.tag(4,V.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.signal.SetPublisherResponse",[{no:1,name:"sdp",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"ice_restart",kind:"scalar",T:8},{no:4,name:"error",kind:"message",T:()=>eG}])}}let tS=new tC,tR=new x.U("stream.video.sfu.signal.SignalServer",[{name:"SetPublisher",options:{},I:tT,O:tS},{name:"SendAnswer",options:{},I:tf,O:tb},{name:"IceTrickle",options:{},I:ex,O:tk},{name:"UpdateSubscriptions",options:{},I:td,O:tu},{name:"UpdateMuteStates",options:{},I:ti,O:ts},{name:"IceRestart",options:{},I:e8,O:te}]);(f=N||(N={}))[f.HIGH_UNSPECIFIED=0]="HIGH_UNSPECIFIED",f[f.LOW=1]="LOW",f[f.MEDIUM=2]="MEDIUM",f[f.VERY_LOW=3]="VERY_LOW";class tE extends B.C{create(e){let t={eventPayload:{oneofKind:void 0}};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.eventPayload={oneofKind:"subscriberOffer",subscriberOffer:t2.internalBinaryRead(e,e.uint32(),i,s.eventPayload.subscriberOffer)};break;case 2:s.eventPayload={oneofKind:"publisherAnswer",publisherAnswer:t9.internalBinaryRead(e,e.uint32(),i,s.eventPayload.publisherAnswer)};break;case 3:s.eventPayload={oneofKind:"connectionQualityChanged",connectionQualityChanged:t5.internalBinaryRead(e,e.uint32(),i,s.eventPayload.connectionQualityChanged)};break;case 4:s.eventPayload={oneofKind:"audioLevelChanged",audioLevelChanged:ia.internalBinaryRead(e,e.uint32(),i,s.eventPayload.audioLevelChanged)};break;case 5:s.eventPayload={oneofKind:"iceTrickle",iceTrickle:ex.internalBinaryRead(e,e.uint32(),i,s.eventPayload.iceTrickle)};break;case 6:s.eventPayload={oneofKind:"changePublishQuality",changePublishQuality:ib.internalBinaryRead(e,e.uint32(),i,s.eventPayload.changePublishQuality)};break;case 10:s.eventPayload={oneofKind:"participantJoined",participantJoined:tY.internalBinaryRead(e,e.uint32(),i,s.eventPayload.participantJoined)};break;case 11:s.eventPayload={oneofKind:"participantLeft",participantLeft:t0.internalBinaryRead(e,e.uint32(),i,s.eventPayload.participantLeft)};break;case 12:s.eventPayload={oneofKind:"dominantSpeakerChanged",dominantSpeakerChanged:ie.internalBinaryRead(e,e.uint32(),i,s.eventPayload.dominantSpeakerChanged)};break;case 13:s.eventPayload={oneofKind:"joinResponse",joinResponse:tQ.internalBinaryRead(e,e.uint32(),i,s.eventPayload.joinResponse)};break;case 14:s.eventPayload={oneofKind:"healthCheckResponse",healthCheckResponse:tV.internalBinaryRead(e,e.uint32(),i,s.eventPayload.healthCheckResponse)};break;case 16:s.eventPayload={oneofKind:"trackPublished",trackPublished:tx.internalBinaryRead(e,e.uint32(),i,s.eventPayload.trackPublished)};break;case 17:s.eventPayload={oneofKind:"trackUnpublished",trackUnpublished:tz.internalBinaryRead(e,e.uint32(),i,s.eventPayload.trackUnpublished)};break;case 18:s.eventPayload={oneofKind:"error",error:tN.internalBinaryRead(e,e.uint32(),i,s.eventPayload.error)};break;case 19:s.eventPayload={oneofKind:"callGrantsUpdated",callGrantsUpdated:ik.internalBinaryRead(e,e.uint32(),i,s.eventPayload.callGrantsUpdated)};break;case 20:s.eventPayload={oneofKind:"goAway",goAway:iT.internalBinaryRead(e,e.uint32(),i,s.eventPayload.goAway)};break;case 21:s.eventPayload={oneofKind:"iceRestart",iceRestart:tO.internalBinaryRead(e,e.uint32(),i,s.eventPayload.iceRestart)};break;case 22:s.eventPayload={oneofKind:"pinsUpdated",pinsUpdated:t_.internalBinaryRead(e,e.uint32(),i,s.eventPayload.pinsUpdated)};break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){"subscriberOffer"===e.eventPayload.oneofKind&&t2.internalBinaryWrite(e.eventPayload.subscriberOffer,t.tag(1,V.TD.LengthDelimited).fork(),i).join(),"publisherAnswer"===e.eventPayload.oneofKind&&t9.internalBinaryWrite(e.eventPayload.publisherAnswer,t.tag(2,V.TD.LengthDelimited).fork(),i).join(),"connectionQualityChanged"===e.eventPayload.oneofKind&&t5.internalBinaryWrite(e.eventPayload.connectionQualityChanged,t.tag(3,V.TD.LengthDelimited).fork(),i).join(),"audioLevelChanged"===e.eventPayload.oneofKind&&ia.internalBinaryWrite(e.eventPayload.audioLevelChanged,t.tag(4,V.TD.LengthDelimited).fork(),i).join(),"iceTrickle"===e.eventPayload.oneofKind&&ex.internalBinaryWrite(e.eventPayload.iceTrickle,t.tag(5,V.TD.LengthDelimited).fork(),i).join(),"changePublishQuality"===e.eventPayload.oneofKind&&ib.internalBinaryWrite(e.eventPayload.changePublishQuality,t.tag(6,V.TD.LengthDelimited).fork(),i).join(),"participantJoined"===e.eventPayload.oneofKind&&tY.internalBinaryWrite(e.eventPayload.participantJoined,t.tag(10,V.TD.LengthDelimited).fork(),i).join(),"participantLeft"===e.eventPayload.oneofKind&&t0.internalBinaryWrite(e.eventPayload.participantLeft,t.tag(11,V.TD.LengthDelimited).fork(),i).join(),"dominantSpeakerChanged"===e.eventPayload.oneofKind&&ie.internalBinaryWrite(e.eventPayload.dominantSpeakerChanged,t.tag(12,V.TD.LengthDelimited).fork(),i).join(),"joinResponse"===e.eventPayload.oneofKind&&tQ.internalBinaryWrite(e.eventPayload.joinResponse,t.tag(13,V.TD.LengthDelimited).fork(),i).join(),"healthCheckResponse"===e.eventPayload.oneofKind&&tV.internalBinaryWrite(e.eventPayload.healthCheckResponse,t.tag(14,V.TD.LengthDelimited).fork(),i).join(),"trackPublished"===e.eventPayload.oneofKind&&tx.internalBinaryWrite(e.eventPayload.trackPublished,t.tag(16,V.TD.LengthDelimited).fork(),i).join(),"trackUnpublished"===e.eventPayload.oneofKind&&tz.internalBinaryWrite(e.eventPayload.trackUnpublished,t.tag(17,V.TD.LengthDelimited).fork(),i).join(),"error"===e.eventPayload.oneofKind&&tN.internalBinaryWrite(e.eventPayload.error,t.tag(18,V.TD.LengthDelimited).fork(),i).join(),"callGrantsUpdated"===e.eventPayload.oneofKind&&ik.internalBinaryWrite(e.eventPayload.callGrantsUpdated,t.tag(19,V.TD.LengthDelimited).fork(),i).join(),"goAway"===e.eventPayload.oneofKind&&iT.internalBinaryWrite(e.eventPayload.goAway,t.tag(20,V.TD.LengthDelimited).fork(),i).join(),"iceRestart"===e.eventPayload.oneofKind&&tO.internalBinaryWrite(e.eventPayload.iceRestart,t.tag(21,V.TD.LengthDelimited).fork(),i).join(),"pinsUpdated"===e.eventPayload.oneofKind&&t_.internalBinaryWrite(e.eventPayload.pinsUpdated,t.tag(22,V.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.SfuEvent",[{no:1,name:"subscriber_offer",kind:"message",oneof:"eventPayload",T:()=>t2},{no:2,name:"publisher_answer",kind:"message",oneof:"eventPayload",T:()=>t9},{no:3,name:"connection_quality_changed",kind:"message",oneof:"eventPayload",T:()=>t5},{no:4,name:"audio_level_changed",kind:"message",oneof:"eventPayload",T:()=>ia},{no:5,name:"ice_trickle",kind:"message",oneof:"eventPayload",T:()=>ex},{no:6,name:"change_publish_quality",kind:"message",oneof:"eventPayload",T:()=>ib},{no:10,name:"participant_joined",kind:"message",oneof:"eventPayload",T:()=>tY},{no:11,name:"participant_left",kind:"message",oneof:"eventPayload",T:()=>t0},{no:12,name:"dominant_speaker_changed",kind:"message",oneof:"eventPayload",T:()=>ie},{no:13,name:"join_response",kind:"message",oneof:"eventPayload",T:()=>tQ},{no:14,name:"health_check_response",kind:"message",oneof:"eventPayload",T:()=>tV},{no:16,name:"track_published",kind:"message",oneof:"eventPayload",T:()=>tx},{no:17,name:"track_unpublished",kind:"message",oneof:"eventPayload",T:()=>tz},{no:18,name:"error",kind:"message",oneof:"eventPayload",T:()=>tN},{no:19,name:"call_grants_updated",kind:"message",oneof:"eventPayload",T:()=>ik},{no:20,name:"go_away",kind:"message",oneof:"eventPayload",T:()=>iT},{no:21,name:"ice_restart",kind:"message",oneof:"eventPayload",T:()=>tO},{no:22,name:"pins_updated",kind:"message",oneof:"eventPayload",T:()=>t_}])}}let tI=new tE;class tD extends B.C{create(e){let t={pins:[]};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();if(1===t)s.pins.push(eN.internalBinaryRead(e,e.uint32(),i));else{let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){for(let n=0;n<e.pins.length;n++)eN.internalBinaryWrite(e.pins[n],t.tag(1,V.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.PinsChanged",[{no:1,name:"pins",kind:"message",repeat:1,T:()=>eN}])}}let t_=new tD;class tP extends B.C{create(e){let t={};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();if(4===t)s.error=eG.internalBinaryRead(e,e.uint32(),i,s.error);else{let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){e.error&&eG.internalBinaryWrite(e.error,t.tag(4,V.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.Error",[{no:4,name:"error",kind:"message",T:()=>eG}])}}let tN=new tP;class tU extends B.C{create(e){let t={peerType:0,iceCandidate:""};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.peerType=e.int32();break;case 2:s.iceCandidate=e.string();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){0!==e.peerType&&t.tag(1,V.TD.Varint).int32(e.peerType),""!==e.iceCandidate&&t.tag(2,V.TD.LengthDelimited).string(e.iceCandidate);let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.ICETrickle",[{no:1,name:"peer_type",kind:"enum",T:()=>["stream.video.sfu.models.PeerType",C,"PEER_TYPE_"]},{no:2,name:"ice_candidate",kind:"scalar",T:9}])}}new tU;class tA extends B.C{create(e){let t={peerType:0};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();if(1===t)s.peerType=e.int32();else{let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){0!==e.peerType&&t.tag(1,V.TD.Varint).int32(e.peerType);let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.ICERestart",[{no:1,name:"peer_type",kind:"enum",T:()=>["stream.video.sfu.models.PeerType",C,"PEER_TYPE_"]}])}}let tO=new tA;class tL extends B.C{create(e){let t={requestPayload:{oneofKind:void 0}};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.requestPayload={oneofKind:"joinRequest",joinRequest:tK.internalBinaryRead(e,e.uint32(),i,s.requestPayload.joinRequest)};break;case 2:s.requestPayload={oneofKind:"healthCheckRequest",healthCheckRequest:tF.internalBinaryRead(e,e.uint32(),i,s.requestPayload.healthCheckRequest)};break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){"joinRequest"===e.requestPayload.oneofKind&&tK.internalBinaryWrite(e.requestPayload.joinRequest,t.tag(1,V.TD.LengthDelimited).fork(),i).join(),"healthCheckRequest"===e.requestPayload.oneofKind&&tF.internalBinaryWrite(e.requestPayload.healthCheckRequest,t.tag(2,V.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.SfuRequest",[{no:1,name:"join_request",kind:"message",oneof:"requestPayload",T:()=>tK},{no:2,name:"health_check_request",kind:"message",oneof:"requestPayload",T:()=>tF}])}}let tB=new tL;class tj extends B.C{create(e){let t={};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){return null!=n?n:this.create()}internalBinaryWrite(e,t,i){let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.HealthCheckRequest",[])}}let tF=new tj;class tW extends B.C{create(e){let t={};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();if(1===t)s.participantCount=e_.internalBinaryRead(e,e.uint32(),i,s.participantCount);else{let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){e.participantCount&&e_.internalBinaryWrite(e.participantCount,t.tag(1,V.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.HealthCheckResponse",[{no:1,name:"participant_count",kind:"message",T:()=>e_}])}}let tV=new tW;class tM extends B.C{create(e){let t={userId:"",sessionId:"",type:0};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.userId=e.string();break;case 2:s.sessionId=e.string();break;case 3:s.type=e.int32();break;case 4:s.participant=eA.internalBinaryRead(e,e.uint32(),i,s.participant);break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){""!==e.userId&&t.tag(1,V.TD.LengthDelimited).string(e.userId),""!==e.sessionId&&t.tag(2,V.TD.LengthDelimited).string(e.sessionId),0!==e.type&&t.tag(3,V.TD.Varint).int32(e.type),e.participant&&eA.internalBinaryWrite(e.participant,t.tag(4,V.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.TrackPublished",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:()=>["stream.video.sfu.models.TrackType",E,"TRACK_TYPE_"]},{no:4,name:"participant",kind:"message",T:()=>eA}])}}let tx=new tM;class tH extends B.C{create(e){let t={userId:"",sessionId:"",type:0,cause:0};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.userId=e.string();break;case 2:s.sessionId=e.string();break;case 3:s.type=e.int32();break;case 4:s.cause=e.int32();break;case 5:s.participant=eA.internalBinaryRead(e,e.uint32(),i,s.participant);break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){""!==e.userId&&t.tag(1,V.TD.LengthDelimited).string(e.userId),""!==e.sessionId&&t.tag(2,V.TD.LengthDelimited).string(e.sessionId),0!==e.type&&t.tag(3,V.TD.Varint).int32(e.type),0!==e.cause&&t.tag(4,V.TD.Varint).int32(e.cause),e.participant&&eA.internalBinaryWrite(e.participant,t.tag(5,V.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.TrackUnpublished",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"type",kind:"enum",T:()=>["stream.video.sfu.models.TrackType",E,"TRACK_TYPE_"]},{no:4,name:"cause",kind:"enum",T:()=>["stream.video.sfu.models.TrackUnpublishReason",_,"TRACK_UNPUBLISH_REASON_"]},{no:5,name:"participant",kind:"message",T:()=>eA}])}}let tz=new tH;class tq extends B.C{create(e){let t={token:"",sessionId:"",subscriberSdp:"",fastReconnect:!1};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.token=e.string();break;case 2:s.sessionId=e.string();break;case 3:s.subscriberSdp=e.string();break;case 4:s.clientDetails=eJ.internalBinaryRead(e,e.uint32(),i,s.clientDetails);break;case 5:s.migration=t$.internalBinaryRead(e,e.uint32(),i,s.migration);break;case 6:s.fastReconnect=e.bool();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){""!==e.token&&t.tag(1,V.TD.LengthDelimited).string(e.token),""!==e.sessionId&&t.tag(2,V.TD.LengthDelimited).string(e.sessionId),""!==e.subscriberSdp&&t.tag(3,V.TD.LengthDelimited).string(e.subscriberSdp),e.clientDetails&&eJ.internalBinaryWrite(e.clientDetails,t.tag(4,V.TD.LengthDelimited).fork(),i).join(),e.migration&&t$.internalBinaryWrite(e.migration,t.tag(5,V.TD.LengthDelimited).fork(),i).join(),!1!==e.fastReconnect&&t.tag(6,V.TD.Varint).bool(e.fastReconnect);let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.JoinRequest",[{no:1,name:"token",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"subscriber_sdp",kind:"scalar",T:9},{no:4,name:"client_details",kind:"message",T:()=>eJ},{no:5,name:"migration",kind:"message",T:()=>t$},{no:6,name:"fast_reconnect",kind:"scalar",T:8}])}}let tK=new tq;class tG extends B.C{create(e){let t={fromSfuId:"",announcedTracks:[],subscriptions:[]};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.fromSfuId=e.string();break;case 2:s.announcedTracks.push(ez.internalBinaryRead(e,e.uint32(),i));break;case 3:s.subscriptions.push(tg.internalBinaryRead(e,e.uint32(),i));break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){""!==e.fromSfuId&&t.tag(1,V.TD.LengthDelimited).string(e.fromSfuId);for(let n=0;n<e.announcedTracks.length;n++)ez.internalBinaryWrite(e.announcedTracks[n],t.tag(2,V.TD.LengthDelimited).fork(),i).join();for(let n=0;n<e.subscriptions.length;n++)tg.internalBinaryWrite(e.subscriptions[n],t.tag(3,V.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.Migration",[{no:1,name:"from_sfu_id",kind:"scalar",T:9},{no:2,name:"announced_tracks",kind:"message",repeat:1,T:()=>ez},{no:3,name:"subscriptions",kind:"message",repeat:1,T:()=>tg}])}}let t$=new tG;class tJ extends B.C{create(e){let t={reconnected:!1};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.callState=eI.internalBinaryRead(e,e.uint32(),i,s.callState);break;case 2:s.reconnected=e.bool();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){e.callState&&eI.internalBinaryWrite(e.callState,t.tag(1,V.TD.LengthDelimited).fork(),i).join(),!1!==e.reconnected&&t.tag(2,V.TD.Varint).bool(e.reconnected);let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.JoinResponse",[{no:1,name:"call_state",kind:"message",T:()=>eI},{no:2,name:"reconnected",kind:"scalar",T:8}])}}let tQ=new tJ;class tX extends B.C{create(e){let t={callCid:""};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.callCid=e.string();break;case 2:s.participant=eA.internalBinaryRead(e,e.uint32(),i,s.participant);break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){""!==e.callCid&&t.tag(1,V.TD.LengthDelimited).string(e.callCid),e.participant&&eA.internalBinaryWrite(e.participant,t.tag(2,V.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.ParticipantJoined",[{no:1,name:"call_cid",kind:"scalar",T:9},{no:2,name:"participant",kind:"message",T:()=>eA}])}}let tY=new tX;class tZ extends B.C{create(e){let t={callCid:""};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.callCid=e.string();break;case 2:s.participant=eA.internalBinaryRead(e,e.uint32(),i,s.participant);break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){""!==e.callCid&&t.tag(1,V.TD.LengthDelimited).string(e.callCid),e.participant&&eA.internalBinaryWrite(e.participant,t.tag(2,V.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.ParticipantLeft",[{no:1,name:"call_cid",kind:"scalar",T:9},{no:2,name:"participant",kind:"message",T:()=>eA}])}}let t0=new tZ;class t1 extends B.C{create(e){let t={iceRestart:!1,sdp:""};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.iceRestart=e.bool();break;case 2:s.sdp=e.string();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){!1!==e.iceRestart&&t.tag(1,V.TD.Varint).bool(e.iceRestart),""!==e.sdp&&t.tag(2,V.TD.LengthDelimited).string(e.sdp);let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.SubscriberOffer",[{no:1,name:"ice_restart",kind:"scalar",T:8},{no:2,name:"sdp",kind:"scalar",T:9}])}}let t2=new t1;class t3 extends B.C{create(e){let t={sdp:""};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();if(1===t)s.sdp=e.string();else{let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){""!==e.sdp&&t.tag(1,V.TD.LengthDelimited).string(e.sdp);let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.PublisherAnswer",[{no:1,name:"sdp",kind:"scalar",T:9}])}}let t9=new t3;class t4 extends B.C{create(e){let t={connectionQualityUpdates:[]};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();if(1===t)s.connectionQualityUpdates.push(t8.internalBinaryRead(e,e.uint32(),i));else{let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){for(let n=0;n<e.connectionQualityUpdates.length;n++)t8.internalBinaryWrite(e.connectionQualityUpdates[n],t.tag(1,V.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.ConnectionQualityChanged",[{no:1,name:"connection_quality_updates",kind:"message",repeat:1,T:()=>t8}])}}let t5=new t4;class t6 extends B.C{create(e){let t={userId:"",sessionId:"",connectionQuality:0};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.userId=e.string();break;case 2:s.sessionId=e.string();break;case 3:s.connectionQuality=e.int32();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){""!==e.userId&&t.tag(1,V.TD.LengthDelimited).string(e.userId),""!==e.sessionId&&t.tag(2,V.TD.LengthDelimited).string(e.sessionId),0!==e.connectionQuality&&t.tag(3,V.TD.Varint).int32(e.connectionQuality);let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.ConnectionQualityInfo",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"connection_quality",kind:"enum",T:()=>["stream.video.sfu.models.ConnectionQuality",S,"CONNECTION_QUALITY_"]}])}}let t8=new t6;class t7 extends B.C{create(e){let t={userId:"",sessionId:""};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.userId=e.string();break;case 2:s.sessionId=e.string();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){""!==e.userId&&t.tag(1,V.TD.LengthDelimited).string(e.userId),""!==e.sessionId&&t.tag(2,V.TD.LengthDelimited).string(e.sessionId);let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.DominantSpeakerChanged",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9}])}}let ie=new t7;class it extends B.C{create(e){let t={userId:"",sessionId:"",level:0,isSpeaking:!1};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.userId=e.string();break;case 2:s.sessionId=e.string();break;case 3:s.level=e.float();break;case 4:s.isSpeaking=e.bool();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){""!==e.userId&&t.tag(1,V.TD.LengthDelimited).string(e.userId),""!==e.sessionId&&t.tag(2,V.TD.LengthDelimited).string(e.sessionId),0!==e.level&&t.tag(3,V.TD.Bit32).float(e.level),!1!==e.isSpeaking&&t.tag(4,V.TD.Varint).bool(e.isSpeaking);let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.AudioLevel",[{no:1,name:"user_id",kind:"scalar",T:9},{no:2,name:"session_id",kind:"scalar",T:9},{no:3,name:"level",kind:"scalar",T:2},{no:4,name:"is_speaking",kind:"scalar",T:8}])}}let ii=new it;class is extends B.C{create(e){let t={audioLevels:[]};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();if(1===t)s.audioLevels.push(ii.internalBinaryRead(e,e.uint32(),i));else{let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){for(let n=0;n<e.audioLevels.length;n++)ii.internalBinaryWrite(e.audioLevels[n],t.tag(1,V.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.AudioLevelChanged",[{no:1,name:"audio_levels",kind:"message",repeat:1,T:()=>ii}])}}let ia=new is;class ir extends B.C{create(e){let t={channelCount:0};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();if(1===t)s.channelCount=e.int32();else{let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){0!==e.channelCount&&t.tag(1,V.TD.Varint).int32(e.channelCount);let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.AudioMediaRequest",[{no:1,name:"channel_count",kind:"scalar",T:5}])}}let io=new ir;class il extends B.C{create(e){let t={};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.mediaRequest=io.internalBinaryRead(e,e.uint32(),i,s.mediaRequest);break;case 2:s.codec=eM.internalBinaryRead(e,e.uint32(),i,s.codec);break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){e.mediaRequest&&io.internalBinaryWrite(e.mediaRequest,t.tag(1,V.TD.LengthDelimited).fork(),i).join(),e.codec&&eM.internalBinaryWrite(e.codec,t.tag(2,V.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.AudioSender",[{no:1,name:"media_request",kind:"message",T:()=>io},{no:2,name:"codec",kind:"message",T:()=>eM}])}}let ic=new il;class id extends B.C{create(e){let t={idealHeight:0,idealWidth:0,idealFrameRate:0};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.idealHeight=e.int32();break;case 2:s.idealWidth=e.int32();break;case 3:s.idealFrameRate=e.int32();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){0!==e.idealHeight&&t.tag(1,V.TD.Varint).int32(e.idealHeight),0!==e.idealWidth&&t.tag(2,V.TD.Varint).int32(e.idealWidth),0!==e.idealFrameRate&&t.tag(3,V.TD.Varint).int32(e.idealFrameRate);let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.VideoMediaRequest",[{no:1,name:"ideal_height",kind:"scalar",T:5},{no:2,name:"ideal_width",kind:"scalar",T:5},{no:3,name:"ideal_frame_rate",kind:"scalar",T:5}])}}let ih=new id;class iu extends B.C{create(e){let t={name:"",active:!1,maxBitrate:0,scaleResolutionDownBy:0,priority:0,maxFramerate:0};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.name=e.string();break;case 2:s.active=e.bool();break;case 3:s.maxBitrate=e.int32();break;case 4:s.scaleResolutionDownBy=e.float();break;case 5:s.priority=e.int32();break;case 6:s.codec=eM.internalBinaryRead(e,e.uint32(),i,s.codec);break;case 7:s.maxFramerate=e.uint32();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){""!==e.name&&t.tag(1,V.TD.LengthDelimited).string(e.name),!1!==e.active&&t.tag(2,V.TD.Varint).bool(e.active),0!==e.maxBitrate&&t.tag(3,V.TD.Varint).int32(e.maxBitrate),0!==e.scaleResolutionDownBy&&t.tag(4,V.TD.Bit32).float(e.scaleResolutionDownBy),0!==e.priority&&t.tag(5,V.TD.Varint).int32(e.priority),e.codec&&eM.internalBinaryWrite(e.codec,t.tag(6,V.TD.LengthDelimited).fork(),i).join(),0!==e.maxFramerate&&t.tag(7,V.TD.Varint).uint32(e.maxFramerate);let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.VideoLayerSetting",[{no:1,name:"name",kind:"scalar",T:9},{no:2,name:"active",kind:"scalar",T:8},{no:3,name:"max_bitrate",kind:"scalar",T:5},{no:4,name:"scale_resolution_down_by",kind:"scalar",T:2},{no:5,name:"priority",kind:"enum",T:()=>["stream.video.sfu.event.VideoLayerSetting.Priority",N,"PRIORITY_"]},{no:6,name:"codec",kind:"message",T:()=>eM},{no:7,name:"max_framerate",kind:"scalar",T:13}])}}let ip=new iu;class ig extends B.C{create(e){let t={layers:[]};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.mediaRequest=ih.internalBinaryRead(e,e.uint32(),i,s.mediaRequest);break;case 2:s.codec=eM.internalBinaryRead(e,e.uint32(),i,s.codec);break;case 3:s.layers.push(ip.internalBinaryRead(e,e.uint32(),i));break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){e.mediaRequest&&ih.internalBinaryWrite(e.mediaRequest,t.tag(1,V.TD.LengthDelimited).fork(),i).join(),e.codec&&eM.internalBinaryWrite(e.codec,t.tag(2,V.TD.LengthDelimited).fork(),i).join();for(let n=0;n<e.layers.length;n++)ip.internalBinaryWrite(e.layers[n],t.tag(3,V.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.VideoSender",[{no:1,name:"media_request",kind:"message",T:()=>ih},{no:2,name:"codec",kind:"message",T:()=>eM},{no:3,name:"layers",kind:"message",repeat:1,T:()=>ip}])}}let im=new ig;class iy extends B.C{create(e){let t={audioSenders:[],videoSenders:[]};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.audioSenders.push(ic.internalBinaryRead(e,e.uint32(),i));break;case 2:s.videoSenders.push(im.internalBinaryRead(e,e.uint32(),i));break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){for(let n=0;n<e.audioSenders.length;n++)ic.internalBinaryWrite(e.audioSenders[n],t.tag(1,V.TD.LengthDelimited).fork(),i).join();for(let n=0;n<e.videoSenders.length;n++)im.internalBinaryWrite(e.videoSenders[n],t.tag(2,V.TD.LengthDelimited).fork(),i).join();let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.ChangePublishQuality",[{no:1,name:"audio_senders",kind:"message",repeat:1,T:()=>ic},{no:2,name:"video_senders",kind:"message",repeat:1,T:()=>im}])}}let ib=new iy;class iv extends B.C{create(e){let t={message:""};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();switch(t){case 1:s.currentGrants=e4.internalBinaryRead(e,e.uint32(),i,s.currentGrants);break;case 2:s.message=e.string();break;default:let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){e.currentGrants&&e4.internalBinaryWrite(e.currentGrants,t.tag(1,V.TD.LengthDelimited).fork(),i).join(),""!==e.message&&t.tag(2,V.TD.LengthDelimited).string(e.message);let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.CallGrantsUpdated",[{no:1,name:"current_grants",kind:"message",T:()=>e4},{no:2,name:"message",kind:"scalar",T:9}])}}let ik=new iv;class iw extends B.C{create(e){let t={reason:0};return globalThis.Object.defineProperty(t,F.C,{enumerable:!1,value:this}),void 0!==e&&(0,W.l)(this,t,e),t}internalBinaryRead(e,t,i,n){let s=null!=n?n:this.create(),a=e.pos+t;for(;e.pos<a;){let[t,n]=e.tag();if(1===t)s.reason=e.int32();else{let a=i.readUnknownField;if("throw"===a)throw new globalThis.Error("Unknown field ".concat(t," (wire type ").concat(n,") for ").concat(this.typeName));let r=e.skip(n);!1!==a&&(!0===a?V.z.onRead:a)(this.typeName,s,t,n,r)}}return s}internalBinaryWrite(e,t,i){0!==e.reason&&t.tag(1,V.TD.Varint).int32(e.reason);let n=i.writeUnknownFields;return!1!==n&&(!0==n?V.z.onWrite:n)(this.typeName,e,t),t}constructor(){super("stream.video.sfu.event.GoAway",[{no:1,name:"reason",kind:"enum",T:()=>["stream.video.sfu.models.GoAwayReason",P,"GO_AWAY_REASON_"]}])}}let iT=new iw;(y=U||(U={})).UNKNOWN="UNKNOWN",y.VISIBLE="VISIBLE",y.INVISIBLE="INVISIBLE",(b=A||(A={}))[b.IMMEDIATE=20]="IMMEDIATE",b[b.FAST=100]="FAST",b[b.MEDIUM=600]="MEDIUM",b[b.SLOW=1200]="SLOW";class iC{setPublisher(e,t){let i=this.methods[0],n=this._transport.mergeOptions(t);return(0,H.xA)("unary",this._transport,i,n,e)}sendAnswer(e,t){let i=this.methods[1],n=this._transport.mergeOptions(t);return(0,H.xA)("unary",this._transport,i,n,e)}iceTrickle(e,t){let i=this.methods[2],n=this._transport.mergeOptions(t);return(0,H.xA)("unary",this._transport,i,n,e)}updateSubscriptions(e,t){let i=this.methods[3],n=this._transport.mergeOptions(t);return(0,H.xA)("unary",this._transport,i,n,e)}updateMuteStates(e,t){let i=this.methods[4],n=this._transport.mergeOptions(t);return(0,H.xA)("unary",this._transport,i,n,e)}iceRestart(e,t){let i=this.methods[5],n=this._transport.mergeOptions(t);return(0,H.xA)("unary",this._transport,i,n,e)}constructor(e){this._transport=e,this.typeName=tR.typeName,this.methods=tR.methods,this.options=tR.options}}let iS={baseUrl:"",sendJson:!0,timeout:5e3,jsonOptions:{ignoreUnknownFields:!0}},iR=e=>({interceptUnary:(t,i,n,s)=>(s.meta={...s.meta,...e},t(i,n,s))}),iE=e=>new iC(new K.M({...iS,...e})),iI=()=>{var e;return"undefined"!=typeof navigator&&(null===(e=navigator.product)||void 0===e?void 0:e.toLowerCase())==="reactnative"},iD=Object.freeze({trace:0,debug:1,info:2,warn:3,error:4}),i_="info",iP=function(e,t){let i;for(var n=arguments.length,s=Array(n>2?n-2:0),a=2;a<n;a++)s[a-2]=arguments[a];switch(e){case"error":i=console.error;break;case"warn":if(iI()){t="WARN: ".concat(t),i=console.info;break}i=console.warn;break;case"info":i=console.info;break;case"trace":i=console.trace;break;default:i=console.log}i(t,...s)},iN=(e,t)=>{n=e,t&&iU(t)},iU=e=>{i_=e},iA=e=>{let t=n||iP,i=(e||[]).join(":");return function(e,n){for(var s=arguments.length,a=Array(s>2?s-2:0),r=2;r<s;r++)a[r-2]=arguments[r];iD[e]>=iD[i_]&&t(e,"[".concat(i,"]: ").concat(n),...a)}},iO=(e,t,i)=>{let n=iA(["codecs"]);if(!("getCapabilities"in RTCRtpSender)){null==n||n("warn","RTCRtpSender.getCapabilities is not supported");return}let s=RTCRtpSender.getCapabilities(e);if(!s)return;let a=[],r=[],o=[];s.codecs.forEach(s=>{let l=s.mimeType.toLowerCase();if(null==n||n("debug","Found supported codec: ".concat(l)),!i||l!=="".concat(e,"/").concat(i.toLowerCase())){if(l!=="".concat(e,"/").concat(t.toLowerCase())){o.push(s);return}if("h264"===l){s.sdpFmtpLine&&s.sdpFmtpLine.includes("profile-level-id=42e01f")?a.push(s):r.push(s);return}a.push(s)}});let l=[...a,...r,...o];return null==n||n("info","Preffered codecs: ",l),l},iL=async e=>{var t;let i=new RTCPeerConnection;i.addTransceiver("video",{direction:e}),i.addTransceiver("audio",{direction:e});let n=null!==(t=(await i.createOffer()).sdp)&&void 0!==t?t:"";return i.getTransceivers().forEach(e=>{e.stop()}),i.close(),n},iB={subscriberOffer:void 0,publisherAnswer:void 0,connectionQualityChanged:void 0,audioLevelChanged:void 0,iceTrickle:void 0,changePublishQuality:void 0,participantJoined:void 0,participantLeft:void 0,dominantSpeakerChanged:void 0,joinResponse:void 0,healthCheckResponse:void 0,trackPublished:void 0,trackUnpublished:void 0,error:void 0,callGrantsUpdated:void 0,goAway:void 0,iceRestart:void 0,pinsUpdated:void 0},ij=e=>Object.prototype.hasOwnProperty.call(iB,e);class iF{constructor(){this.subscribers={},this.logger=iA(["sfu-client"]),this.dispatch=e=>{let t=e.eventPayload.oneofKind;if(t){this.logger("debug","Dispatching ".concat(t),e.eventPayload[t]);let i=this.subscribers[t];null==i||i.forEach(t=>{try{t(e)}catch(e){this.logger("warn","Listener failed with error",e)}})}},this.on=(e,t)=>{var i,n;return(null!==(n=(i=this.subscribers)[e])&&void 0!==n?n:i[e]=[]).push(t),()=>{this.off(e,t)}},this.off=(e,t)=>{this.subscribers[e]=(this.subscribers[e]||[]).filter(e=>e!==t)},this.offAll=e=>{e?this.subscribers[e]=[]:this.subscribers={}}}}class iW{constructor(){this.subscriberCandidates=new G.t,this.publisherCandidates=new G.t,this.push=e=>{if(e.peerType===C.SUBSCRIBER)this.subscriberCandidates.next(e);else if(e.peerType===C.PUBLISHER_UNSPECIFIED)this.publisherCandidates.next(e);else{var t;null===(t=this.logger)||void 0===t||t.call(this,"warn","ICETrickle, Unknown peer type",e)}},this.logger=iA(["sfu-client"])}}function iV(e){if(e.usernameFragment)return JSON.stringify(e.toJSON());{let t=e.candidate.split(" "),i=t.findIndex(e=>"ufrag"===e)+1,n=t[i];return JSON.stringify({...e,usernameFragment:n})}}let iM=e=>{s=e},ix=()=>s,iH=()=>a,iz=()=>r,iq=()=>{if(iI())return{sdk:ix(),os:iH(),device:iz()};let{browser:e,os:t,device:i,cpu:n}=new eu.UAParser(navigator.userAgent).getResult();return{sdk:ix(),browser:{name:e.name||navigator.userAgent,version:e.version||""},os:{name:t.name||"",version:t.version||"",architecture:n.architecture||""},device:{name:"".concat(i.vendor||""," ").concat(i.model||""," ").concat(i.type||""),version:""}}},iK={bitrate:125e4,width:1280,height:720},iG=function(e){var t;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:iK,n=[],s=e.getSettings(),{width:a=0,height:r=0}=s,o=iI()&&(null===(t=iH())||void 0===t?void 0:t.name.toLowerCase())==="ios",l=i$(i,a,r),c=1;return["f","h","q"].forEach(e=>{n.unshift({active:!0,rid:e,width:Math.round(a/c),height:Math.round(r/c),maxBitrate:Math.round(l/c),scaleResolutionDownBy:c,maxFramerate:{f:30,h:o?30:25,q:o?30:20}[e]}),c*=2}),iJ(s,n)},i$=(e,t,i)=>{let{width:n,height:s}=e;return t<n||i<s?Math.round(e.bitrate*(t*i/(n*s))):e.bitrate},iJ=(e,t)=>{let i;let n=Math.max(e.width||0,e.height||0);i=n<=320?t.filter(e=>"f"===e.rid):n<=640?t.filter(e=>"h"!==e.rid):t;let s=["q","h","f"];return i.map((e,t)=>({...e,rid:s[t]}))},iQ=(e,t)=>{var i,n;let s=e.getSettings();return[{active:!0,rid:"q",width:s.width||0,height:s.height||0,scaleResolutionDownBy:1,maxBitrate:null!==(i=null==t?void 0:t.maxBitrate)&&void 0!==i?i:3e6,maxFramerate:null!==(n=null==t?void 0:t.maxFramerate)&&void 0!==n?n:30}]},iX=e=>{switch(e){case E.SCREEN_SHARE:return"screenShareStream";case E.SCREEN_SHARE_AUDIO:return"screenShareAudioStream";case E.VIDEO:return"videoStream";case E.AUDIO:return"audioStream";case E.UNSPECIFIED:throw Error("Track type is unspecified");default:throw Error("Unknown track type: ".concat(e))}},iY=e=>{switch(e){case"audio":return E.AUDIO;case"video":return E.VIDEO;case"screenshare":return E.SCREEN_SHARE;case"screenshare_audio":return E.SCREEN_SHARE_AUDIO;default:throw Error("Unknown mute type: ".concat(e))}},iZ=e=>"function"==typeof e,i0=e=>{let t,i;if((0,$.a)([e]).subscribe({next:e=>{let[i]=e;t=i},error:e=>{i=e}}).unsubscribe(),i)throw i;return t},i1=(e,t)=>{let i=iZ(t)?t(i0(e)):t;return e.next(i),i},i2=(e,t)=>{let i=e.subscribe(t);return()=>{i.unsubscribe()}};var i3=Object.freeze({__proto__:null,createSubscription:i2,getCurrentValue:i0,setCurrentValue:i1});let i9=function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return(e,i)=>{for(let n of t){let t=n(e,i);if(0!==t)return t}return 0}},i4=e=>t=>(i,n)=>e(i,n)?t(i,n):0,i5=(e,t)=>e.isDominantSpeaker&&!t.isDominantSpeaker?-1:!e.isDominantSpeaker&&t.isDominantSpeaker?1:0,i6=(e,t)=>e.isSpeaking&&!t.isSpeaking?-1:!e.isSpeaking&&t.isSpeaking?1:0,i8=(e,t)=>ns(e)&&!ns(t)?-1:!ns(e)&&ns(t)?1:0,i7=(e,t)=>na(e)&&!na(t)?-1:!na(e)&&na(t)?1:0,ne=(e,t)=>nr(e)&&!nr(t)?-1:!nr(e)&&nr(t)?1:0,nt=(e,t)=>{if(e.pin&&t.pin){if(!e.pin.isLocalPin&&t.pin.isLocalPin)return -1;if(e.pin.isLocalPin&&!t.pin.isLocalPin)return 1;if(e.pin.pinnedAt>t.pin.pinnedAt)return -1;if(e.pin.pinnedAt<t.pin.pinnedAt)return 1}return e.pin&&!t.pin?-1:!e.pin&&t.pin?1:0},ni=e=>(t,i)=>{var n,s,a,r;return(null===(n=t.reaction)||void 0===n?void 0:n.type)===e&&(null===(s=i.reaction)||void 0===s?void 0:s.type)!==e?-1:(null===(a=t.reaction)||void 0===a?void 0:a.type)!==e&&(null===(r=i.reaction)||void 0===r?void 0:r.type)===e?1:0},nn=(e,t)=>(e.roles||[]).some(e=>t.includes(e)),ns=e=>e.publishedTracks.includes(E.SCREEN_SHARE),na=e=>e.publishedTracks.includes(E.VIDEO),nr=e=>e.publishedTracks.includes(E.AUDIO),no=i4((e,t)=>{var i,n;return(null===(i=e.viewportVisibilityState)||void 0===i?void 0:i.videoTrack)===U.INVISIBLE||(null===(n=t.viewportVisibilityState)||void 0===n?void 0:n.videoTrack)===U.INVISIBLE}),nl=i4((e,t)=>{var i,n,s,a;return(null===(i=e.viewportVisibilityState)||void 0===i?void 0:i.videoTrack)===U.INVISIBLE||(null===(n=e.viewportVisibilityState)||void 0===n?void 0:n.videoTrack)===U.UNKNOWN||(null===(s=t.viewportVisibilityState)||void 0===s?void 0:s.videoTrack)===U.INVISIBLE||(null===(a=t.viewportVisibilityState)||void 0===a?void 0:a.videoTrack)===U.UNKNOWN}),nc=i9(nt,i8,no(i9(i5,i6,ni("raised-hand"),i7,ne)));i9(nt,i8,i5,no(i9(i6,ni("raised-hand"),i7,ne))),i9(nt,nl(i9(i5,i6,ni("raised-hand"),i7,ne)));let nd=i9(no(i9(i5,i6,ni("raised-hand"),i7,ne)),function(){for(var e=arguments.length,t=Array(e),i=0;i<e;i++)t[i]=arguments[i];return(e,i)=>nn(e,t)&&!nn(i,t)?-1:!nn(e,t)&&nn(i,t)?1:0}("admin","host","speaker"));(v=O||(O={})).UNKNOWN="unknown",v.IDLE="idle",v.RINGING="ringing",v.JOINING="joining",v.JOINED="joined",v.LEFT="left",v.RECONNECTING="reconnecting",v.MIGRATING="migrating",v.RECONNECTING_FAILED="reconnecting-failed",v.OFFLINE="offline";class nh{get participantCount(){return this.getCurrentValue(this.participantCount$)}get startedAt(){return this.getCurrentValue(this.startedAt$)}get anonymousParticipantCount(){return this.getCurrentValue(this.anonymousParticipantCount$)}get participants(){return this.getCurrentValue(this.participants$)}get localParticipant(){return this.getCurrentValue(this.localParticipant$)}get remoteParticipants(){return this.getCurrentValue(this.remoteParticipants$)}get dominantSpeaker(){return this.getCurrentValue(this.dominantSpeaker$)}get pinnedParticipants(){return this.getCurrentValue(this.pinnedParticipants$)}get hasOngoingScreenShare(){return this.getCurrentValue(this.hasOngoingScreenShare$)}get callingState(){return this.getCurrentValue(this.callingState$)}get callStatsReport(){return this.getCurrentValue(this.callStatsReport$)}get members(){return this.getCurrentValue(this.members$)}get ownCapabilities(){return this.getCurrentValue(this.ownCapabilities$)}get backstage(){return this.getCurrentValue(this.backstage$)}get blockedUserIds(){return this.getCurrentValue(this.blockedUserIds$)}get createdAt(){return this.getCurrentValue(this.createdAt$)}get endedAt(){return this.getCurrentValue(this.endedAt$)}get startsAt(){return this.getCurrentValue(this.startsAt$)}get updatedAt(){return this.getCurrentValue(this.updatedAt$)}get createdBy(){return this.getCurrentValue(this.createdBy$)}get custom(){return this.getCurrentValue(this.custom$)}get egress(){return this.getCurrentValue(this.egress$)}get ingress(){return this.getCurrentValue(this.ingress$)}get recording(){return this.getCurrentValue(this.recording$)}get session(){return this.getCurrentValue(this.session$)}get settings(){return this.getCurrentValue(this.settings$)}get transcribing(){return this.getCurrentValue(this.transcribing$)}get endedBy(){return this.getCurrentValue(this.endedBy$)}get thumbnails(){return this.getCurrentValue(this.thumbnails$)}constructor(){this.backstageSubject=new J.X(!0),this.blockedUserIdsSubject=new J.X([]),this.createdAtSubject=new J.X(new Date),this.endedAtSubject=new J.X(void 0),this.startsAtSubject=new J.X(void 0),this.updatedAtSubject=new J.X(new Date),this.createdBySubject=new J.X(void 0),this.customSubject=new J.X({}),this.egressSubject=new J.X(void 0),this.ingressSubject=new J.X(void 0),this.recordingSubject=new J.X(!1),this.sessionSubject=new J.X(void 0),this.settingsSubject=new J.X(void 0),this.transcribingSubject=new J.X(!1),this.endedBySubject=new J.X(void 0),this.thumbnailsSubject=new J.X(void 0),this.membersSubject=new J.X([]),this.ownCapabilitiesSubject=new J.X([]),this.callingStateSubject=new J.X(O.UNKNOWN),this.startedAtSubject=new J.X(void 0),this.participantCountSubject=new J.X(0),this.anonymousParticipantCountSubject=new J.X(0),this.participantsSubject=new J.X([]),this.callStatsReportSubject=new J.X(void 0),this.sortParticipantsBy=nc,this.setSortParticipantsBy=e=>{this.sortParticipantsBy=e,this.setCurrentValue(this.participantsSubject,e=>e)},this.getCurrentValue=i0,this.setCurrentValue=i1,this.setParticipantCount=e=>this.setCurrentValue(this.participantCountSubject,e),this.setStartedAt=e=>this.setCurrentValue(this.startedAtSubject,e),this.setAnonymousParticipantCount=e=>this.setCurrentValue(this.anonymousParticipantCountSubject,e),this.setParticipants=e=>this.setCurrentValue(this.participantsSubject,e),this.setCallingState=e=>this.setCurrentValue(this.callingStateSubject,e),this.setCallStatsReport=e=>this.setCurrentValue(this.callStatsReportSubject,e),this.setMembers=e=>{this.setCurrentValue(this.membersSubject,e)},this.setOwnCapabilities=e=>this.setCurrentValue(this.ownCapabilitiesSubject,e),this.findParticipantBySessionId=e=>this.participants.find(t=>t.sessionId===e),this.getParticipantLookupBySessionId=()=>this.participants.reduce((e,t)=>(e[t.sessionId]=t,e),{}),this.updateParticipant=(e,t)=>{let i=this.findParticipantBySessionId(e);if(!i){this.logger("warn","Participant with sessionId ".concat(e," not found"));return}let n="function"==typeof t?t(i):t,s={...i,...n};return this.setParticipants(t=>t.map(t=>t.sessionId===e?s:t))},this.updateOrAddParticipant=(e,t)=>this.findParticipantBySessionId(e)?this.setParticipants(i=>i.map(i=>i.sessionId===e?{...i,...t}:i)):this.setParticipants(e=>[...e,t]),this.updateParticipants=e=>{if(0!==Object.keys(e).length)return this.setParticipants(t=>t.map(t=>{let i=e[t.sessionId];return i?{...t,...i}:t}))},this.updateFromEvent=e=>{let t=this.eventHandlers[e.type];t&&t(e)},this.setServerSidePins=e=>{let t=e.reduce((e,t)=>(e[t.sessionId]=Date.now(),e),{});return this.setParticipants(e=>e.map(e=>{let i=t[e.sessionId];return i?{...e,pin:{isLocalPin:!1,pinnedAt:i}}:e.pin&&!e.pin.isLocalPin?{...e,pin:void 0}:e}))},this.updateFromCallResponse=e=>{this.setCurrentValue(this.backstageSubject,e.backstage),this.setCurrentValue(this.blockedUserIdsSubject,e.blocked_user_ids),this.setCurrentValue(this.createdAtSubject,new Date(e.created_at)),this.setCurrentValue(this.updatedAtSubject,new Date(e.updated_at)),this.setCurrentValue(this.startsAtSubject,e.starts_at?new Date(e.starts_at):void 0),this.setCurrentValue(this.endedAtSubject,e.ended_at?new Date(e.ended_at):void 0),this.setCurrentValue(this.createdBySubject,e.created_by),this.setCurrentValue(this.customSubject,e.custom),this.setCurrentValue(this.egressSubject,e.egress),this.setCurrentValue(this.ingressSubject,e.ingress),this.setCurrentValue(this.recordingSubject,e.recording),this.setCurrentValue(this.sessionSubject,e.session),this.setCurrentValue(this.settingsSubject,e.settings),this.setCurrentValue(this.transcribingSubject,e.transcribing),this.setCurrentValue(this.thumbnailsSubject,e.thumbnails)},this.updateFromMemberRemoved=e=>{this.setCurrentValue(this.membersSubject,t=>t.filter(t=>-1===e.members.indexOf(t.user_id)))},this.updateFromMemberAdded=e=>{this.setCurrentValue(this.membersSubject,t=>[...t,...e.members])},this.updateFromHLSBroadcastStopped=()=>{this.setCurrentValue(this.egressSubject,e=>({...e,broadcasting:!1}))},this.updateFromHLSBroadcastingFailed=()=>{this.setCurrentValue(this.egressSubject,e=>({...e,broadcasting:!1}))},this.updateFromHLSBroadcastStarted=e=>{this.setCurrentValue(this.egressSubject,t=>({...t,broadcasting:!0,hls:{...t.hls,playlist_url:e.hls_playlist_url}}))},this.updateFromSessionParticipantLeft=e=>{this.setCurrentValue(this.sessionSubject,t=>{if(!t)return this.logger("warn","Received call.session_participant_left event but no session is available.",e),t;let{participants:i,participants_count_by_role:n}=t,{user:s,user_session_id:a}=e.participant;return{...t,participants:i.filter(e=>e.user_session_id!==a),participants_count_by_role:{...n,[s.role]:Math.max(0,(n[s.role]||0)-1)}}})},this.updateFromSessionParticipantJoined=e=>{this.setCurrentValue(this.sessionSubject,t=>{if(!t)return this.logger("warn","Received call.session_participant_joined event but no session is available.",e),t;let{participants:i,participants_count_by_role:n}=t,{user:s,user_session_id:a}=e.participant,r=!0,o=i.map(t=>t.user_session_id===a?(r=!1,e.participant):t);r&&o.push(e.participant);let l=r?1:0;return{...t,participants:o,participants_count_by_role:{...n,[s.role]:(n[s.role]||0)+l}}})},this.updateMembers=e=>{this.setCurrentValue(this.membersSubject,t=>t.map(t=>e.members.find(e=>e.user_id===t.user_id)||t))},this.updateParticipantReaction=e=>{let{user:t,custom:i,type:n,emoji_code:s}=e.reaction;this.setParticipants(e=>e.map(e=>e.userId!==t.id?e:{...e,reaction:{type:n,emoji_code:s,custom:i}}))},this.unblockUser=e=>{this.setCurrentValue(this.blockedUserIdsSubject,t=>t?t.filter(t=>t!==e.user.id):t)},this.blockUser=e=>{this.setCurrentValue(this.blockedUserIdsSubject,t=>[...t||[],e.user.id])},this.updateOwnCapabilities=e=>{var t;e.user.id===(null===(t=this.localParticipant)||void 0===t?void 0:t.userId)&&this.setCurrentValue(this.ownCapabilitiesSubject,e.own_capabilities)},this.logger=iA(["CallState"]),this.participants$=this.participantsSubject.asObservable().pipe((0,Q.U)(e=>e.sort(this.sortParticipantsBy)),(0,X.d)({bufferSize:1,refCount:!0})),this.localParticipant$=this.participants$.pipe((0,Q.U)(e=>e.find(e=>e.isLocalParticipant)),(0,X.d)({bufferSize:1,refCount:!0})),this.remoteParticipants$=this.participants$.pipe((0,Q.U)(e=>e.filter(e=>!e.isLocalParticipant)),(0,X.d)({bufferSize:1,refCount:!0})),this.pinnedParticipants$=this.participants$.pipe((0,Q.U)(e=>e.filter(e=>!!e.pin)),(0,X.d)({bufferSize:1,refCount:!0})),this.dominantSpeaker$=this.participants$.pipe((0,Q.U)(e=>e.find(e=>e.isDominantSpeaker)),(0,X.d)({bufferSize:1,refCount:!0})),this.hasOngoingScreenShare$=this.participants$.pipe((0,Q.U)(e=>e.some(e=>e.publishedTracks.includes(E.SCREEN_SHARE))),(0,Y.x)(),(0,X.d)({bufferSize:1,refCount:!0})),this.startedAt$=this.startedAtSubject.asObservable(),this.participantCount$=this.participantCountSubject.asObservable(),this.anonymousParticipantCount$=this.anonymousParticipantCountSubject.asObservable(),this.callStatsReport$=this.callStatsReportSubject.asObservable(),this.members$=this.membersSubject.asObservable(),this.ownCapabilities$=this.ownCapabilitiesSubject.asObservable(),this.callingState$=this.callingStateSubject.asObservable(),this.backstage$=this.backstageSubject.asObservable(),this.blockedUserIds$=this.blockedUserIdsSubject.asObservable(),this.createdAt$=this.createdAtSubject.asObservable(),this.endedAt$=this.endedAtSubject.asObservable(),this.startsAt$=this.startsAtSubject.asObservable(),this.updatedAt$=this.updatedAtSubject.asObservable(),this.createdBy$=this.createdBySubject.asObservable(),this.custom$=this.customSubject.asObservable(),this.egress$=this.egressSubject.asObservable(),this.ingress$=this.ingressSubject.asObservable(),this.recording$=this.recordingSubject.asObservable(),this.session$=this.sessionSubject.asObservable(),this.settings$=this.settingsSubject.asObservable(),this.transcribing$=this.transcribingSubject.asObservable(),this.endedBy$=this.endedBySubject.asObservable(),this.thumbnails$=this.thumbnailsSubject.asObservable(),this.eventHandlers={"call.permission_request":void 0,"call.recording_failed":void 0,"call.recording_ready":void 0,"call.user_muted":void 0,"connection.error":void 0,"connection.ok":void 0,"health.check":void 0,custom:void 0,"call.accepted":e=>this.updateFromCallResponse(e.call),"call.blocked_user":this.blockUser,"call.created":e=>this.updateFromCallResponse(e.call),"call.ended":e=>{this.updateFromCallResponse(e.call),this.setCurrentValue(this.endedBySubject,e.user)},"call.hls_broadcasting_failed":this.updateFromHLSBroadcastingFailed,"call.hls_broadcasting_started":this.updateFromHLSBroadcastStarted,"call.hls_broadcasting_stopped":this.updateFromHLSBroadcastStopped,"call.live_started":e=>this.updateFromCallResponse(e.call),"call.member_added":this.updateFromMemberAdded,"call.member_removed":this.updateFromMemberRemoved,"call.member_updated_permission":this.updateMembers,"call.member_updated":this.updateMembers,"call.notification":e=>{this.updateFromCallResponse(e.call),this.setMembers(e.members)},"call.permissions_updated":this.updateOwnCapabilities,"call.reaction_new":this.updateParticipantReaction,"call.recording_started":()=>this.setCurrentValue(this.recordingSubject,!0),"call.recording_stopped":()=>this.setCurrentValue(this.recordingSubject,!1),"call.rejected":e=>this.updateFromCallResponse(e.call),"call.ring":e=>this.updateFromCallResponse(e.call),"call.session_ended":e=>this.updateFromCallResponse(e.call),"call.session_participant_joined":this.updateFromSessionParticipantJoined,"call.session_participant_left":this.updateFromSessionParticipantLeft,"call.session_started":e=>this.updateFromCallResponse(e.call),"call.unblocked_user":this.unblockUser,"call.updated":e=>this.updateFromCallResponse(e.call)}}}class nu{get connectedUser(){return this.getCurrentValue(this.connectedUserSubject)}get calls(){return this.getCurrentValue(this.callsSubject)}constructor(){this.connectedUserSubject=new J.X(void 0),this.callsSubject=new J.X([]),this.getCurrentValue=i0,this.setCurrentValue=i1,this.setConnectedUser=e=>this.setCurrentValue(this.connectedUserSubject,e),this.setCalls=e=>this.setCurrentValue(this.callsSubject,e),this.registerCall=e=>{this.calls.find(t=>t.cid===e.cid)||this.setCalls(t=>[...t,e])},this.unregisterCall=e=>this.setCalls(t=>t.filter(t=>t!==e)),this.findCall=(e,t)=>this.calls.find(i=>i.type===e&&i.id===t),this.connectedUserSubject.subscribe(async e=>{if(!e){let e=iA(["client-state"]);for(let t of this.calls)t.state.callingState!==O.LEFT&&(e("info","User disconnected, leaving call: ".concat(t.cid)),await t.leave().catch(i=>{e("error","Error leaving call: ".concat(t.cid),i)}))}})}}class np{get connectedUser(){return i0(this.connectedUser$)}get calls(){return i0(this.calls$)}constructor(e){this.getCurrentValue=i0,this.connectedUser$=e.connectedUserSubject.asObservable(),this.calls$=e.callsSubject.asObservable()}}let ng=e=>{let t=/^a=rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/.exec(e);if(t)return{original:t[0],payload:t[1],codec:t[2]}},nm=e=>{let t=/^a=fmtp:(\d*) (.*)/.exec(e);if(t)return{original:t[0],payload:t[1],config:t[2]}},nf=(e,t)=>{let i=new RegExp("(m=".concat(t," \\d+ [\\w/]+) ([\\d\\s]+)")).exec(e);if(i)return{original:i[0],mediaWithPorts:i[1],codecOrder:i[2]}},ny=(e,t)=>{let i;let n=[],s=[],a=!1;if(e.split(/(\r\n|\r|\n)/).forEach(e=>{if(!/^([a-z])=(.*)/.test(e))return;let r=e[0];if("m"===r){let n=nf(e,t);a=!!n,n&&(i=n)}else if(a&&"a"===r){let t=ng(e),i=nm(e);t?n.push(t):i&&s.push(i)}}),i)return{media:i,rtpMap:n,fmtp:s}},nb=e=>{let t=ny(e,"audio"),i=null==t?void 0:t.rtpMap.find(e=>"opus"===e.codec.toLowerCase()),n=null==i?void 0:i.payload;if(n)return null==t?void 0:t.fmtp.find(e=>e.payload===n)},nv=(e,t)=>{let i=nb(e);if(i){let n=/usedtx=(\d)/.exec(i.config),s="usedtx=".concat(t?"1":"0");if(n){let t=i.original.replace(/usedtx=(\d)/,s);return e.replace(i.original,t)}{let t="".concat(i.original,";").concat(s);return e.replace(i.original,t)}}return e},nk=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:51e4;i=Math.max(Math.min(i,51e4),96e3);let n=eh.Qc(e),s=n.media.find(e=>"audio"===e.type&&String(e.mid)===t);if(!s)return e;let a=s.rtp.find(e=>"opus"===e.codec);if(!a)return e;let r=s.fmtp.find(e=>e.payload===a.payload);return r?(r.config.match(/stereo=(\d)/)?r.config=r.config.replace(/stereo=(\d)/,"stereo=1"):r.config="".concat(r.config,";stereo=1"),r.config.match(/maxaveragebitrate=(\d*)/)?r.config=r.config.replace(/maxaveragebitrate=(\d*)/,"maxaveragebitrate=".concat(i)):r.config="".concat(r.config,";maxaveragebitrate=").concat(i),eh.cW(n)):e},nw=iA(["Publisher"]);class nT{get connectionConfiguration(){return this.pc.getConfiguration()}constructor({connectionConfig:e,sfuClient:t,dispatcher:i,state:n,isDtxEnabled:s,isRedEnabled:a,iceRestartDelay:r=2500}){var o=this;this.transceiverRegistry={[E.AUDIO]:void 0,[E.VIDEO]:void 0,[E.SCREEN_SHARE]:void 0,[E.SCREEN_SHARE_AUDIO]:void 0,[E.UNSPECIFIED]:void 0},this.publishOptionsPerTrackType=new Map,this.transceiverInitOrder=[],this.trackKindMapping={[E.AUDIO]:"audio",[E.VIDEO]:"video",[E.SCREEN_SHARE]:"video",[E.SCREEN_SHARE_AUDIO]:"audio",[E.UNSPECIFIED]:void 0},this.trackLayersCache={[E.AUDIO]:void 0,[E.VIDEO]:void 0,[E.SCREEN_SHARE]:void 0,[E.SCREEN_SHARE_AUDIO]:void 0,[E.UNSPECIFIED]:void 0},this.isIceRestarting=!1,this.createPeerConnection=e=>{let t=new RTCPeerConnection(e);return t.addEventListener("icecandidate",this.onIceCandidate),t.addEventListener("negotiationneeded",this.onNegotiationNeeded),t.addEventListener("icecandidateerror",this.onIceCandidateError),t.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),t.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),t.addEventListener("signalingstatechange",this.onSignalingStateChange),t},this.close=function(){let{stopTracks:e=!0}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e&&(o.stopPublishing(),Object.keys(o.transceiverRegistry).forEach(e=>{o.transceiverRegistry[e]=void 0}),Object.keys(o.trackLayersCache).forEach(e=>{o.trackLayersCache[e]=void 0})),clearTimeout(o.iceRestartTimeout),o.unsubscribeOnIceRestart(),o.pc.removeEventListener("negotiationneeded",o.onNegotiationNeeded),o.pc.close()},this.publishStream=async function(e,t,i){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if("ended"===t.readyState)throw Error("Can't publish a track that has ended already.");let s=o.pc.getTransceivers().find(e=>{var t;return e===o.transceiverRegistry[i]&&e.sender.track&&(null===(t=e.sender.track)||void 0===t?void 0:t.kind)===o.trackKindMapping[i]}),a=async()=>{nw("info","Track ".concat(E[i]," has ended, notifying the SFU")),await o.notifyTrackMuteStateChanged(e,i,!0),t.removeEventListener("ended",a)};if(s){let e=s.sender.track;e&&e!==t&&(e.stop(),e.removeEventListener("ended",a),t.addEventListener("ended",a)),t.enabled||(t.enabled=!0),await s.sender.replaceTrack(t)}else{let{settings:l}=o.state,c=null==l?void 0:l.video.target_resolution,d=i===E.VIDEO?iG(t,c):i===E.SCREEN_SHARE?iQ(t,n.screenShareSettings):void 0,h=n.preferredCodec;if(!h&&i===E.VIDEO&&iI()){var r;let e=null===(r=iH())||void 0===r?void 0:r.name.toLowerCase();"ios"===e||"ipados"===e?h="H264":"android"===e&&(h="VP8")}let u=o.getCodecPreferences(i,h);t.addEventListener("ended",a),t.enabled||(t.enabled=!0),s=o.pc.addTransceiver(t,{direction:"sendonly",streams:i===E.VIDEO||i===E.SCREEN_SHARE?[e]:void 0,sendEncodings:d}),nw("debug","Added ".concat(E[i]," transceiver")),o.transceiverInitOrder.push(i),o.transceiverRegistry[i]=s,o.publishOptionsPerTrackType.set(i,n),"setCodecPreferences"in s&&u&&(nw("info","Setting ".concat(E[i]," codec preferences"),u),s.setCodecPreferences(u))}await o.notifyTrackMuteStateChanged(e,i,!1)},this.unpublishStream=async(e,t)=>{let i=this.pc.getTransceivers().find(t=>t===this.transceiverRegistry[e]&&t.sender.track);if(i&&i.sender.track&&(t?"live"===i.sender.track.readyState:i.sender.track.enabled)){var n;t?i.sender.track.stop():i.sender.track.enabled=!1,(null===(n=this.state.localParticipant)||void 0===n?void 0:n.publishedTracks.includes(e))&&await this.notifyTrackMuteStateChanged(void 0,e,!0)}},this.isPublishing=e=>{let t=this.transceiverRegistry[e];if(t&&t.sender){let e=t.sender;return!!e.track&&"live"===e.track.readyState&&e.track.enabled}return!1},this.isLive=e=>{let t=this.transceiverRegistry[e];if(t&&t.sender){let e=t.sender;return!!e.track&&"live"===e.track.readyState}return!1},this.notifyTrackMuteStateChanged=async(e,t,i)=>{await this.sfuClient.updateMuteState(t,i);let n=iX(t);i?this.state.updateParticipant(this.sfuClient.sessionId,e=>({publishedTracks:e.publishedTracks.filter(e=>e!==t),[n]:void 0})):this.state.updateParticipant(this.sfuClient.sessionId,i=>({publishedTracks:i.publishedTracks.includes(t)?i.publishedTracks:[...i.publishedTracks,t],[n]:e}))},this.stopPublishing=()=>{nw("debug","Stopping publishing all tracks"),this.pc.getSenders().forEach(e=>{var t;null===(t=e.track)||void 0===t||t.stop(),"closed"!==this.pc.signalingState&&this.pc.removeTrack(e)})},this.updateVideoPublishQuality=async e=>{var t;nw("info","Update publish quality, requested layers by SFU:",e);let i=null===(t=this.transceiverRegistry[E.VIDEO])||void 0===t?void 0:t.sender;if(!i){nw("warn","Update publish quality, no video sender found.");return}let n=i.getParameters();if(0===n.encodings.length){nw("warn","Update publish quality, No suitable video encoding quality found");return}let s=!1,a=e.filter(e=>e.active).map(e=>e.name);n.encodings.forEach(t=>{let i=a.includes(t.rid);if(i!==t.active&&(t.active=i,s=!0),i){let i=e.find(e=>e.name===t.rid);void 0!==i&&(i.scaleResolutionDownBy>=1&&i.scaleResolutionDownBy!==t.scaleResolutionDownBy&&(nw("debug","[dynascale]: setting scaleResolutionDownBy from server","layer",i.name,"scale-resolution-down-by",i.scaleResolutionDownBy),t.scaleResolutionDownBy=i.scaleResolutionDownBy,s=!0),i.maxBitrate>0&&i.maxBitrate!==t.maxBitrate&&(nw("debug","[dynascale] setting max-bitrate from the server","layer",i.name,"max-bitrate",i.maxBitrate),t.maxBitrate=i.maxBitrate,s=!0),i.maxFramerate>0&&i.maxFramerate!==t.maxFramerate&&(nw("debug","[dynascale]: setting maxFramerate from server","layer",i.name,"max-framerate",i.maxFramerate),t.maxFramerate=i.maxFramerate,s=!0))}});let r=n.encodings.filter(e=>e.active);s?(await i.setParameters(n),nw("info","Update publish quality, enabled rids: ",r)):nw("info","Update publish quality, no change: ",r)},this.getStats=e=>this.pc.getStats(e),this.getCodecPreferences=(e,t)=>{if(e===E.VIDEO)return iO("video",t||"vp8");if(e===E.AUDIO){let e=this.isRedEnabled?"red":"opus";return iO("audio",null!=t?t:e,this.isRedEnabled?void 0:"red")}},this.onIceCandidate=async e=>{let{candidate:t}=e;if(!t){nw("debug","null ice candidate");return}await this.sfuClient.iceTrickle({iceCandidate:iV(t),peerType:C.PUBLISHER_UNSPECIFIED})},this.setSfuClient=e=>{this.sfuClient=e},this.migrateTo=async(e,t)=>{this.sfuClient=e,this.pc.setConfiguration(t),"connected"===this.pc.iceConnectionState&&await this.negotiate({iceRestart:!0})},this.restartIce=async()=>{nw("debug","Restarting ICE connection");let e=this.pc.signalingState;if(this.isIceRestarting||"have-local-offer"===e){nw("debug","ICE restart is already in progress");return}await this.negotiate({iceRestart:!0})},this.onNegotiationNeeded=async()=>{await this.negotiate()},this.negotiate=async e=>{var t,i;this.isIceRestarting=null!==(t=null==e?void 0:e.iceRestart)&&void 0!==t&&t;let n=await this.pc.createOffer(e),s=this.mungeCodecs(n.sdp);if(s&&this.isPublishing(E.SCREEN_SHARE_AUDIO)){let e=this.transceiverRegistry[E.SCREEN_SHARE_AUDIO];if(e&&e.sender.track){let t=null!==(i=e.mid)&&void 0!==i?i:this.extractMid(s,e.sender.track,E.SCREEN_SHARE_AUDIO);s=nk(s,t)}}n.sdp=s;let a=this.getCurrentTrackInfos(n.sdp);if(0===a.length)throw Error("Can't initiate negotiation without announcing any tracks");await this.pc.setLocalDescription(n);let{response:r}=await this.sfuClient.setPublisher({sdp:n.sdp||"",tracks:a});try{await this.pc.setRemoteDescription({type:"answer",sdp:r.sdp})}catch(e){nw("error","setRemoteDescription error",{sdp:r.sdp,error:e})}this.isIceRestarting=!1,this.sfuClient.iceTrickleBuffer.publisherCandidates.subscribe(async e=>{try{let t=JSON.parse(e.iceCandidate);await this.pc.addIceCandidate(t)}catch(t){nw("warn","ICE candidate error",[t,e])}})},this.mungeCodecs=e=>(e&&(e=nv(e,this.isDtxEnabled)),e),this.extractMid=(e,t,i)=>{if(!e)return nw("warn","No SDP found. Returning empty mid"),"";nw("debug","No 'mid' found for track. Trying to find it from the Offer SDP");let n=eh.Qc(e).media.find(e=>{var i,n;return e.type===t.kind&&(null===(n=null===(i=e.msid)||void 0===i?void 0:i.includes(t.id))||void 0===n||n)});if(void 0===(null==n?void 0:n.mid)){nw("debug","No mid found in SDP for track type ".concat(t.kind," and id ").concat(t.id,". Attempting to find a heuristic mid"));let e=this.transceiverInitOrder.indexOf(i);return -1!==e?String(e):(nw("debug","No heuristic mid found. Returning empty mid"),"")}return String(n.mid)},this.getCurrentTrackInfos=e=>{var t;e=e||(null===(t=this.pc.localDescription)||void 0===t?void 0:t.sdp);let{settings:i}=this.state,n=null==i?void 0:i.video.target_resolution;return this.pc.getTransceivers().filter(e=>"sendonly"===e.direction&&e.sender.track).map(t=>{var i;let s;let a=Number(Object.keys(this.transceiverRegistry).find(e=>this.transceiverRegistry[e]===t)),r=t.sender.track;if("live"===r.readyState){let e=this.publishOptionsPerTrackType.get(a);s=a===E.VIDEO?iG(r,n):a===E.SCREEN_SHARE?iQ(r,null==e?void 0:e.screenShareSettings):[],this.trackLayersCache[a]=s}else s=this.trackLayersCache[a]||[],nw("debug","Track ".concat(E[a]," is ended. Announcing last known optimal layers"),s);let o=s.map(e=>({rid:e.rid||"",bitrate:e.maxBitrate||0,fps:e.maxFramerate||0,quality:this.ridToVideoQuality(e.rid||""),videoDimension:{width:e.width,height:e.height}})),l=[E.AUDIO,E.SCREEN_SHARE_AUDIO].includes(a),c=r.getSettings(),d=l&&2===c.channelCount;return{trackId:r.id,layers:o,trackType:a,mid:null!==(i=t.mid)&&void 0!==i?i:this.extractMid(e,r,a),stereo:d,dtx:l&&this.isDtxEnabled,red:l&&this.isRedEnabled}})},this.onIceCandidateError=e=>{let t=e instanceof RTCPeerConnectionIceErrorEvent&&"".concat(e.errorCode,": ").concat(e.errorText);nw("connected"===this.pc.iceConnectionState?"debug":"error","ICE Candidate error",t)},this.onIceConnectionStateChange=()=>{let e=this.pc.iceConnectionState;nw("debug","ICE Connection state changed to",e);let t=this.state.callingState!==O.OFFLINE;"failed"===e?(nw("warn","Attempting to restart ICE"),this.restartIce().catch(e=>{nw("error","ICE restart error",e)})):"disconnected"===e&&t&&(nw("warn","Scheduling ICE restart in ".concat(this.iceRestartDelay," ms.")),this.iceRestartTimeout=setTimeout(()=>{"disconnected"===this.pc.iceConnectionState||"failed"===this.pc.iceConnectionState?this.restartIce().catch(e=>{nw("error","ICE restart error",e)}):nw("debug","Scheduled ICE restart: connection recovered, canceled.")},this.iceRestartDelay))},this.onIceGatheringStateChange=()=>{nw("debug","ICE Gathering State",this.pc.iceGatheringState)},this.onSignalingStateChange=()=>{nw("debug","Signaling state changed",this.pc.signalingState)},this.ridToVideoQuality=e=>"q"===e?R.LOW_UNSPECIFIED:"h"===e?R.MID:R.HIGH,this.pc=this.createPeerConnection(e),this.sfuClient=t,this.state=n,this.isDtxEnabled=s,this.isRedEnabled=a,this.iceRestartDelay=r,this.unsubscribeOnIceRestart=i.on("iceRestart",async e=>{if("iceRestart"!==e.eventPayload.oneofKind)return;let{iceRestart:t}=e.eventPayload;t.peerType===C.PUBLISHER_UNSPECIFIED&&await this.restartIce()})}}let nC=iA(["Subscriber"]);class nS{constructor({sfuClient:e,dispatcher:t,state:i,connectionConfig:n,iceRestartDelay:s=2500}){this.isIceRestarting=!1,this.createPeerConnection=e=>{let t=new RTCPeerConnection(e);return t.addEventListener("icecandidate",this.onIceCandidate),t.addEventListener("track",this.handleOnTrack),t.addEventListener("icecandidateerror",this.onIceCandidateError),t.addEventListener("iceconnectionstatechange",this.onIceConnectionStateChange),t.addEventListener("icegatheringstatechange",this.onIceGatheringStateChange),t},this.close=()=>{clearTimeout(this.iceRestartTimeout),this.unregisterOnSubscriberOffer(),this.unregisterOnIceRestart(),this.pc.close()},this.getStats=e=>this.pc.getStats(e),this.setSfuClient=e=>{this.sfuClient=e},this.migrateTo=(e,t)=>{let i;this.setSfuClient(e);let n=this.pc,s=new Set;n.getReceivers().forEach(e=>{"video"===e.track.kind&&s.add(e.track.id)});let a=this.createPeerConnection(t),r=()=>{n.close(),clearTimeout(i)},o=e=>{nC("debug","[Migration]: Migrated track: ".concat(e.track.id,", ").concat(e.track.kind)),s.delete(e.track.id),0===s.size&&(nC("debug","[Migration]: Migration complete"),a.removeEventListener("track",o),r())},l=()=>{"connected"===a.connectionState&&(i=setTimeout(()=>{a.removeEventListener("track",o),r()},2e3),a.removeEventListener("connectionstatechange",l))};a.addEventListener("track",o),a.addEventListener("connectionstatechange",l),this.pc=a},this.restartIce=async()=>{if(nC("debug","Restarting ICE connection"),"have-remote-offer"===this.pc.signalingState){nC("debug","ICE restart is already in progress");return}let e=this.isIceRestarting;try{this.isIceRestarting=!0,await this.sfuClient.iceRestart({peerType:C.SUBSCRIBER})}catch(t){throw this.isIceRestarting=e,t}},this.handleOnTrack=e=>{let[t]=e.streams,[i,n]=t.id.split(":"),s=this.state.participants.find(e=>e.trackLookupPrefix===i);if(nC("debug","[onTrack]: Got remote ".concat(n," track for userId: ").concat(null==s?void 0:s.userId),e.track.id,e.track),!s){nC("error","[onTrack]: Received track for unknown participant: ".concat(i),e);return}e.track.addEventListener("mute",()=>{nC("info","[onTrack]: Track muted: ".concat(s.userId," ").concat(n,":").concat(i))}),e.track.addEventListener("unmute",()=>{nC("info","[onTrack]: Track unmuted: ".concat(s.userId," ").concat(n,":").concat(i))}),e.track.addEventListener("ended",()=>{nC("info","[onTrack]: Track ended: ".concat(s.userId," ").concat(n,":").concat(i))});let a={TRACK_TYPE_AUDIO:"audioStream",TRACK_TYPE_VIDEO:"videoStream",TRACK_TYPE_SCREEN_SHARE:"screenShareStream",TRACK_TYPE_SCREEN_SHARE_AUDIO:"screenShareAudioStream"}[n];if(!a){nC("error","Unknown track type: ".concat(n));return}let r=s[a];r&&(nC("info","[onTrack]: Cleaning up previous remote ".concat(e.track.kind," tracks for userId: ").concat(s.userId)),r.getTracks().forEach(e=>{e.stop(),r.removeTrack(e)})),this.state.updateParticipant(s.sessionId,{[a]:t})},this.onIceCandidate=async e=>{let{candidate:t}=e;if(!t){nC("debug","null ice candidate");return}await this.sfuClient.iceTrickle({iceCandidate:iV(t),peerType:C.SUBSCRIBER})},this.negotiate=async e=>{nC("info","Received subscriberOffer",e),await this.pc.setRemoteDescription({type:"offer",sdp:e.sdp}),this.sfuClient.iceTrickleBuffer.subscriberCandidates.subscribe(async e=>{try{let t=JSON.parse(e.iceCandidate);await this.pc.addIceCandidate(t)}catch(t){nC("warn","ICE candidate error",[t,e])}});let t=await this.pc.createAnswer();await this.pc.setLocalDescription(t),await this.sfuClient.sendAnswer({peerType:C.SUBSCRIBER,sdp:t.sdp||""}),this.isIceRestarting=!1},this.onIceConnectionStateChange=()=>{let e=this.pc.iceConnectionState;if(nC("debug","ICE connection state changed",e),this.isIceRestarting)return;let t=this.state.callingState!==O.OFFLINE;"failed"===e?(nC("warn","Attempting to restart ICE"),this.restartIce().catch(e=>{nC("error","ICE restart failed",e)})):"disconnected"===e&&t&&(nC("warn","Scheduling ICE restart in ".concat(this.iceRestartDelay," ms.")),this.iceRestartTimeout=setTimeout(()=>{"disconnected"===this.pc.iceConnectionState||"failed"===this.pc.iceConnectionState?this.restartIce().catch(e=>{nC("error","ICE restart failed",e)}):nC("debug","Scheduled ICE restart: connection recovered, canceled.")},5e3))},this.onIceGatheringStateChange=()=>{nC("debug","ICE gathering state changed",this.pc.iceGatheringState)},this.onIceCandidateError=e=>{let t=e instanceof RTCPeerConnectionIceErrorEvent&&"".concat(e.errorCode,": ").concat(e.errorText);nC("connected"===this.pc.iceConnectionState?"debug":"error","ICE Candidate error",t)},this.sfuClient=e,this.state=i,this.iceRestartDelay=s,this.pc=this.createPeerConnection(n),this.unregisterOnSubscriberOffer=t.on("subscriberOffer",async e=>{if("subscriberOffer"!==e.eventPayload.oneofKind)return;let{subscriberOffer:t}=e.eventPayload;await this.negotiate(t)}),this.unregisterOnIceRestart=t.on("iceRestart",async e=>{if("iceRestart"!==e.eventPayload.oneofKind)return;let{iceRestart:t}=e.eventPayload;t.peerType===C.SUBSCRIBER&&await this.restartIce()})}}let nR=e=>{let t=iA(["sfu-client"]),{endpoint:i,onMessage:n}=e,s=new ep.Z(i);return s.binaryType="arraybuffer",s.addEventListener("error",e=>{t("error","Signaling WS channel error",e)}),s.addEventListener("close",e=>{t("info","Signaling WS channel is closed",e)}),s.addEventListener("open",e=>{t("info","Signaling WS channel is open",e)}),s.addEventListener("message",e=>{try{let t=e.data instanceof ArrayBuffer?tI.fromBinary(new Uint8Array(e.data)):tI.fromJsonString(e.data.toString());n(t)}catch(i){t("error","Failed to decode a message. Check whether the Proto models match.",{event:e,error:i})}}),s},nE=e=>new Promise(t=>setTimeout(t,e));function nI(e){return e&&("[object Function]"===Object.prototype.toString.call(e)||"function"==typeof e||e instanceof Function)}let nD={TOKEN_EXPIRED:40,WS_CLOSED_SUCCESS:1e3,WS_CLOSED_ABRUPTLY:1006,WS_POLICY_VIOLATION:1008};function n_(e){let t=Math.min(Math.max(250,(e-1)*2e3),5e3);return Math.floor(Math.random()*(Math.min(500+2e3*e,5e3)-t)+t)}function nP(e){let t="";for(let i=0;i<e.length;i++)t+=e[i].toString(16).padStart(2,"0");return t}function nN(){let e=function(e){let t=new Uint8Array(16);return nU(t),t}(0);return e[6]=15&e[6]|64,e[8]=191&e[8]|128,nP(e.subarray(0,4))+"-"+nP(e.subarray(4,6))+"-"+nP(e.subarray(6,8))+"-"+nP(e.subarray(8,10))+"-"+nP(e.subarray(10,16))}let nU="undefined"!=typeof crypto&&void 0!==(null===(k=crypto)||void 0===k?void 0:k.getRandomValues)?crypto.getRandomValues.bind(crypto):"undefined"!=typeof msCrypto?msCrypto.getRandomValues.bind(msCrypto):function(e){let t=Math.pow(2,8*e.byteLength/e.length);for(let i=0;i<e.length;i++)e[i]=Math.random()*t};function nA(e){window.addEventListener&&(window.addEventListener("offline",e),window.addEventListener("online",e))}function nO(e){window.removeEventListener&&(window.removeEventListener("offline",e),window.removeEventListener("online",e))}class nL{constructor({dispatcher:e,sfuServer:t,token:i,sessionId:n}){var s=this;this.iceTrickleBuffer=new iW,this.isMigratingAway=!1,this.isFastReconnecting=!1,this.pingIntervalInMs=1e4,this.unhealthyTimeoutInMs=this.pingIntervalInMs+5e3,this.close=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:nL.NORMAL_CLOSURE,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"js-client: requested signal connection close";s.logger("debug","Closing SFU WS connection",e,t),s.signalWs.readyState!==s.signalWs.CLOSED&&s.signalWs.close(e,t),s.unsubscribeIceTrickle(),clearInterval(s.keepAliveInterval),clearTimeout(s.connectionCheckTimeout)},this.updateSubscriptions=async e=>nB(()=>this.rpc.updateSubscriptions({sessionId:this.sessionId,tracks:e}),this.logger),this.setPublisher=async e=>nB(()=>this.rpc.setPublisher({...e,sessionId:this.sessionId}),this.logger),this.sendAnswer=async e=>nB(()=>this.rpc.sendAnswer({...e,sessionId:this.sessionId}),this.logger),this.iceTrickle=async e=>nB(()=>this.rpc.iceTrickle({...e,sessionId:this.sessionId}),this.logger),this.iceRestart=async e=>nB(()=>this.rpc.iceRestart({...e,sessionId:this.sessionId}),this.logger),this.updateMuteState=async(e,t)=>this.updateMuteStates({muteStates:[{trackType:e,muted:t}]}),this.updateMuteStates=async e=>nB(()=>this.rpc.updateMuteStates({...e,sessionId:this.sessionId}),this.logger),this.join=async e=>{let t=tK.create({...e,sessionId:this.sessionId,token:this.token});return this.send(tB.create({requestPayload:{oneofKind:"joinRequest",joinRequest:t}}))},this.send=async e=>this.signalReady.then(t=>{t.readyState===t.OPEN&&(this.logger("debug","Sending message to: ".concat(this.edgeName),tB.toJson(e)),t.send(tB.toBinary(e)))}),this.keepAlive=()=>{clearInterval(this.keepAliveInterval),this.keepAliveInterval=setInterval(()=>{this.logger("trace","Sending healthCheckRequest to SFU");let e=tB.create({requestPayload:{oneofKind:"healthCheckRequest",healthCheckRequest:{}}});this.send(e).catch(e=>{this.logger("error","Error sending healthCheckRequest to SFU",e)})},this.pingIntervalInMs)},this.scheduleConnectionCheck=()=>{clearTimeout(this.connectionCheckTimeout),this.connectionCheckTimeout=setTimeout(()=>{this.lastMessageTimestamp&&new Date().getTime()-this.lastMessageTimestamp.getTime()>this.unhealthyTimeoutInMs&&this.close(nL.ERROR_CONNECTION_UNHEALTHY,"SFU connection unhealthy. Didn't receive any message for ".concat(this.unhealthyTimeoutInMs,"ms"))},this.unhealthyTimeoutInMs)},this.sessionId=n||nN(),this.sfuServer=t,this.edgeName=t.edge_name,this.token=i,this.logger=iA(["sfu-client"]),this.rpc=iE({baseUrl:t.url,interceptors:[iR({Authorization:"Bearer ".concat(i)}),{interceptUnary:(e,t,i,n)=>(this.logger("trace","Calling SFU RPC method ".concat(t.name),{input:i,options:n}),e(t,i,n))}]}),this.unsubscribeIceTrickle=e.on("iceTrickle",e=>{if("iceTrickle"!==e.eventPayload.oneofKind)return;let{iceTrickle:t}=e.eventPayload;this.iceTrickleBuffer.push(t)}),this.signalWs=nR({endpoint:t.ws_endpoint,onMessage:t=>{this.lastMessageTimestamp=new Date,this.scheduleConnectionCheck(),e.dispatch(t)}}),this.signalReady=new Promise(e=>{let t=()=>{this.signalWs.removeEventListener("open",t),this.keepAlive(),e(this.signalWs)};this.signalWs.addEventListener("open",t)})}}nL.NORMAL_CLOSURE=1e3,nL.ERROR_CONNECTION_UNHEALTHY=4001,nL.ERROR_CONNECTION_BROKEN=4002;let nB=async(e,t)=>{var i;let n;let s=0;do s>0&&await nE(n_(s)),n=await e(),t("trace","SFU RPC response received for ".concat(n.method.name),n),n.response.error&&t("error","SFU RPC Error (".concat(n.method.name,"):"),n.response.error),s++;while((null===(i=n.response.error)||void 0===i?void 0:i.shouldRetry)&&s<5);if(n.response.error)throw n.response.error;return n},nj=e=>async function(t){if("call.accepted"!==t.type||t.user.id===e.currentUserId)return;let{state:i}=e;t.call.created_by.id===e.currentUserId&&i.callingState===O.RINGING&&await e.join()},nF=e=>async function(t){if("call.rejected"!==t.type||t.user.id===e.currentUserId)return;let{call:i}=t,{session:n}=i;if(!n){e.logger("warn","No call session provided. Ignoring call.rejected event.",t);return}let s=n.rejected_by,{members:a,callingState:r}=e.state;if(r!==O.RINGING){e.logger("info","Call is not in ringing mode (it is either accepted or rejected already). Ignoring call.rejected event.",t);return}e.isCreatedByMe?a.filter(t=>t.user_id!==e.currentUserId).every(e=>s[e.user_id])&&(e.logger("info","everyone rejected, leaving the call"),await e.leave()):s[i.created_by.id]&&(e.logger("info","call creator rejected, leaving call"),await e.leave())},nW=e=>async function(t){if("call.ended"!==t.type)return;let{callingState:i}=e.state;(i===O.RINGING||i===O.JOINED||i===O.JOINING)&&await e.leave()},nV=e=>function(t){if("callGrantsUpdated"!==t.eventPayload.oneofKind)return;let{currentGrants:i}=t.eventPayload.callGrantsUpdated;if(i){let{canPublishAudio:t,canPublishVideo:n,canScreenshare:s}=i,a={[ef.SEND_AUDIO]:t,[ef.SEND_VIDEO]:n,[ef.SCREENSHARE]:s},r=e.ownCapabilities.filter(e=>!1!==a[e]);Object.entries(a).forEach(e=>{let[t,i]=e;i&&!r.includes(t)&&r.push(t)}),e.setOwnCapabilities(r)}},nM=iA(["events"]),nx=(e,t)=>e.on("changePublishQuality",e=>{if("changePublishQuality"!==e.eventPayload.oneofKind)return;let{videoSenders:i}=e.eventPayload.changePublishQuality;i.forEach(e=>{let{layers:i}=e;t.updatePublishQuality(i.filter(e=>e.active))})}),nH=(e,t)=>e.on("connectionQualityChanged",e=>{if("connectionQualityChanged"!==e.eventPayload.oneofKind)return;let{connectionQualityChanged:i}=e.eventPayload,{connectionQualityUpdates:n}=i;n&&t.updateParticipants(n.reduce((e,t)=>{let{sessionId:i,connectionQuality:n}=t;return e[i]={connectionQuality:n},e},{}))}),nz=(e,t)=>e.on("healthCheckResponse",e=>{if("healthCheckResponse"!==e.eventPayload.oneofKind)return;let{participantCount:i}=e.eventPayload.healthCheckResponse;i&&(t.setParticipantCount(i.total),t.setAnonymousParticipantCount(i.anonymous))}),nq=(e,t)=>e.on("error",e=>{"error"===e.eventPayload.oneofKind&&e.eventPayload.error.error&&e.eventPayload.error.error.code===I.LIVE_ENDED&&!t.permissionsContext.hasPermission(ef.JOIN_BACKSTAGE)&&t.leave()}),nK=e=>e.on("error",e=>{if("error"!==e.eventPayload.oneofKind||!e.eventPayload.error.error)return;let t=e.eventPayload.error.error;nM("error","SFU reported error",{code:I[t.code],message:t.message,shouldRetry:t.shouldRetry})}),nG=e=>function(t){if("pinsUpdated"!==t.eventPayload.oneofKind)return;let{pins:i}=t.eventPayload.pinsUpdated;e.setServerSidePins(i)},n$=e=>e.on("trackUnpublished",async t=>{if("trackUnpublished"!==t.eventPayload.oneofKind)return;let{trackUnpublished:{cause:i,type:n,sessionId:s}}=t.eventPayload,{localParticipant:a}=e.state;if(i===_.MODERATION&&s===(null==a?void 0:a.sessionId)){let t=e.logger;t("info","Local participant's ".concat(E[n]," track is muted remotely"));try{var r;n===E.VIDEO?await e.camera.disable():n===E.AUDIO?await e.microphone.disable():t("warn","Unsupported track type to soft mute",E[n]),(null===(r=e.publisher)||void 0===r?void 0:r.isPublishing(n))&&await e.stopPublish(n)}catch(e){t("error","Failed to stop publishing",e)}}}),nJ=e=>function(t){if("participantJoined"!==t.eventPayload.oneofKind)return;let{participant:i}=t.eventPayload.participantJoined;i&&e.updateOrAddParticipant(i.sessionId,Object.assign(i,{viewportVisibilityState:{videoTrack:U.UNKNOWN,screenShareTrack:U.UNKNOWN}}))},nQ=e=>function(t){if("participantLeft"!==t.eventPayload.oneofKind)return;let{participant:i}=t.eventPayload.participantLeft;i&&e.setParticipants(e=>e.filter(e=>e.sessionId!==i.sessionId))},nX=e=>function(t){if("trackPublished"!==t.eventPayload.oneofKind)return;let{trackPublished:{type:i,sessionId:n,participant:s}}=t.eventPayload;s?e.updateOrAddParticipant(n,s):e.updateParticipant(n,e=>({publishedTracks:[...e.publishedTracks,i].filter(nZ)}))},nY=e=>function(t){if("trackUnpublished"!==t.eventPayload.oneofKind)return;let{trackUnpublished:{type:i,sessionId:n,participant:s}}=t.eventPayload;s?e.updateOrAddParticipant(n,s):e.updateParticipant(n,e=>({publishedTracks:e.publishedTracks.filter(e=>e!==i)}))},nZ=(e,t,i)=>i.indexOf(e)===t,n0=(e,t)=>e.on("dominantSpeakerChanged",e=>{var i;if("dominantSpeakerChanged"!==e.eventPayload.oneofKind)return;let{dominantSpeakerChanged:{sessionId:n}}=e.eventPayload;n!==(null===(i=t.dominantSpeaker)||void 0===i?void 0:i.sessionId)&&t.setParticipants(e=>e.map(e=>e.sessionId===n?{...e,isDominantSpeaker:!0}:e.isDominantSpeaker?{...e,isDominantSpeaker:!1}:e))}),n1=(e,t)=>e.on("audioLevelChanged",e=>{if("audioLevelChanged"!==e.eventPayload.oneofKind)return;let{audioLevels:i}=e.eventPayload.audioLevelChanged;t.updateParticipants(i.reduce((e,t)=>(e[t.sessionId]={audioLevel:t.level,isSpeaking:t.isSpeaking},e),{}))}),n2=(e,t,i)=>{let n=[e.on("call.ended",nW(e)),nq(i,e),nK(i),nx(i,e),nH(i,t),nz(i,t),e.on("participantJoined",nJ(t)),e.on("participantLeft",nQ(t)),e.on("trackPublished",nX(t)),e.on("trackUnpublished",nY(t)),n1(i,t),n0(i,t),e.on("callGrantsUpdated",nV(t)),e.on("pinsUpdated",nG(t)),n$(e)];return e.ringing&&n.push(n3(e)),()=>{n.forEach(e=>e())}},n3=e=>{let t={"call.accepted":nj(e),"call.rejected":nF(e)},i=Object.keys(t).map(i=>e.on(i,t[i]));return()=>{i.forEach(e=>e())}},n9=async(e,t,i,n)=>{let{call:s,credentials:a,members:r,own_capabilities:o}=await n4(e,t,i,n);return{connectionConfig:n5(a.ice_servers),sfuServer:a.server,token:a.token,metadata:s,members:r,ownCapabilities:o}},n4=async(e,t,i,n)=>{let s=await e.getLocationHint(),a={...n,location:s};return e.post("/call/".concat(t,"/").concat(i,"/join"),a)},n5=e=>{if(e&&0!==e.length)return{iceServers:e.map(e=>({urls:e.urls,username:e.username,credential:e.password}))}},n6=e=>{let t,{subscriber:i,publisher:n,state:s,pollingIntervalInMs:a=2e3}=e,r=iA(["stats"]),o=async(e,t)=>"subscriber"===e&&i?i.getStats(t):"publisher"===e&&n?n.getStats(t):void r("warn","Can't retrieve RTC stats for ".concat(e)),l=async(e,t)=>{let s="subscriber"===e?i:n,a=[];for(let i of t.getTracks()){let t=n8(await s.getStats(i),{trackKind:i.kind,kind:e});a.push(t)}return a},c=new Set,d=async()=>{let e={},t=new Set(c);if(t.size>0)for(let i of s.participants){if(!t.has(i.sessionId))continue;let n=i.isLocalParticipant?"publisher":"subscriber";try{var a,d;let t=new MediaStream([...(null===(a=i.videoStream)||void 0===a?void 0:a.getVideoTracks())||[],...(null===(d=i.audioStream)||void 0===d?void 0:d.getAudioTracks())||[]]);e[i.sessionId]=await l(n,t),t.getTracks().forEach(e=>{t.removeTrack(e)})}catch(e){r("error","Failed to collect stats for ".concat(n," if ").concat(i.userId),e)}}let[h,u]=await Promise.all([i.getStats().then(e=>n8(e,{kind:"subscriber",trackKind:"video"})).then(n7),n.getStats().then(e=>n8(e,{kind:"publisher",trackKind:"video"})).then(n7)]),[p,g]=await Promise.all([o("subscriber"),o("publisher")]);s.setCallStatsReport({datacenter:n.sfuClient.edgeName,publisherStats:u,subscriberStats:h,subscriberRawStats:p,publisherRawStats:g,participants:e,timestamp:Date.now()})};if(a>0){let e=async()=>{await d().catch(e=>{r("debug","Failed to collect stats",e)}),t=setTimeout(e,a)};e()}return{getRawStatsForTrack:o,getStatsForStream:l,startReportingStatsFor:e=>{c.add(e),d()},stopReportingStatsFor:e=>{c.delete(e),d()},stop:()=>{t&&clearTimeout(t)}}},n8=(e,t)=>{let{trackKind:i,kind:n}=t,s="subscriber"===n?"inbound-rtp":"outbound-rtp",a=se(e);return{rawStats:e,streams:a.filter(e=>e.type===s&&e.kind===i).map(e=>{let t;let i=a.find(t=>"codec"===t.type&&t.id===e.codecId),n=a.find(t=>"transport"===t.type&&t.id===e.transportId);if(n&&"connected"===n.dtlsState){let e=a.find(e=>"candidate-pair"===e.type&&e.id===n.selectedCandidatePairId);t=null==e?void 0:e.currentRoundTripTime}return{bytesSent:e.bytesSent,bytesReceived:e.bytesReceived,codec:null==i?void 0:i.mimeType,currentRoundTripTime:t,frameHeight:e.frameHeight,frameWidth:e.frameWidth,framesPerSecond:e.framesPerSecond,jitter:e.jitter,kind:e.kind,qualityLimitationReason:e.qualityLimitationReason,rid:e.rid,ssrc:e.ssrc}}),timestamp:Date.now()}},n7=e=>{let t={rawReport:e,totalBytesSent:0,totalBytesReceived:0,averageJitterInMs:0,averageRoundTripTimeInMs:0,qualityLimitationReasons:"none",highestFrameWidth:0,highestFrameHeight:0,highestFramesPerSecond:0,timestamp:Date.now()},i=-1,n=(e,t)=>e*t,s=new Set,a=e.streams,r=a.reduce((e,t)=>{e.totalBytesSent+=t.bytesSent||0,e.totalBytesReceived+=t.bytesReceived||0,e.averageJitterInMs+=t.jitter||0,e.averageRoundTripTimeInMs+=t.currentRoundTripTime||0;let a=n(t.frameWidth||0,t.frameHeight||0);return a>i&&(e.highestFrameWidth=t.frameWidth||0,e.highestFrameHeight=t.frameHeight||0,e.highestFramesPerSecond=t.framesPerSecond||0,i=a),s.add(t.qualityLimitationReason||""),e},t);a.length>0&&(r.averageJitterInMs=Math.round(r.averageJitterInMs/a.length*1e3),r.averageRoundTripTimeInMs=Math.round(r.averageRoundTripTimeInMs/a.length*1e3));let o=[s.has("cpu")&&"cpu",s.has("bandwidth")&&"bandwidth",s.has("other")&&"other"].filter(Boolean).join(", ");return o&&(r.qualityLimitationReasons=o),r},se=e=>{let t=[];return e.forEach(e=>{t.push(e)}),t};class st{constructor(){this.elementHandlerMap=new Map,this.observer=null,this.queueSet=new Set,this.setViewport=(e,t)=>{var i;return this.observer=new IntersectionObserver(e=>{e.forEach(e=>{let t=this.elementHandlerMap.get(e.target);null==t||t(e)})},{root:e,...t,threshold:null!==(i=null==t?void 0:t.threshold)&&void 0!==i?i:.35}),this.queueSet.size&&(this.queueSet.forEach(t=>{let[i,n]=t;e.contains(i)&&(this.observer.observe(i),this.elementHandlerMap.set(i,n))}),this.queueSet.clear()),()=>{var e;null===(e=this.observer)||void 0===e||e.disconnect(),this.observer=null,this.elementHandlerMap.clear()}},this.observe=(e,t)=>{let i=[e,t];return this.elementHandlerMap.has(e)||(this.observer?this.observer.root.contains(e)&&(this.elementHandlerMap.set(e,t),this.observer.observe(e)):this.queueSet.add(i)),()=>{var t;this.elementHandlerMap.delete(e),null===(t=this.observer)||void 0===t||t.unobserve(e),this.queueSet.delete(i)}}}}let si=()=>"undefined"!=typeof navigator&&/^((?!chrome|android).)*safari/i.test(navigator.userAgent||""),sn=()=>{var e;return"undefined"!=typeof navigator&&(null===(e=navigator.userAgent)||void 0===e?void 0:e.includes("Firefox"))},ss={videoTrack:U.UNKNOWN,screenShareTrack:U.UNKNOWN};class sa{constructor(e){this.viewportTracker=new st,this.logger=iA(["DynascaleManager"]),this.trackElementVisibility=(e,t,i)=>{let n=this.viewportTracker.observe(e,n=>{this.call.state.updateParticipant(t,t=>{var s;let a=null!==(s=t.viewportVisibilityState)&&void 0!==s?s:ss,r=n.isIntersecting||document.fullscreenElement===e?U.VISIBLE:U.INVISIBLE;return{...t,viewportVisibilityState:{...a,[i]:r}}})});return()=>{n(),this.call.state.updateParticipant(t,e=>{var t;let n=null!==(t=e.viewportVisibilityState)&&void 0!==t?t:ss;return{...e,viewportVisibilityState:{...n,[i]:U.UNKNOWN}}})}},this.setViewport=e=>this.viewportTracker.setViewport(e),this.bindVideoElement=(e,t,i)=>{let n,s;let a=this.call.state.findParticipantBySessionId(t);if(!a)return;let r=(e,n)=>{n&&(0===n.width||0===n.height)&&(this.logger("debug","Ignoring 0x0 dimension",a),n=void 0),this.call.updateSubscriptionsPartial(i,{[t]:{dimension:n}},e)},o=this.call.state.participants$.pipe((0,Q.U)(e=>e.find(e=>e.sessionId===t)),(0,Z.o)(e=>!!e),(0,Y.x)(),(0,X.d)({bufferSize:1,refCount:!0})),l=a.isLocalParticipant?null:o.pipe((0,Q.U)(e=>{var t;return null===(t=e.viewportVisibilityState)||void 0===t?void 0:t[i]}),(0,Y.x)()).subscribe(t=>{if(!n){n=null!=t?t:U.UNKNOWN;return}if(n=null!=t?t:U.UNKNOWN,t===U.INVISIBLE)return r(A.MEDIUM,void 0);r(A.MEDIUM,{width:e.clientWidth,height:e.clientHeight})}),c=a.isLocalParticipant?null:new ResizeObserver(()=>{let t="".concat(e.clientWidth,",").concat(e.clientHeight);if(!s){s=t;return}s!==t&&n!==U.INVISIBLE&&(r(A.SLOW,{width:e.clientWidth,height:e.clientHeight}),s=t)});null==c||c.observe(e);let d=a.isLocalParticipant?null:o.pipe((0,ee.g)("publishedTracks"),(0,Q.U)(e=>e.publishedTracks.includes("videoTrack"===i?E.VIDEO:E.SCREEN_SHARE)),(0,Y.x)()).subscribe(t=>{t?r(A.FAST,{width:e.clientWidth,height:e.clientHeight}):r(A.FAST,void 0)});e.autoplay=!0,e.playsInline=!0,e.muted=!0;let h=o.pipe((0,ee.g)("videoTrack"===i?"videoStream":"screenShareStream")).subscribe(t=>{let n="videoTrack"===i?t.videoStream:t.screenShareStream;e.srcObject!==n&&(e.srcObject=null!=n?n:null,(si()||sn())&&setTimeout(()=>{e.srcObject=null!=n?n:null,e.play().catch(e=>{this.logger("warn","Failed to play stream",e)})},25))});return()=>{r(A.FAST,void 0),null==l||l.unsubscribe(),null==d||d.unsubscribe(),h.unsubscribe(),null==c||c.disconnect()}},this.bindAudioElement=(e,t,i)=>{let n=this.call.state.findParticipantBySessionId(t);if(!n||n.isLocalParticipant)return;let s=this.call.state.participants$.pipe((0,Q.U)(e=>e.find(e=>e.sessionId===t)),(0,Z.o)(e=>!!e),(0,Y.x)(),(0,X.d)({bufferSize:1,refCount:!0})).pipe((0,ee.g)("screenShareAudioTrack"===i?"screenShareAudioStream":"audioStream")).subscribe(t=>{let n="screenShareAudioTrack"===i?t.screenShareAudioStream:t.audioStream;e.srcObject!==n&&setTimeout(()=>{if(e.srcObject=null!=n?n:null,e.srcObject){e.play().catch(e=>{this.logger("warn","Failed to play stream",e)});let{selectedDevice:t}=this.call.speaker.state;t&&"setSinkId"in e&&e.setSinkId(t)}})}),a="setSinkId"in e?this.call.speaker.state.selectedDevice$.subscribe(t=>{t&&e.setSinkId(t)}):null,r=this.call.speaker.state.volume$.subscribe(t=>{e.volume=t});return e.autoplay=!0,()=>{null==a||a.unsubscribe(),r.unsubscribe(),s.unsubscribe()}},this.call=e}}class sr{constructor(){var e=this;this.permissions=[],this.setPermissions=e=>{this.permissions=e||[]},this.setCallSettings=e=>{this.settings=e},this.hasPermission=e=>this.permissions.includes(e),this.canRequest=function(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.settings;if(!i)return!1;let{audio:n,video:s,screensharing:a}=i;switch(t){case ef.SEND_AUDIO:return n.access_request_enabled;case ef.SEND_VIDEO:return s.access_request_enabled;case ef.SCREENSHARE:return a.access_request_enabled;default:return!1}}}}class so{constructor(e,t={sortParticipantsBy:nc}){this.name=e,this.options=t}}class sl{constructor(e){this.register=e=>{this.callTypes[e.name]=e},this.unregister=e=>{delete this.callTypes[e]},this.get=e=>(this.callTypes[e]||this.register(new so(e)),this.callTypes[e]),this.callTypes=e.reduce((e,t)=>(e[t.name]=t,e),{})}}let sc=new sl([new so("default",{sortParticipantsBy:nc}),new so("development",{sortParticipantsBy:nc}),new so("livestream",{sortParticipantsBy:nd}),new so("audio_room",{sortParticipantsBy:nd})]),sd=(e,t)=>new et.y(i=>{(async()=>{let i=await navigator.mediaDevices.enumerateDevices();if(i.some(e=>e.kind===t&&""===e.label)){let t;try{t=await navigator.mediaDevices.getUserMedia(e),i=await navigator.mediaDevices.enumerateDevices()}finally{t&&sI(t)}}return i})().then(e=>{i.next(e),i.complete()}).catch(e=>{iA(["devices"])("error","Failed to enumerate devices",e),i.error(e)})}),sh=()=>"undefined"!=typeof document&&"setSinkId"in document.createElement("audio"),su={audio:{autoGainControl:!0,noiseSuppression:!0,echoCancellation:!0}},sp={video:{width:1280,height:720}},sg=e=>{let t;return()=>(t||(t=e()),t)},sm=sg(()=>new et.y(e=>{if(!navigator.mediaDevices.addEventListener)return;let t=()=>e.next();return navigator.mediaDevices.addEventListener("devicechange",t),()=>{navigator.mediaDevices.removeEventListener("devicechange",t)}}).pipe((0,ei.b)(500),(0,en.b)(()=>(0,es.D)(navigator.mediaDevices.enumerateDevices())),(0,X.d)(1))),sf=sg(()=>(0,ea.T)(sd(su,"audioinput"),sm()).pipe((0,X.d)(1))),sy=sg(()=>(0,ea.T)(sd(su,"audiooutput"),sm()).pipe((0,X.d)(1))),sb=sg(()=>(0,ea.T)(sd(sp,"videoinput"),sm()).pipe((0,X.d)(1))),sv=()=>sf().pipe((0,Q.U)(e=>e.filter(e=>"audioinput"===e.kind))),sk=()=>sb().pipe((0,Q.U)(e=>e.filter(e=>"videoinput"===e.kind))),sw=()=>sy().pipe((0,Q.U)(e=>e.filter(e=>"audiooutput"===e.kind))),sT=async e=>{try{return await navigator.mediaDevices.getUserMedia(e)}catch(t){throw iA(["devices"])("error","Failed get user media",{error:t,constraints:e}),t}},sC=async e=>sT({audio:{...su.audio,...e}}),sS=async e=>sT({video:{...sp.video,...e}}),sR=async e=>{try{return await navigator.mediaDevices.getDisplayMedia({video:!0,audio:{channelCount:{ideal:2},echoCancellation:!1,autoGainControl:!1,noiseSuppression:!1},systemAudio:"include",...e})}catch(e){throw iA(["devices"])("error","Failed to get screen share stream",e),e}},sE="undefined"!=typeof navigator&&void 0!==navigator.mediaDevices?sg(()=>(0,ea.T)((0,es.D)(navigator.mediaDevices.enumerateDevices()),sm()).pipe((0,X.d)(1)))():void 0,sI=e=>{e.active&&(e.getTracks().forEach(t=>{t.stop(),e.removeTrack(t)}),"function"==typeof e.release&&e.release())};class sD{listDevices(){return this.getDevices()}async enable(){if("enabled"!==this.state.status){this.enablePromise=this.unmuteStream();try{await this.enablePromise,this.state.setStatus("enabled"),this.enablePromise=void 0}catch(e){throw this.enablePromise=void 0,e}}}async disable(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.state.prevStatus=this.state.status,!e&&"disabled"===this.state.status)return;let t=e||"stop-tracks"===this.state.disableMode;this.disablePromise=this.muteStream(t);try{await this.disablePromise,this.state.setStatus("disabled"),this.disablePromise=void 0}catch(e){throw this.disablePromise=void 0,e}}async resume(){"enabled"===this.state.prevStatus&&"disabled"===this.state.status&&await this.enable()}async toggle(){return"enabled"===this.state.status?this.disable():this.enable()}setDefaultConstraints(e){this.state.setDefaultConstraints(e)}async select(e){if(iI())throw Error("This method is not supported in React Native");e!==this.state.selectedDevice&&(this.state.setDevice(e),await this.applySettingsToStream())}async applySettingsToStream(){"enabled"===this.state.status&&(await this.muteStream(),await this.unmuteStream())}getTracks(){var e,t;return null!==(t=null===(e=this.state.mediaStream)||void 0===e?void 0:e.getTracks())&&void 0!==t?t:[]}async muteStream(){let e=!(arguments.length>0)||void 0===arguments[0]||arguments[0];this.state.mediaStream&&(this.logger("debug","".concat(e?"Stopping":"Disabling"," stream")),this.call.state.callingState===O.JOINED&&await this.stopPublishStream(e),this.muteLocalStream(e),this.getTracks().every(e=>"ended"===e.readyState)&&(this.state.mediaStream&&"function"==typeof this.state.mediaStream.release&&this.state.mediaStream.release(),this.state.setMediaStream(void 0)))}muteTracks(){this.getTracks().forEach(e=>{e.enabled&&(e.enabled=!1)})}unmuteTracks(){this.getTracks().forEach(e=>{e.enabled||(e.enabled=!0)})}stopTracks(){this.getTracks().forEach(e=>{"live"===e.readyState&&e.stop()})}muteLocalStream(e){this.state.mediaStream&&(e?this.stopTracks():this.muteTracks())}async unmuteStream(){let e;if(this.logger("debug","Starting stream"),this.state.mediaStream&&this.getTracks().every(e=>"live"===e.readyState))e=this.state.mediaStream,this.unmuteTracks();else{let t={...this.state.defaultConstraints,deviceId:this.state.selectedDevice};e=await this.getStream(t)}this.call.state.callingState===O.JOINED&&await this.publishStream(e),this.state.mediaStream!==e&&(this.state.setMediaStream(e),this.getTracks().forEach(e=>{e.addEventListener("ended",async()=>{this.enablePromise&&await this.enablePromise,this.disablePromise&&await this.disablePromise,"enabled"===this.state.status&&(this.isTrackStoppedDueToTrackEnd=!0,setTimeout(()=>{this.isTrackStoppedDueToTrackEnd=!1},2e3),await this.disable())})}))}get mediaDeviceKind(){return this.trackType===E.AUDIO?"audioinput":this.trackType===E.VIDEO?"videoinput":""}handleDisconnectedOrReplacedDevices(){this.subscriptions.push((0,$.a)([sE.pipe((0,er.G)()),this.state.selectedDevice$]).subscribe(async e=>{let[[t,i],n]=e;if(!n)return;this.enablePromise&&await this.enablePromise,this.disablePromise&&await this.disablePromise;let s=!1,a=!1,r=this.findDeviceInList(i,n),o=this.findDeviceInList(t,n);!r&&o?s=!0:r&&o&&r.deviceId===o.deviceId&&r.groupId!==o.groupId&&(a=!0),s&&(await this.disable(),this.select(void 0)),a&&(this.isTrackStoppedDueToTrackEnd&&"disabled"===this.state.status?(await this.enable(),this.isTrackStoppedDueToTrackEnd=!1):await this.applySettingsToStream())}))}findDeviceInList(e,t){return e.find(e=>e.deviceId===t&&e.kind===this.mediaDeviceKind)}constructor(e,t,i){this.call=e,this.state=t,this.trackType=i,this.stopOnLeave=!0,this.subscriptions=[],this.isTrackStoppedDueToTrackEnd=!1,this.removeSubscriptions=()=>{this.subscriptions.forEach(e=>e.unsubscribe())},this.logger=iA(["".concat(E[i].toLowerCase()," manager")]),sE&&!iI()&&(this.trackType===E.AUDIO||this.trackType===E.VIDEO)&&this.handleDisconnectedOrReplacedDevices()}}class s_{get status(){return this.getCurrentValue(this.status$)}get selectedDevice(){return this.getCurrentValue(this.selectedDevice$)}get mediaStream(){return this.getCurrentValue(this.mediaStream$)}setStatus(e){this.setCurrentValue(this.statusSubject,e)}setMediaStream(e){this.setCurrentValue(this.mediaStreamSubject,e),e&&this.setDevice(this.getDeviceIdFromStream(e))}setDevice(e){this.setCurrentValue(this.selectedDeviceSubject,e)}get defaultConstraints(){return this.getCurrentValue(this.defaultConstraints$)}setDefaultConstraints(e){this.setCurrentValue(this.defaultConstraintsSubject,e)}constructor(e="stop-tracks",t){this.disableMode=e,this.permissionName=t,this.statusSubject=new J.X(void 0),this.mediaStreamSubject=new J.X(void 0),this.selectedDeviceSubject=new J.X(void 0),this.defaultConstraintsSubject=new J.X(void 0),this.mediaStream$=this.mediaStreamSubject.asObservable(),this.selectedDevice$=this.selectedDeviceSubject.asObservable().pipe((0,Y.x)()),this.status$=this.statusSubject.asObservable().pipe((0,Y.x)()),this.defaultConstraints$=this.defaultConstraintsSubject.asObservable(),this.hasBrowserPermission$=new et.y(e=>{var t,i;let n;let s=()=>e.next(!0),a=!!(null===(i=navigator)||void 0===i?void 0:null===(t=i.permissions)||void 0===t?void 0:t.query);if(iI()||!this.permissionName||!a)return iA(["devices"])("warn","Permissions can't be queried. Assuming granted."),s();let r=()=>e.next("granted"===n.state);return navigator.permissions.query({name:this.permissionName}).then(e=>{(n=e).addEventListener("change",r),r()}).catch(()=>{s()}),()=>{null==n||n.removeEventListener("change",r)}}).pipe((0,X.d)(1)),this.getCurrentValue=i0,this.setCurrentValue=i1}}class sP extends s_{get direction(){return this.getCurrentValue(this.direction$)}setDirection(e){this.setCurrentValue(this.directionSubject,e)}setMediaStream(e){if(super.setMediaStream(e),e){var t;let i=iI()?this.direction:(null===(t=e.getVideoTracks()[0])||void 0===t?void 0:t.getSettings().facingMode)==="environment"?"back":"front";this.setDirection(i)}}getDeviceIdFromStream(e){var t;return null===(t=e.getVideoTracks()[0])||void 0===t?void 0:t.getSettings().deviceId}constructor(){super("stop-tracks","camera"),this.directionSubject=new J.X(void 0),this.direction$=this.directionSubject.asObservable().pipe((0,Y.x)())}}class sN extends sD{async selectDirection(e){this.state.setDirection(e),this.state.setDevice(void 0),await this.applySettingsToStream()}async flip(){let e="front"===this.state.direction?"back":"front";await this.selectDirection(e)}async selectTargetResolution(e){if(this.targetResolution.height=e.height,this.targetResolution.width=e.width,this.enablePromise)try{await this.enablePromise}catch(e){this.logger("warn","could not apply target resolution",e)}if("enabled"===this.state.status){var t;let{width:e,height:i}=null===(t=this.state.mediaStream.getVideoTracks()[0])||void 0===t?void 0:t.getSettings();(e!==this.targetResolution.width||i!==this.targetResolution.height)&&(await this.applySettingsToStream(),this.logger("debug","".concat(e,"x").concat(i," target resolution applied to media stream")))}}setPreferredCodec(e){this.preferredCodec=e}getDevices(){return sk()}getStream(e){return e.width=this.targetResolution.width,e.height=this.targetResolution.height,!e.deviceId&&this.state.direction&&(e.facingMode="front"===this.state.direction?"user":"environment"),sS(e)}publishStream(e){return this.call.publishVideoStream(e,{preferredCodec:this.preferredCodec})}stopPublishStream(e){return this.call.stopPublish(E.VIDEO,e)}constructor(e){super(e,new sP,E.VIDEO),this.targetResolution={width:1280,height:720}}}class sU extends s_{get speakingWhileMuted(){return this.getCurrentValue(this.speakingWhileMuted$)}setSpeakingWhileMuted(e){this.setCurrentValue(this.speakingWhileMutedSubject,e)}getDeviceIdFromStream(e){var t;return null===(t=e.getAudioTracks()[0])||void 0===t?void 0:t.getSettings().deviceId}constructor(){super("disable-tracks","microphone"),this.speakingWhileMutedSubject=new J.X(!1),this.speakingWhileMuted$=this.speakingWhileMutedSubject.asObservable().pipe((0,Y.x)())}}let sA=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},{detectionFrequencyInMs:n=500,audioLevelThreshold:s=150,fftSize:a=128,destroyStreamOnStop:r=!0}=i,o=new AudioContext,l=o.createAnalyser();l.fftSize=a;let c=o.createMediaStreamSource(e);c.connect(l);let d=setInterval(()=>{var i;let n=new Uint8Array(l.frequencyBinCount);l.getByteFrequencyData(n);let a=n.some(e=>e>=s),r=n.reduce((e,t)=>e+t,0)/n.length;(null===(i=e.getAudioTracks()[0])||void 0===i?void 0:i.enabled)?t({isSoundDetected:a,audioLevel:r>s?100:Math.round(r/s*100)}):t({isSoundDetected:!1,audioLevel:0})},n);return async function(){clearInterval(d),c.disconnect(),l.disconnect(),await o.close(),r&&e.getTracks().forEach(t=>{t.stop(),e.removeTrack(t)})}},sO=e=>{let t=[];return e.forEach(e=>{t.push(e)}),t};class sL{async start(){try{let e=await navigator.mediaDevices.getUserMedia({audio:!0});this.pc1.addEventListener("icecandidate",async e=>{await this.pc2.addIceCandidate(e.candidate)}),this.pc2.addEventListener("icecandidate",async e=>{await this.pc1.addIceCandidate(e.candidate)}),e.getTracks().forEach(t=>this.pc1.addTrack(t,e));let t=await this.pc1.createOffer({});await this.pc2.setRemoteDescription(t),await this.pc1.setLocalDescription(t);let i=await this.pc2.createAnswer();await this.pc1.setRemoteDescription(i),await this.pc2.setLocalDescription(i),e.getAudioTracks().forEach(e=>e.enabled=!1)}catch(e){console.error("Error connecting and negotiating between PeerConnections:",e)}}stop(){this.pc1.close(),this.pc2.close(),this.intervalId&&clearInterval(this.intervalId)}onSpeakingDetectedStateChange(e){return this.intervalId=setInterval(async()=>{let t=sO(await this.pc1.getStats()).find(e=>"media-source"===e.type&&"audio"===e.kind);if(t){let{audioLevel:i}=t;i&&(i>=.2?e({isSoundDetected:!0,audioLevel:i}):e({isSoundDetected:!1,audioLevel:0}))}},1e3),()=>{clearInterval(this.intervalId)}}constructor(){this.pc1=new RTCPeerConnection({}),this.pc2=new RTCPeerConnection({})}}class sB extends sD{getDevices(){return sv()}getStream(e){return sC(e)}publishStream(e){return this.call.publishAudioStream(e)}stopPublishStream(e){return this.call.stopPublish(E.AUDIO,e)}async startSpeakingWhileMutedDetection(e){if(await this.stopSpeakingWhileMutedDetection(),iI()){var t;this.rnSpeechDetector=new sL,await this.rnSpeechDetector.start();let e=null===(t=this.rnSpeechDetector)||void 0===t?void 0:t.onSpeakingDetectedStateChange(e=>{this.state.setSpeakingWhileMuted(e.isSoundDetected)});this.soundDetectorCleanup=()=>{var t;e(),null===(t=this.rnSpeechDetector)||void 0===t||t.stop(),this.rnSpeechDetector=void 0}}else{let t=await this.getStream({deviceId:e});this.soundDetectorCleanup=sA(t,e=>{this.state.setSpeakingWhileMuted(e.isSoundDetected)})}}async stopSpeakingWhileMutedDetection(){if(this.soundDetectorCleanup){this.state.setSpeakingWhileMuted(!1);try{await this.soundDetectorCleanup()}finally{this.soundDetectorCleanup=void 0}}}constructor(e){super(e,new sU,E.AUDIO),(0,$.a)([this.call.state.callingState$,this.call.state.ownCapabilities$,this.state.selectedDevice$,this.state.status$]).subscribe(async e=>{let[t,i,n,s]=e;if(t!==O.JOINED){t===O.LEFT&&await this.stopSpeakingWhileMutedDetection();return}i.includes(ef.SEND_AUDIO)&&"disabled"===s?await this.startSpeakingWhileMutedDetection(n):await this.stopSpeakingWhileMutedDetection()})}}class sj extends s_{get audioEnabled(){return this.getCurrentValue(this.audioEnabled$)}setAudioEnabled(e){this.setCurrentValue(this.audioEnabledSubject,e)}get settings(){return this.getCurrentValue(this.settings$)}setSettings(e){this.setCurrentValue(this.settingsSubject,e)}constructor(){super(...arguments),this.audioEnabledSubject=new J.X(!0),this.settingsSubject=new J.X(void 0),this.audioEnabled$=this.audioEnabledSubject.asObservable().pipe((0,Y.x)()),this.settings$=this.settingsSubject.asObservable(),this.getDeviceIdFromStream=e=>{let[t]=e.getTracks();return null==t?void 0:t.getSettings().deviceId}}}class sF extends sD{enableScreenShareAudio(){this.state.setAudioEnabled(!0)}async disableScreenShareAudio(){var e;this.state.setAudioEnabled(!1),(null===(e=this.call.publisher)||void 0===e?void 0:e.isPublishing(E.SCREEN_SHARE_AUDIO))&&await this.call.stopPublish(E.SCREEN_SHARE_AUDIO,!0)}getSettings(){return this.state.settings}setSettings(e){this.state.setSettings(e)}getDevices(){return(0,eo.of)([])}getStream(e){return this.state.audioEnabled||(e.audio=!1),sR(e)}publishStream(e){return this.call.publishScreenShareStream(e,{screenShareSettings:this.state.settings})}async stopPublishStream(e){await this.call.stopPublish(E.SCREEN_SHARE,e),await this.call.stopPublish(E.SCREEN_SHARE_AUDIO,e)}async select(e){throw Error("This method is not supported in for Screen Share")}constructor(e){super(e,new sj,E.SCREEN_SHARE)}}class sW{get selectedDevice(){return this.getCurrentValue(this.selectedDevice$)}get volume(){return this.getCurrentValue(this.volume$)}setDevice(e){this.setCurrentValue(this.selectedDeviceSubject,e)}setVolume(e){this.setCurrentValue(this.volumeSubject,e)}constructor(){this.selectedDeviceSubject=new J.X(""),this.volumeSubject=new J.X(1),this.isDeviceSelectionSupported=sh(),this.getCurrentValue=i0,this.setCurrentValue=i1,this.selectedDevice$=this.selectedDeviceSubject.asObservable().pipe((0,Y.x)()),this.volume$=this.volumeSubject.asObservable().pipe((0,Y.x)())}}class sV{listDevices(){return sw()}select(e){if(iI())throw Error("This feature is not supported in React Native");this.state.setDevice(e)}setVolume(e){if(iI())throw Error("This feature is not supported in React Native");if(e&&(e<0||e>1))throw Error("Volume must be between 0 and 1");this.state.setVolume(e)}constructor(){this.state=new sW,this.subscriptions=[],this.removeSubscriptions=()=>{this.subscriptions.forEach(e=>e.unsubscribe())},sE&&!iI()&&this.subscriptions.push((0,$.a)([sE,this.state.selectedDevice$]).subscribe(e=>{let[t,i]=e;i&&(t.find(e=>e.deviceId===i&&"audiooutput"===e.kind)||this.select(""))}))}}class sM{registerEffects(){this.leaveCallHooks.add(i2(this.state.settings$,e=>{e&&this.permissionsContext.setCallSettings(e)})),this.leaveCallHooks.add(i2(this.state.ownCapabilities$,e=>{if(this.permissionsContext.setPermissions(e),this.publisher)for(let[e,t]of Object.entries({[ef.SEND_AUDIO]:E.AUDIO,[ef.SEND_VIDEO]:E.VIDEO,[ef.SCREENSHARE]:E.SCREEN_SHARE}))!this.permissionsContext.hasPermission(e)&&(this.publisher.isPublishing(t)||this.publisher.isLive(t))&&this.stopPublish(t).catch(e=>{this.logger("error","Error stopping publish ".concat(t),e)}).then(()=>{t===E.VIDEO&&"enabled"===this.camera.state.status&&this.camera.disable().catch(e=>this.logger("error","Error disabling camera after permission revoked",e)),t===E.AUDIO&&"enabled"===this.microphone.state.status&&this.microphone.disable().catch(e=>this.logger("error","Error disabling microphone after permission revoked",e))})})),this.leaveCallHooks.add(i2(this.state.blockedUserIds$,async e=>{if(!e||0===e.length)return;let t=this.currentUserId;t&&e.includes(t)&&(this.logger("info","Leaving call because of being blocked"),await this.leave())})),this.leaveCallHooks.add(i2(this.state.callingState$,e=>{this.ringing&&(e===O.JOINED||e===O.JOINING||e===O.LEFT)&&(clearTimeout(this.dropTimeout),this.dropTimeout=void 0)})),this.leaveCallHooks.add(i2(this.ringingSubject,e=>{e&&(this.scheduleAutoDrop(),this.state.callingState===O.IDLE&&this.state.setCallingState(O.RINGING),this.leaveCallHooks.add(n3(this)))}))}on(e,t){if(ij(e))return this.dispatcher.on(e,t);{let i=e=>{e.call_cid&&e.call_cid===this.cid&&t(e)};return this.streamClientEventHandlers.set(t,i),this.streamClient.on(e,i)}}off(e,t){if(ij(e))return this.dispatcher.off(e,t);{let i=this.streamClientEventHandlers.get(t);if(i)return this.streamClient.off(e,i)}}get ringing(){return i0(this.ringingSubject)}get currentUserId(){var e;return null===(e=this.clientStore.connectedUser)||void 0===e?void 0:e.id}get isCreatedByMe(){var e;return(null===(e=this.state.createdBy)||void 0===e?void 0:e.id)===this.currentUserId}async initCamera(e){var t,i,n,s,a;if(this.camera.enablePromise&&await this.camera.enablePromise,this.camera.disablePromise&&await this.camera.disablePromise,(null===(t=this.state.localParticipant)||void 0===t?void 0:t.videoStream)||!this.permissionsContext.hasPermission("send-video"))return;if(!this.camera.state.direction&&!this.camera.state.selectedDevice){let e="front",t=null===(n=this.state.settings)||void 0===n?void 0:n.video.camera_facing;t&&(e="front"===t?"front":"back"),this.camera.state.setDirection(e)}let r=null===(i=this.state.settings)||void 0===i?void 0:i.video.target_resolution;r&&await this.camera.selectTargetResolution(r),e.setStatus&&("enabled"!==this.camera.state.status||!this.camera.state.mediaStream||(null===(s=this.publisher)||void 0===s?void 0:s.isPublishing(E.VIDEO))||await this.publishVideoStream(this.camera.state.mediaStream,{preferredCodec:this.camera.preferredCodec}),void 0===this.camera.state.status&&(null===(a=this.state.settings)||void 0===a?void 0:a.video.camera_default_on)&&await this.camera.enable())}async initMic(e){var t,i,n;this.microphone.enablePromise&&await this.microphone.enablePromise,this.microphone.disablePromise&&await this.microphone.disablePromise,(null===(t=this.state.localParticipant)||void 0===t||!t.audioStream)&&this.permissionsContext.hasPermission("send-audio")&&e.setStatus&&("enabled"!==this.microphone.state.status||!this.microphone.state.mediaStream||(null===(i=this.publisher)||void 0===i?void 0:i.isPublishing(E.AUDIO))||await this.publishAudioStream(this.microphone.state.mediaStream),void 0===this.microphone.state.status&&(null===(n=this.state.settings)||void 0===n?void 0:n.audio.mic_default_on)&&await this.microphone.enable())}constructor({type:e,id:t,streamClient:i,members:n,ownCapabilities:s,sortParticipantsBy:a,clientStore:r,ringing:o=!1,watching:l=!1}){var c=this;this.state=new nh,this.dynascaleManager=new sa(this),this.permissionsContext=new sr,this.dispatcher=new iF,this.trackSubscriptionsSubject=new J.X({type:A.MEDIUM,data:[]}),this.reconnectAttempts=0,this.maxReconnectAttempts=10,this.leaveCallHooks=new Set,this.streamClientEventHandlers=new Map,this.leave=async function(){var e,t,i,n;let{reject:s=!1}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},a=c.state.callingState;if(a===O.LEFT)throw Error("Cannot leave call that has already been left.");if(a===O.JOINING&&await c.assertCallJoined(),c.ringing){let e=c.state.remoteParticipants.length>0;c.isCreatedByMe&&!e?await c.reject():s&&a===O.RINGING&&await c.reject()}null===(e=c.statsReporter)||void 0===e||e.stop(),c.statsReporter=void 0,null===(t=c.subscriber)||void 0===t||t.close(),c.subscriber=void 0,null===(i=c.publisher)||void 0===i||i.close(),c.publisher=void 0,null===(n=c.sfuClient)||void 0===n||n.close(),c.sfuClient=void 0,c.dispatcher.offAll(),c.state.setCallingState(O.LEFT),c.leaveCallHooks.forEach(e=>e()),c.clientStore.unregisterCall(c),c.camera.removeSubscriptions(),c.microphone.removeSubscriptions(),c.screenShare.removeSubscriptions(),c.speaker.removeSubscriptions();let r=[];c.camera.stopOnLeave&&r.push(c.camera.disable(!0)),c.microphone.stopOnLeave&&r.push(c.microphone.disable(!0)),c.screenShare.stopOnLeave&&r.push(c.screenShare.disable(!0)),await Promise.all(r)},this.get=async e=>{let t=await this.streamClient.get(this.streamClientBasePath,e);return(null==e?void 0:e.ring)&&!this.ringing&&this.ringingSubject.next(!0),this.state.updateFromCallResponse(t.call),this.state.setMembers(t.members),this.state.setOwnCapabilities(t.own_capabilities),this.streamClient._hasConnectionID()&&(this.watching=!0,this.clientStore.registerCall(this)),this.applyDeviceConfig(),t},this.getOrCreate=async e=>{let t=await this.streamClient.post(this.streamClientBasePath,e);return(null==e?void 0:e.ring)&&!this.ringing&&this.ringingSubject.next(!0),this.state.updateFromCallResponse(t.call),this.state.setMembers(t.members),this.state.setOwnCapabilities(t.own_capabilities),this.streamClient._hasConnectionID()&&(this.watching=!0,this.clientStore.registerCall(this)),this.applyDeviceConfig(),t},this.create=async e=>this.getOrCreate(e),this.ring=async()=>await this.get({ring:!0}),this.notify=async()=>await this.get({notify:!0}),this.accept=async()=>this.streamClient.post("".concat(this.streamClientBasePath,"/accept")),this.reject=async()=>this.streamClient.post("".concat(this.streamClientBasePath,"/reject")),this.join=async e=>{let t,i,n;var s,a,r,o,l=this;let c=this.state.callingState;if([O.JOINED,O.JOINING].includes(c))throw this.logger("warn","Join method called twice, you should only call this once"),Error("Illegal State: Already joined.");if(c===O.LEFT)throw Error("Illegal State: Cannot join already left call. Create a new Call instance to join a call.");let d=c===O.MIGRATING,h=c===O.RECONNECTING;this.state.setCallingState(O.JOINING),this.logger("debug","Starting join flow"),(null==e?void 0:e.ring)&&!this.ringing&&this.ringingSubject.next(!0),this.ringing&&!this.isCreatedByMe&&await this.accept();try{if(null===(a=this.sfuClient)||void 0===a?void 0:a.isFastReconnecting)n=null===(r=this.publisher)||void 0===r?void 0:r.connectionConfiguration,t=this.sfuClient.sfuServer,i=this.sfuClient.token;else{let s=await n9(this.streamClient,this.type,this.id,e);this.state.updateFromCallResponse(s.metadata),this.state.setMembers(s.members),this.state.setOwnCapabilities(s.ownCapabilities),n=s.connectionConfig,t=s.sfuServer,i=s.token}this.streamClient._hasConnectionID()&&(this.watching=!0,this.clientStore.registerCall(this))}catch(e){throw this.state.setCallingState(c),e}let u=this.sfuClient,p=this.sfuClient=new nL({dispatcher:this.dispatcher,sfuServer:t,token:i,sessionId:null==u?void 0:u.sessionId}),g=async function(){let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"full",n=l.state.callingState;if(n===O.MIGRATING||n===O.RECONNECTING)return;l.reconnectAttempts++,l.state.setCallingState("migrate"===i?O.MIGRATING:O.RECONNECTING),"migrate"===i?(l.logger("debug","[Migration]: migrating call ".concat(l.cid," away from ").concat(t.edge_name)),p.isMigratingAway=!0):l.logger("debug","[Rejoin]: ".concat(i," rejoin call ").concat(l.cid," (").concat(l.reconnectAttempts,")..."));let s=l.state.localParticipant;if("fast"===i)p.close(nL.ERROR_CONNECTION_BROKEN,"js-client: attempting fast reconnect");else if("full"===i){var a,r,o;await nE(n_(l.reconnectAttempts)),null===(a=l.subscriber)||void 0===a||a.close(),l.subscriber=void 0,null===(r=l.publisher)||void 0===r||r.close({stopTracks:!1}),l.publisher=void 0,null===(o=l.statsReporter)||void 0===o||o.stop(),l.statsReporter=void 0,p.close(nL.NORMAL_CLOSURE,"js-client: attempting full reconnect")}if(await l.join({...e,..."migrate"===i&&{migrating_from:t.edge_name}}),"migrate"===i&&p.close(nL.NORMAL_CLOSURE,"js-client: attempting migration"),l.logger("info","[Rejoin]: Attempt ".concat(l.reconnectAttempts," successful!")),s&&"full"===i){let e;let{audioStream:t,videoStream:i,screenShareStream:n,screenShareAudioStream:a}=s;(n||a)&&(e=new MediaStream,null==n||n.getVideoTracks().forEach(t=>{null==e||e.addTrack(t)}),null==a||a.getAudioTracks().forEach(t=>{null==e||e.addTrack(t)})),t&&await l.publishAudioStream(t),i&&await l.publishVideoStream(i,{preferredCodec:l.camera.preferredCodec}),e&&await l.publishScreenShareStream(e),l.logger("info","[Rejoin]: State restored. Attempt: ".concat(l.reconnectAttempts))}};p.signalReady.then(()=>{let e=this.dispatcher.on("goAway",e=>{if("goAway"!==e.eventPayload.oneofKind)return;let{reason:t}=e.eventPayload.goAway;this.logger("info","[Migration]: Going away from SFU... Reason: ".concat(P[t])),g("migrate").catch(e=>{this.logger("warn","[Migration]: Failed to migrate to another SFU.",e)})});p.signalWs.addEventListener("close",t=>{if(e(),t.code===nL.NORMAL_CLOSURE||t.code===nD.WS_POLICY_VIOLATION)return;let i=t.code===nD.WS_CLOSED_ABRUPTLY&&p.isMigratingAway,n=t.code===nD.WS_CLOSED_ABRUPTLY&&p.isFastReconnecting;if(!i&&!n&&t.code!==nL.ERROR_CONNECTION_BROKEN){if(this.reconnectAttempts<this.maxReconnectAttempts){p.isFastReconnecting=0===this.reconnectAttempts;let e=p.isFastReconnecting?"fast":"full";g(e).catch(t=>{this.logger("error","[Rejoin]: ".concat(e," rejoin failed for ").concat(this.reconnectAttempts," times. Giving up."),t),this.state.setCallingState(O.RECONNECTING_FAILED)})}else this.logger("error","[Rejoin]: Reconnect attempts exceeded. Giving up..."),this.state.setCallingState(O.RECONNECTING_FAILED)}})});let m=this.streamClient.on("connection.changed",async e=>{if("connection.changed"!==e.type||!e.online)return;m();let t=this.state.callingState;if(!(t===O.OFFLINE||t===O.RECONNECTING_FAILED))return;this.logger("info","[Rejoin]: Going online...");let i=!0;do{try{p.isFastReconnecting=i,await g(i?"fast":"full");return}catch(e){this.logger("error","[Rejoin][Network]: Rejoin failed for attempt ".concat(this.reconnectAttempts),e)}await nE(n_(this.reconnectAttempts)),i=!1}while(this.reconnectAttempts<this.maxReconnectAttempts);this.logger("error","[Rejoin][Network]: Rejoin failed. Giving up."),this.state.setCallingState(O.RECONNECTING_FAILED)}),f=this.streamClient.on("connection.changed",e=>{"connection.changed"===e.type&&(e.online||(f(),this.state.setCallingState(O.OFFLINE)))});this.leaveCallHooks.add(()=>{m(),f()}),this.subscriber||(this.subscriber=new nS({sfuClient:p,dispatcher:this.dispatcher,state:this.state,connectionConfig:n}));let y=null===(s=this.state.settings)||void 0===s?void 0:s.audio,b=!!(null==y?void 0:y.opus_dtx_enabled),v=!!(null==y?void 0:y.redundant_coding_enabled);this.publisher||(this.publisher=new nT({sfuClient:p,dispatcher:this.dispatcher,state:this.state,connectionConfig:n,isDtxEnabled:b,isRedEnabled:v})),this.statsReporter||(this.statsReporter=n6({subscriber:this.subscriber,publisher:this.publisher,state:this.state}));try{p.signalReady.catch(e=>this.logger("error","Signal ready failed",e)).then(()=>iL("recvonly")).then(t=>{var i,n;let s=i0(this.trackSubscriptionsSubject),a=d?{fromSfuId:(null==e?void 0:e.migrating_from)||"",subscriptions:s.data||[],announcedTracks:(null===(i=this.publisher)||void 0===i?void 0:i.getCurrentTrackInfos())||[]}:void 0;return p.join({subscriberSdp:t||"",clientDetails:iq(),migration:a,fastReconnect:null!==(n=null==u?void 0:u.isFastReconnecting)&&void 0!==n&&n})});let{callState:t,reconnected:i}=await this.waitForJoinResponse();if(h&&this.logger("debug","[Rejoin] fast reconnected:",i),d)await this.subscriber.migrateTo(p,n),await this.publisher.migrateTo(p,n);else if(h){if(i)this.subscriber.setSfuClient(p),this.publisher.setSfuClient(p),await this.publisher.restartIce();else if(null==u?void 0:u.isFastReconnecting)return await g("full").catch(e=>{this.logger("error","[Rejoin]: Rejoin failed forced full rejoin.",e)})}let s=(null==t?void 0:t.participants)||[],a=null==t?void 0:t.participantCount,r=(null==t?void 0:t.startedAt)?eR.toDate(t.startedAt):new Date,l=null!==(o=null==t?void 0:t.pins)&&void 0!==o?o:[];this.state.setParticipants(()=>{let e=this.state.getParticipantLookupBySessionId();return s.map(t=>{var i;let n=e[t.sessionId];return Object.assign(t,n,{isLocalParticipant:t.sessionId===p.sessionId,viewportVisibilityState:null!==(i=null==n?void 0:n.viewportVisibilityState)&&void 0!==i?i:{videoTrack:U.UNKNOWN,screenShareTrack:U.UNKNOWN}})})}),this.state.setParticipantCount((null==a?void 0:a.total)||0),this.state.setAnonymousParticipantCount((null==a?void 0:a.anonymous)||0),this.state.setStartedAt(r),this.state.setServerSidePins(l),this.reconnectAttempts=0,this.state.setCallingState(O.JOINED);try{await this.initCamera({setStatus:!0}),await this.initMic({setStatus:!0})}catch(e){this.logger("warn","Camera and/or mic init failed during join call",e)}let{remoteParticipants:c}=this.state;c.length>0&&this.updateSubscriptions(c,A.FAST),this.logger("info","Joined call ".concat(this.cid))}catch(e){if(this.reconnectAttempts<this.maxReconnectAttempts)this.logger("error","[Rejoin]: Rejoin ".concat(this.reconnectAttempts," failed."),e),await g(),this.logger("info","[Rejoin]: Rejoin ".concat(this.reconnectAttempts," successful!"));else throw this.logger("error","[Rejoin]: Rejoin failed for ".concat(this.reconnectAttempts," times. Giving up.")),this.state.setCallingState(O.RECONNECTING_FAILED),Error("Join failed")}},this.waitForJoinResponse=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5e3;return new Promise((t,i)=>{let n=c.on("joinResponse",e=>{"joinResponse"===e.eventPayload.oneofKind&&(clearTimeout(s),n(),t(e.eventPayload.joinResponse))}),s=setTimeout(()=>{n(),i(Error('Waiting for "joinResponse" has timed out'))},e)})},this.publishVideoStream=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(await c.assertCallJoined(),!c.publisher)throw c.logger("error","Trying to publish video before join is completed"),Error("Call not joined yet.");let[i]=e.getVideoTracks();if(!i){c.logger("error","There is no video track to publish in the stream.");return}await c.publisher.publishStream(e,i,E.VIDEO,t)},this.publishAudioStream=async e=>{if(await this.assertCallJoined(),!this.publisher)throw this.logger("error","Trying to publish audio before join is completed"),Error("Call not joined yet.");let[t]=e.getAudioTracks();if(!t){this.logger("error","There is no audio track in the stream to publish");return}await this.publisher.publishStream(e,t,E.AUDIO)},this.publishScreenShareStream=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(await c.assertCallJoined(),!c.publisher)throw c.logger("error","Trying to publish screen share before join is completed"),Error("Call not joined yet.");let[i]=e.getVideoTracks();if(!i){c.logger("error","There is no video track in the screen share stream to publish");return}await c.publisher.publishStream(e,i,E.SCREEN_SHARE,t);let[n]=e.getAudioTracks();n&&await c.publisher.publishStream(e,n,E.SCREEN_SHARE_AUDIO,t)},this.stopPublish=async function(e){var t;let i=!(arguments.length>1)||void 0===arguments[1]||arguments[1];c.logger("info","stopPublish ".concat(E[e],", stop tracks: ").concat(i)),await (null===(t=c.publisher)||void 0===t?void 0:t.unpublishStream(e,i))},this.updateSubscriptionsPartial=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:A.SLOW;"video"===e?(c.logger("warn","updateSubscriptionsPartial: ".concat(e," is deprecated. Please switch to 'videoTrack'")),e="videoTrack"):"screen"===e&&(c.logger("warn","updateSubscriptionsPartial: ".concat(e," is deprecated. Please switch to 'screenShareTrack'")),e="screenShareTrack");let n=c.state.updateParticipants(Object.entries(t).reduce((t,i)=>{var n,s;let[a,r]=i;(null===(n=r.dimension)||void 0===n?void 0:n.height)&&(r.dimension.height=Math.ceil(r.dimension.height)),(null===(s=r.dimension)||void 0===s?void 0:s.width)&&(r.dimension.width=Math.ceil(r.dimension.width));let o="videoTrack"===e?"videoDimension":"screenShareTrack"===e?"screenShareDimension":void 0;return o&&(t[a]={[o]:r.dimension}),t},{}));n&&c.updateSubscriptions(n,i)},this.updateSubscriptions=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:A.SLOW,i=[];for(let t of e)!t.isLocalParticipant&&(t.videoDimension&&t.publishedTracks.includes(E.VIDEO)&&i.push({userId:t.userId,sessionId:t.sessionId,trackType:E.VIDEO,dimension:t.videoDimension}),t.screenShareDimension&&t.publishedTracks.includes(E.SCREEN_SHARE)&&i.push({userId:t.userId,sessionId:t.sessionId,trackType:E.SCREEN_SHARE,dimension:t.screenShareDimension}),t.publishedTracks.includes(E.SCREEN_SHARE_AUDIO)&&i.push({userId:t.userId,sessionId:t.sessionId,trackType:E.SCREEN_SHARE_AUDIO}));c.trackSubscriptionsSubject.next({type:t,data:i})},this.startReportingStatsFor=e=>{var t;return null===(t=this.statsReporter)||void 0===t?void 0:t.startReportingStatsFor(e)},this.stopReportingStatsFor=e=>{var t;return null===(t=this.statsReporter)||void 0===t?void 0:t.stopReportingStatsFor(e)},this.resetReaction=e=>{this.state.updateParticipant(e,{reaction:void 0})},this.setSortParticipantsBy=e=>this.state.setSortParticipantsBy(e),this.updatePublishQuality=async e=>{var t;return null===(t=this.publisher)||void 0===t?void 0:t.updateVideoPublishQuality(e)},this.assertCallJoined=()=>new Promise(e=>{this.state.callingState$.pipe((0,Z.o)(e=>e!==O.JOINED,!0),(0,el.h)(e=>e===O.JOINED)).subscribe(()=>e())}),this.sendReaction=async e=>this.streamClient.post("".concat(this.streamClientBasePath,"/reaction"),e),this.blockUser=async e=>this.streamClient.post("".concat(this.streamClientBasePath,"/block"),{user_id:e}),this.unblockUser=async e=>this.streamClient.post("".concat(this.streamClientBasePath,"/unblock"),{user_id:e}),this.muteSelf=e=>{let t=this.currentUserId;if(t)return this.muteUser(t,e)},this.muteOthers=e=>{let t=iY(e);if(!t)return;let i=[];for(let e of this.state.remoteParticipants)e.publishedTracks.includes(t)&&i.push(e.userId);return this.muteUser(i,e)},this.muteUser=(e,t)=>this.streamClient.post("".concat(this.streamClientBasePath,"/mute_users"),{user_ids:Array.isArray(e)?e:[e],[t]:!0}),this.muteAllUsers=e=>this.streamClient.post("".concat(this.streamClientBasePath,"/mute_users"),{mute_all_users:!0,[e]:!0}),this.startRecording=async e=>this.streamClient.post("".concat(this.streamClientBasePath,"/start_recording"),e||{}),this.stopRecording=async()=>this.streamClient.post("".concat(this.streamClientBasePath,"/stop_recording"),{}),this.requestPermissions=async e=>{let{permissions:t}=e;if(!t.every(e=>this.permissionsContext.canRequest(e)))throw Error("You are not allowed to request permissions: ".concat(t.join(", ")));return this.streamClient.post("".concat(this.streamClientBasePath,"/request_permission"),e)},this.grantPermissions=async(e,t)=>this.updateUserPermissions({user_id:e,grant_permissions:t}),this.revokePermissions=async(e,t)=>this.updateUserPermissions({user_id:e,revoke_permissions:t}),this.updateUserPermissions=async e=>this.streamClient.post("".concat(this.streamClientBasePath,"/user_permissions"),e),this.goLive=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return c.streamClient.post("".concat(c.streamClientBasePath,"/go_live"),e,t)},this.stopLive=async()=>this.streamClient.post("".concat(this.streamClientBasePath,"/stop_live"),{}),this.startHLS=async()=>this.streamClient.post("".concat(this.streamClientBasePath,"/start_broadcasting"),{}),this.stopHLS=async()=>this.streamClient.post("".concat(this.streamClientBasePath,"/stop_broadcasting"),{}),this.update=async e=>{let t=await this.streamClient.patch("".concat(this.streamClientBasePath),e),{call:i,members:n,own_capabilities:s}=t;return this.state.updateFromCallResponse(i),this.state.setMembers(n),this.state.setOwnCapabilities(s),t},this.endCall=async()=>this.streamClient.post("".concat(this.streamClientBasePath,"/mark_ended")),this.pin=e=>{this.state.updateParticipant(e,{pin:{isLocalPin:!0,pinnedAt:Date.now()}})},this.unpin=e=>{this.state.updateParticipant(e,{pin:void 0})},this.pinForEveryone=async e=>this.streamClient.post("".concat(this.streamClientBasePath,"/pin"),e),this.unpinForEveryone=async e=>this.streamClient.post("".concat(this.streamClientBasePath,"/unpin"),e),this.queryMembers=e=>this.streamClient.post("/call/members",{...e||{},id:this.id,type:this.type}),this.updateCallMembers=async e=>this.streamClient.post("".concat(this.streamClientBasePath,"/members"),e),this.scheduleAutoDrop=()=>{clearTimeout(this.dropTimeout),this.leaveCallHooks.add(i2(this.state.settings$,e=>{if(!e||this.state.callingState!==O.RINGING)return;let t=e.ring.auto_cancel_timeout_ms;t<=0||(clearTimeout(this.dropTimeout),this.dropTimeout=setTimeout(()=>{this.leave().catch(e=>{this.logger("error","Failed to drop call",e)})},t))}))},this.queryRecordings=async e=>{let t=this.streamClientBasePath;return e&&(t="".concat(t,"/").concat(e)),this.streamClient.get("".concat(t,"/recordings"))},this.sendCustomEvent=async e=>this.streamClient.post("".concat(this.streamClientBasePath,"/event"),{custom:e}),this.applyDeviceConfig=()=>{this.initCamera({setStatus:!1}),this.initMic({setStatus:!1})},this.trackElementVisibility=(e,t,i)=>this.dynascaleManager.trackElementVisibility(e,t,i),this.setViewport=e=>this.dynascaleManager.setViewport(e),this.bindVideoElement=(e,t,i)=>{let n=this.dynascaleManager.bindVideoElement(e,t,i);if(n)return this.leaveCallHooks.add(n),()=>{this.leaveCallHooks.delete(n),n()}},this.bindAudioElement=function(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"audioTrack",n=c.dynascaleManager.bindAudioElement(e,t,i);if(n)return c.leaveCallHooks.add(n),()=>{c.leaveCallHooks.delete(n),n()}},this.bindCallThumbnailElement=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=()=>{e.src=t.fallbackImageSource||"https://getstream.io/random_svg/?name=x&id=x"},n=i2(c.state.thumbnails$,t=>{if(!t)return;e.addEventListener("error",i);let n=new URL(t.image_url);n.searchParams.set("w",String(e.clientWidth)),n.searchParams.set("h",String(e.clientHeight)),e.src=n.toString()});return()=>{n(),e.removeEventListener("error",i)}},this.type=e,this.id=t,this.cid="".concat(e,":").concat(t),this.ringingSubject=new J.X(o),this.watching=l,this.streamClient=i,this.clientStore=r,this.streamClientBasePath="/call/".concat(this.type,"/").concat(this.id),this.logger=iA(["Call"]);let d=sc.get(e),h=a||d.options.sortParticipantsBy;h&&this.state.setSortParticipantsBy(h),this.state.setMembers(n||[]),this.state.setOwnCapabilities(s||[]),this.state.setCallingState(o?O.RINGING:O.IDLE),this.on("all",e=>{this.state.updateFromEvent(e)}),this.leaveCallHooks.add(n2(this,this.state,this.dispatcher)),this.registerEffects(),this.leaveCallHooks.add(i2(this.trackSubscriptionsSubject.pipe((0,ec.D)(e=>(0,ed.H)(e.type)),(0,Q.U)(e=>e.data)),e=>{var t;return null===(t=this.sfuClient)||void 0===t?void 0:t.updateSubscriptions(e)})),this.camera=new sN(this),this.microphone=new sB(this),this.speaker=new sV,this.screenShare=new sF(this)}}class sx{constructor(){this.connectionStartTimestamp=null,this.wsTotalFailures=0,this.wsConsecutiveFailures=0,this.instanceClientId=nN()}}let sH=async(e,t)=>{for(let i=0;i<3;i++){try{await z.default.post("https://chat-insights.getstream.io/insights/".concat(e),t)}catch(e){await nE((i+1)*3e3);continue}break}};function sz(e){var t,i,n;let{client:s}=e;return{ready_state:null===(t=e.ws)||void 0===t?void 0:t.readyState,url:e._buildUrl(),api_key:s.key,start_ts:s.insightMetrics.connectionStartTimestamp,end_ts:new Date().getTime(),auth_type:s.getAuthType(),token:s.tokenManager.token,user_id:s.userID,user_details:s._user,device:"browser",client_id:e.connectionID,ws_details:e.ws,ws_consecutive_failures:s.insightMetrics.wsConsecutiveFailures,ws_total_failures:s.insightMetrics.wsTotalFailures,request_id:e.requestID,online:"undefined"!=typeof navigator?null===(i=navigator)||void 0===i?void 0:i.onLine:null,user_agent:"undefined"!=typeof navigator?null===(n=navigator)||void 0===n?void 0:n.userAgent:null,instance_client_id:s.insightMetrics.instanceClientId}}let sq=e=>void 0!==e.code,sK=e=>void 0!==e.error;class sG{async connect(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;if(this.isConnecting)throw Error("You've called connect twice, can only attempt 1 connection at the time");this.isDisconnected=!1;try{let e=await this._connect();this.consecutiveFailures=0,this._log("connect() - Established ws connection with healthcheck: ".concat(e))}catch(e){if(this.isHealthy=!1,this.consecutiveFailures+=1,e.code!==nD.TOKEN_EXPIRED||this.client.tokenManager.isStatic()){if(!e.isWSFailure)throw Error(JSON.stringify({code:e.code,StatusCode:e.StatusCode,message:e.message,isWSFailure:e.isWSFailure}))}else this._log("connect() - WS failure due to expired token, so going to try to reload token and reconnect"),this._reconnect({refreshToken:!0})}return await this._waitForHealthy(e)}async _waitForHealthy(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3;return Promise.race([(async()=>{for(let t=0;t<=e;t+=50)try{return await this.connectionOpen}catch(i){if(t===e)throw Error(JSON.stringify({code:i.code,StatusCode:i.StatusCode,message:i.message,isWSFailure:i.isWSFailure}));await nE(50)}})(),(async()=>{throw await nE(e),this.isConnecting=!1,Error(JSON.stringify({code:"",StatusCode:"",message:"initial WS connection could not be established",isWSFailure:!0}))})()])}disconnect(e){let t;this._log("disconnect() - Closing the websocket connection for wsID ".concat(this.wsID)),this.wsID+=1,this.isConnecting=!1,this.isDisconnected=!0,this.healthCheckTimeoutRef&&clearInterval(this.healthCheckTimeoutRef),this.connectionCheckTimeoutRef&&clearInterval(this.connectionCheckTimeoutRef),nO(this.onlineStatusChanged),this.isHealthy=!1,this.ws&&this.ws.removeAllListeners&&this.ws.removeAllListeners();let{ws:i}=this;return i&&i.close&&i.readyState===i.OPEN?(t=new Promise(t=>{let n=e=>{this._log("disconnect() - resolving isClosedPromise ".concat(e?"with":"without"," close frame"),{event:e}),t()};i.onclose=n,setTimeout(n,null!=e?e:1e3)}),this._log("disconnect() - Manually closed connection by calling client.disconnect()"),i.close(nD.WS_CLOSED_SUCCESS,"Manually closed connection by calling client.disconnect()")):(this._log("disconnect() - ws connection doesn't exist or it is already closed."),t=Promise.resolve()),delete this.ws,t}async _connect(){var e,t,i,n;if(this.isConnecting||this.isDisconnected&&this.client.options.enableWSFallback)return;this.isConnecting=!0,this.requestID=nN(),this.client.insightMetrics.connectionStartTimestamp=new Date().getTime();let s=!1;try{this._log("_connect() - waiting for token"),await this.client.tokenManager.tokenReady(),s=!0}catch(e){}try{s||(this._log("_connect() - tokenProvider failed before, so going to retry"),await this.client.tokenManager.loadToken()),this._setupConnectionPromise();let i=this._buildUrl();this._log("_connect() - Connecting to ".concat(i),{wsURL:i,requestID:this.requestID}),this.ws=new ep.Z(i),this.ws.onopen=this.onopen.bind(this,this.wsID),this.ws.onclose=this.onclose.bind(this,this.wsID),this.ws.onerror=this.onerror.bind(this,this.wsID),this.ws.onmessage=this.onmessage.bind(this,this.wsID);let n=await this.connectionOpen;if(this.isConnecting=!1,n)return this.connectionID=n.connection_id,null===(e=(t=this.client).resolveConnectionId)||void 0===e||e.call(t,this.connectionID),this.client.insightMetrics.wsConsecutiveFailures>0&&this.client.options.enableInsights&&(sH("ws_success_after_failure",sz(this)),this.client.insightMetrics.wsConsecutiveFailures=0),n}catch(e){if(this.isConnecting=!1,this._log("_connect() - Error - ",e),this.client.options.enableInsights){this.client.insightMetrics.wsConsecutiveFailures++,this.client.insightMetrics.wsTotalFailures++;let t={...function(e){let t={};if(!e)return t;try{Object.getOwnPropertyNames(e).forEach(i=>{t[i]=Object.getOwnPropertyDescriptor(e,i)})}catch(e){return{error:"failed to serialize the error"}}return t}(e),...sz(this)};null==sH||sH("ws_fatal",t)}throw null===(i=(n=this.client).rejectConnectionId)||void 0===i||i.call(n),e}}async _reconnect(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._log("_reconnect() - Initiating the reconnect"),this.isConnecting||this.isHealthy){this._log("_reconnect() - Abort (1) since already connecting or healthy");return}let t=e.interval;if(t||(t=n_(this.consecutiveFailures)),await nE(t),this.isConnecting||this.isHealthy){this._log("_reconnect() - Abort (2) since already connecting or healthy");return}if(this.isDisconnected&&this.client.options.enableWSFallback){this._log("_reconnect() - Abort (3) since disconnect() is called");return}this._log("_reconnect() - Destroying current WS connection"),this._destroyCurrentWSConnection(),e.refreshToken&&await this.client.tokenManager.loadToken();try{await this._connect(),this._log("_reconnect() - Waiting for recoverCallBack"),this._log("_reconnect() - Finished recoverCallBack"),this.consecutiveFailures=0}catch(e){if(this.isHealthy=!1,this.consecutiveFailures+=1,e.code===nD.TOKEN_EXPIRED&&!this.client.tokenManager.isStatic())return this._log("_reconnect() - WS failure due to expired token, so going to try to reload token and reconnect"),this._reconnect({refreshToken:!0});e.isWSFailure&&(this._log("_reconnect() - WS failure, so going to try to reconnect"),this._reconnect())}this._log("_reconnect() - == END ==")}_destroyCurrentWSConnection(){this.wsID+=1;try{var e,t;null===this||void 0===this||null===(e=this.ws)||void 0===e||e.removeAllListeners(),null===this||void 0===this||null===(t=this.ws)||void 0===t||t.close()}catch(e){}}constructor(e){var t=this;this._log=function(e){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"info";t.client.logger(n,"connection:"+e,{...i})},this.setClient=e=>{this.client=e},this._buildUrl=()=>{let e=new URLSearchParams;return e.set("api_key",this.client.key),e.set("stream-auth-type",this.client.getAuthType()),e.set("X-Stream-Client",this.client.getUserAgent()),"".concat(this.client.wsBaseURL,"/connect?").concat(e.toString())},this.onlineStatusChanged=e=>{"offline"===e.type?(this._log("onlineStatusChanged() - Status changing to offline"),this._setHealth(!1,!0)):"online"!==e.type||(this._log("onlineStatusChanged() - Status changing to online. isHealthy: ".concat(this.isHealthy)),this.isHealthy||this._reconnect({interval:10}))},this.onopen=e=>{var t;if(this.wsID!==e)return;let i=this.client.user;if(!i){this.client.logger("error","User not set, can't connect to WS");return}let n=this.client._getToken();if(!n){this.client.logger("error","Token not set, can't connect authenticate");return}let s={token:n,user_details:{id:i.id,name:i.name,image:i.image,custom:i.custom}};this.authenticationSent=!0,null===(t=this.ws)||void 0===t||t.send(JSON.stringify(s)),this._log("onopen() - onopen callback",{wsID:e})},this.onmessage=(e,t)=>{if(this.wsID!==e)return;this._log("onmessage() - onmessage callback",{event:t,wsID:e});let i="string"==typeof t.data?JSON.parse(t.data):null;if(!this.isResolved&&i&&"connection.ok"===i.type){var n,s;if(this.isResolved=!0,i.error){null===(s=this.rejectPromise)||void 0===s||s.call(this,this._errorFromWSEvent(i,!1));return}null===(n=this.resolvePromise)||void 0===n||n.call(this,i),this._setHealth(!0)}if(this.lastEvent=new Date,i&&("health.check"===i.type||"connection.ok"===i.type)&&this.scheduleNextPing(),i&&i.error){let{code:e}=this._errorFromWSEvent(i,!0);this.isHealthy=!1,this.isConnecting=!1,this.consecutiveFailures+=1,e!==nD.TOKEN_EXPIRED||this.client.tokenManager.isStatic()||(clearTimeout(this.connectionCheckTimeoutRef),this._log("connect() - WS failure due to expired token, so going to try to reload token and reconnect"),this._reconnect({refreshToken:!0}))}this.client.handleEvent(t),this.scheduleConnectionCheck()},this.onclose=(e,t)=>{var i,n;if(this.wsID===e){if(this._log("onclose() - onclose callback - "+t.code,{event:t,wsID:e}),t.code===nD.WS_CLOSED_SUCCESS){let e=Error("WS connection reject with error ".concat(t.reason));e.reason=t.reason,e.code=t.code,e.wasClean=t.wasClean,e.target=t.target,null===(i=this.rejectPromise)||void 0===i||i.call(this,e),this._log("onclose() - WS connection reject with error ".concat(t.reason),{event:t})}else this.consecutiveFailures+=1,this.totalFailures+=1,this._setHealth(!1),this.isConnecting=!1,null===(n=this.rejectPromise)||void 0===n||n.call(this,this._errorFromWSEvent(t)),this._log("onclose() - WS connection closed. Calling reconnect ...",{event:t}),this._reconnect()}},this.onerror=(e,t)=>{var i;this.wsID===e&&(this.consecutiveFailures+=1,this.totalFailures+=1,this._setHealth(!1),this.isConnecting=!1,null===(i=this.rejectPromise)||void 0===i||i.call(this,this._errorFromWSEvent(t)),this._log("onerror() - WS connection resulted into error",{event:t}),this._reconnect())},this._setHealth=function(e){let i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(e!==t.isHealthy){if(t.isHealthy=e,t.isHealthy||i){t.client.dispatchEvent({type:"connection.changed",online:t.isHealthy});return}setTimeout(()=>{t.isHealthy||t.client.dispatchEvent({type:"connection.changed",online:t.isHealthy})},5e3)}},this._errorFromWSEvent=function(e){let i,n,s,a=!(arguments.length>1)||void 0===arguments[1]||arguments[1];sq(e)&&(i=e.code,n="unknown",s=e.reason),sK(e)&&(i=e.error.code,n=e.error.StatusCode,s=e.error.message),t._log("_errorFromWSEvent() - WS failed with code ".concat(i),{event:e},"warn");let r=Error("WS failed with code ".concat(i," and reason - ").concat(s));return r.code=i,r.StatusCode=n,r.isWSFailure=a,r},this._setupConnectionPromise=()=>{this.isResolved=!1,this.connectionOpen=new Promise((e,t)=>{this.resolvePromise=e,this.rejectPromise=t})},this.scheduleNextPing=()=>{this.healthCheckTimeoutRef&&clearTimeout(this.healthCheckTimeoutRef),this.healthCheckTimeoutRef=setTimeout(()=>{let e=[{type:"health.check",client_id:this.client.clientID}];try{var t;null===(t=this.ws)||void 0===t||t.send(JSON.stringify(e))}catch(e){}},this.pingInterval)},this.scheduleConnectionCheck=()=>{this.connectionCheckTimeoutRef&&clearTimeout(this.connectionCheckTimeoutRef),this.connectionCheckTimeoutRef=setTimeout(()=>{let e=new Date;this.lastEvent&&e.getTime()-this.lastEvent.getTime()>this.connectionCheckTimeout&&(this._log("scheduleConnectionCheck - going to reconnect"),this._setHealth(!1),this._reconnect())},this.connectionCheckTimeout)},this.client=e,this.consecutiveFailures=0,this.totalFailures=0,this.isConnecting=!1,this.authenticationSent=!1,this.isDisconnected=!1,this.isResolved=!1,this.isHealthy=!1,this.wsID=1,this.lastEvent=null,this.pingInterval=25e3,this.connectionCheckTimeout=this.pingInterval+1e4,nA(this.onlineStatusChanged)}}function s$(e){return"string"==typeof e}let sJ=e=>(0,eg.JQ)(new Uint8Array(function(e,t){let i=[];if(s$(e)&&t&&s$(e)){for(let n=0,s=e.length;n<s;n++)if(e.charAt(n)){let s=t(e.charAt(n),n,e);i[n]=s}}else if(!s$(e)&&!(t&&s$(e))){for(let n=0,s=e.length;n<s;n++)if(n in e){let s=t(e[n],n,e);i[n]=s}}return i}(e,e=>e.charCodeAt(0)))),sQ=e=>{let t={},i=String.fromCharCode,n=e.length,s,a=0,r,o=0,l,c="";for(s=0;s<64;s++)t["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(s)]=s;for(r=0;r<n;r++)for(a=(a<<6)+t[e.charAt(r)],o+=6;o>=8;)((l=a>>>(o-=8)&255)||r<n-2)&&(c+=i(l));return c};function sX(e,t){if(arguments.length>2&&void 0!==arguments[2]&&arguments[2],arguments.length>3&&void 0!==arguments[3]&&arguments[3],"string"!=typeof t)throw TypeError("userId should be a string");throw Error("Unable to find jwt crypto, if you are getting this error is probably because you are trying to generate tokens on browser or React Native (or other environment where crypto functions are not available). Please Note: token should only be generated server-side.")}function sY(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=Object.assign({algorithm:"HS256",noTimestamp:!0},t);return null.sign({server:!0},e,i)}class sZ{constructor(e){this.setTokenOrProvider=async(e,t,i)=>{this.validateToken(e,t,i),this.user=t,nI(e)&&(this.tokenProvider=e,this.type="provider"),"string"==typeof e&&(this.token=e,this.type="static"),!e&&this.user&&this.secret&&(this.token=sX(this.secret,t.id,{},{}),this.type="static"),await this.loadToken()},this.reset=()=>{this.token=void 0,this.user=void 0,this.loadTokenPromise=null},this.validateToken=(e,t,i)=>{if(!t||!i||e){if(!this.secret&&!e)throw Error("UserWithId token can not be empty");if(e&&"string"!=typeof e&&!nI(e))throw Error("user token should either be a string or a function");if("string"==typeof e){if(i&&""===e)return;let n=function(e){let t=e.split(".");return 3!==t.length?"":JSON.parse(sQ(t[1])).user_id}(e);if(null!=e&&(null==n||""===n||!i&&n!==t.id))throw Error("userToken does not have a user_id or is not matching with user.id")}}},this.tokenReady=()=>this.loadTokenPromise,this.loadToken=()=>(this.loadTokenPromise=new Promise(async(e,t)=>{if("static"===this.type)return e(this.token);if(this.tokenProvider&&"string"!=typeof this.tokenProvider){try{this.token=await this.tokenProvider()}catch(e){return t(Error("Call to tokenProvider failed with message: ".concat(e)))}e(this.token)}}),this.loadTokenPromise),this.getToken=()=>{if(this.token||this.user&&!this.token)return this.token;if(this.secret)return sY(this.secret);throw Error("Both secret and user tokens are not set. Either client.connectUser wasn't called or client.disconnect was called")},this.isStatic=()=>"static"===this.type,this.loadTokenPromise=null,e&&(this.secret=e),this.type="static",this.secret&&(this.token=sY(this.secret))}}let s0={"-1":{name:"InternalSystemError",retryable:!0},2:{name:"AccessKeyError",retryable:!1},3:{name:"AuthenticationFailedError",retryable:!0},4:{name:"InputError",retryable:!1},6:{name:"DuplicateUsernameError",retryable:!1},9:{name:"RateLimitError",retryable:!0},16:{name:"DoesNotExistError",retryable:!1},17:{name:"NotAllowedError",retryable:!1},18:{name:"EventNotSupportedError",retryable:!1},19:{name:"ChannelFeatureNotSupportedError",retryable:!1},20:{name:"MessageTooLongError",retryable:!1},21:{name:"MultipleNestingLevelError",retryable:!1},22:{name:"PayloadTooBigError",retryable:!1},23:{name:"RequestTimeoutError",retryable:!0},24:{name:"MaxHeaderSizeExceededError",retryable:!1},40:{name:"AuthErrorTokenExpired",retryable:!1},41:{name:"AuthErrorTokenNotValidYet",retryable:!1},42:{name:"AuthErrorTokenUsedBeforeIssuedAt",retryable:!1},43:{name:"AuthErrorTokenSignatureInvalid",retryable:!1},44:{name:"CustomCommandEndpointMissingError",retryable:!1},45:{name:"CustomCommandEndpointCallError",retryable:!0},46:{name:"ConnectionIDNotFoundError",retryable:!1},60:{name:"CoolDownError",retryable:!0},69:{name:"ErrWrongRegion",retryable:!1},70:{name:"ErrQueryChannelPermissions",retryable:!1},71:{name:"ErrTooManyConnections",retryable:!0},99:{name:"AppSuspendedError",retryable:!1}};function s1(e){if(!e.code)return!1;let t=s0["".concat(e.code)];return!!t&&t.retryable}(w=L||(L={})).Closed="CLOSED",w.Connected="CONNECTED",w.Connecting="CONNECTING",w.Disconnected="DISCONNECTED",w.Init="INIT";class s2{_log(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"info";this.client.logger(i,"WSConnectionFallback:"+e,{...t})}_setState(e){this._log("_setState() - ".concat(e)),this.state===L.Connecting&&e===L.Connected&&this.client.dispatchEvent({type:"connection.changed",online:!0}),(e===L.Closed||e===L.Disconnected)&&this.client.dispatchEvent({type:"connection.changed",online:!1}),this.state=e}constructor(e){var t=this;this._onlineStatusChanged=e=>{if(this._log("_onlineStatusChanged() - ".concat(e.type)),"offline"===e.type){var t;this._setState(L.Closed),null===(t=this.cancelToken)||void 0===t||t.cancel("disconnect() is called"),this.cancelToken=void 0;return}"online"===e.type&&this.state===L.Closed&&this.connect(!0)},this._req=async(e,t,i)=>{this.cancelToken||e.close||(this.cancelToken=z.default.CancelToken.source());try{var n;let i=await this.client.doAxiosRequest("get",this.client.baseURL.replace(":3030",":8900")+"/longpoll",void 0,{config:{...t,cancelToken:null===(n=this.cancelToken)||void 0===n?void 0:n.token},params:e,publicEndpoint:!0});return this.consecutiveFailures=0,i}catch(n){if(this.consecutiveFailures+=1,i&&s1(n))return this._log("_req() - Retryable error, retrying request"),await nE(n_(this.consecutiveFailures)),this._req(e,t,i);throw n}},this._poll=async()=>{for(;this.state===L.Connected;)try{var e;let t=await this._req({},{timeout:3e4},!0);if(null===(e=t.events)||void 0===e?void 0:e.length)for(let e=0;e<t.events.length;e++)this.client.dispatchEvent(t.events[e])}catch(e){if(z.default.isCancel(e)){this._log("_poll() - axios canceled request");return}if(46===e.code){this._log("_poll() - ConnectionID error, connecting without ID..."),this._setState(L.Disconnected),this.connect(!0);return}if(void 0!==e.code&&!s1(e)){this._setState(L.Closed);return}await nE(n_(this.consecutiveFailures))}},this.connect=async function(){var e,i,n,s;let a=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(t.state===L.Connecting){t._log("connect() - connecting already in progress",{reconnect:a},"warn");return}if(t.state===L.Connected){t._log("connect() - already connected and polling",{reconnect:a},"warn");return}t._setState(L.Connecting),t.connectionID=void 0;try{let{event:n}=await t._req({json:t.client._buildWSPayload()},{timeout:8e3},a);return t._setState(L.Connected),t.connectionID=n.connection_id,null===(e=(i=t.client).resolveConnectionId)||void 0===e||e.call(i),t.client.dispatchEvent(n),t._poll(),n}catch(e){throw t._setState(L.Closed),null===(n=(s=t.client).rejectConnectionId)||void 0===n||n.call(s),e}},this.isHealthy=()=>!!this.connectionID&&this.state===L.Connected,this.disconnect=async function(){var e;let i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:2e3;nO(t._onlineStatusChanged),t._setState(L.Disconnected),null===(e=t.cancelToken)||void 0===e||e.cancel("disconnect() is called"),t.cancelToken=void 0;let n=t.connectionID;t.connectionID=void 0;try{await t._req({close:!0,connection_id:n},{timeout:i},!1),t._log("disconnect() - Closed connectionID")}catch(e){t._log("disconnect() - Failed",{err:e},"error")}},this.client=e,this.state=L.Init,this.consecutiveFailures=0,nA(this._onlineStatusChanged)}}let s3=iA(["location"]),s9="https://hint.stream-io-video.com/",s4=async function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0];let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2e3,t=new AbortController,i=setTimeout(()=>t.abort(),e);try{let e=(await fetch(s9,{method:"HEAD",signal:t.signal})).headers.get("x-amz-cf-pop")||"ERR";return s3("debug","Location header: ".concat(e)),e.substring(0,3)}catch(e){return s3("warn","Failed to get location hint from ".concat(s9),e),"ERR"}finally{clearTimeout(i)}};class s5{constructor(e,t){var i,n=this;this.nextRequestAbortController=null,this.devToken=e=>["eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9",sJ(JSON.stringify({user_id:e})),"devtoken"].join("."),this.getAuthType=()=>this.anonymous?"anonymous":"jwt",this.setBaseURL=e=>{this.baseURL=e,this.wsBaseURL=this.baseURL.replace("http","ws").replace(":3030",":8800")},this.getLocationHint=async(e,t)=>{let i=await this.locationHint;return i&&"ERR"!==i?i:(this.locationHint=s4(null!=e?e:this.options.locationHintUrl,null!=t?t:this.options.locationHintTimeout),this.locationHint)},this._getConnectionID=()=>{var e,t;return(null===(e=this.wsConnection)||void 0===e?void 0:e.connectionID)||(null===(t=this.wsFallback)||void 0===t?void 0:t.connectionID)},this._hasConnectionID=()=>!!this._getConnectionID(),this.connectUser=async(e,t)=>{if(!e.id)throw Error('The "id" field on the user is missing');if(this.userID===e.id&&this.setUserPromise)return this.logger("warn","Consecutive calls to connectUser is detected, ideally you should only call this function once in your app."),this.setUserPromise;if(this.userID)throw Error("Use client.disconnect() before trying to connect as a different user. connectUser was called twice.");(this._isUsingServerAuth()||this.node)&&!this.options.allowServerSideConnect&&this.logger("warn",'Please do not use connectUser server side. connectUser impacts MAU and concurrent connection usage and thus your bill. If you have a valid use-case, add "allowServerSideConnect: true" to the client options to disable this warning.'),this.userID=e.id,this.anonymous=!1;let i=this._setToken(e,t,this.anonymous);this._setUser(e);let n=this.openConnection();this.setUserPromise=Promise.all([i,n]).then(e=>e[1]);try{return await this.setUserPromise}catch(e){throw this.persistUserOnConnectionFailure?this.closeConnection():this.disconnectUser(),e}},this._setToken=(e,t,i)=>this.tokenManager.setTokenOrProvider(t,e,i),this._setUser=e=>{this.user=e,this.userID=e.id,this._user={...e}},this.closeConnection=async e=>{var t,i;return null!=this.cleaningIntervalRef&&(clearInterval(this.cleaningIntervalRef),this.cleaningIntervalRef=void 0),await Promise.all([null===(t=this.wsConnection)||void 0===t?void 0:t.disconnect(e),null===(i=this.wsFallback)||void 0===i?void 0:i.disconnect(e)]),Promise.resolve()},this.openConnection=async()=>{var e,t,i;if(!this.userID)throw Error("UserWithId is not set on client, use client.connectUser or client.connectAnonymousUser instead");return(null===(e=this.wsConnection)||void 0===e?void 0:e.isConnecting)&&this.wsPromise?(this.logger("info","client:openConnection() - connection already in progress"),this.wsPromise):((null===(t=this.wsConnection)||void 0===t?void 0:t.isHealthy)||(null===(i=this.wsFallback)||void 0===i?void 0:i.isHealthy()))&&this._hasConnectionID()?(this.logger("info","client:openConnection() - openConnection called twice, healthy connection already exists"),Promise.resolve()):(this.connectionIdPromise=new Promise((e,t)=>{this.resolveConnectionId=e,this.rejectConnectionId=t}),this.clientID="".concat(this.userID,"--").concat(nN()),this.wsPromise=this.connect(),this.wsPromise)},this._normalizeDate=e=>{if(e instanceof Date&&(e=e.toISOString()),""===e)throw Error("Don't pass blank string for since, use null instead if resetting the token revoke");return e},this.disconnectUser=async e=>{this.logger("info","client:disconnect() - Disconnecting the client"),delete this.user,delete this._user,delete this.userID,this.anonymous=!1,await this.closeConnection(e),this.tokenManager.reset(),this.connectionIdPromise=void 0,this.rejectConnectionId=void 0,this.resolveConnectionId=void 0},this.connectGuestUser=async e=>{this.guestUserCreatePromise=this.doAxiosRequest("post","/guest",{user:{...e,role:"guest"}},{publicEndpoint:!0});let t=await this.guestUserCreatePromise;return this.guestUserCreatePromise.finally(()=>this.guestUserCreatePromise=void 0),this.connectUser(t.user,t.access_token)},this.connectAnonymousUser=async(e,t)=>{var i;this.connectionIdPromise=new Promise((e,t)=>{this.resolveConnectionId=e,this.rejectConnectionId=t}),this.anonymous=!0,await this._setToken(e,t,this.anonymous),this._setUser(e),null===(i=this.resolveConnectionId)||void 0===i||i.call(this)},this.on=(e,t)=>{let i=t?e:"all",n=t||e;return i in this.listeners||(this.listeners[i]=[]),this.listeners[i].push(n),()=>{this.off(i,n)}},this.off=(e,t)=>{let i=t?e:"all",n=t||e;i in this.listeners||(this.listeners[i]=[]),this.logger("debug","Removing listener for ".concat(i," event")),this.listeners[i]=this.listeners[i].filter(e=>e!==n)},this._logApiRequest=(e,t,i,n)=>{this.logger("trace","client: ".concat(e," - Request - ").concat(t),{payload:i,config:n})},this._logApiResponse=(e,t,i)=>{this.logger("trace","client:".concat(e," - Response - url: ").concat(t," > status ").concat(i.status),{response:i})},this._logApiError=(e,t,i)=>{this.logger("error","client:".concat(e," - Error - url: ").concat(t),{url:t,error:i})},this.doAxiosRequest=async function(e,t,i){let s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};s.publicEndpoint||await Promise.all([n.tokenManager.tokenReady(),n.guestUserCreatePromise,n.connectionIdPromise]);let a=n._enrichAxiosOptions(s);try{let s;switch(n._logApiRequest(e,t,i,a),e){case"get":s=await n.axiosInstance.get(t,a);break;case"delete":s=await n.axiosInstance.delete(t,a);break;case"post":s=await n.axiosInstance.post(t,i,a);break;case"put":s=await n.axiosInstance.put(t,i,a);break;case"patch":s=await n.axiosInstance.patch(t,i,a);break;case"options":s=await n.axiosInstance.options(t,a);break;default:throw Error("Invalid request type")}return n._logApiResponse(e,t,s),n.consecutiveFailures=0,n.handleResponse(s)}catch(o){var r;if(o.client_request_id=null===(r=a.headers)||void 0===r?void 0:r["x-client-request-id"],n.consecutiveFailures+=1,o.response){if(n._logApiError(e,t,o.response),o.response.data.code===nD.TOKEN_EXPIRED&&!n.tokenManager.isStatic())return n.consecutiveFailures>1&&await nE(n_(n.consecutiveFailures)),await n.tokenManager.loadToken(),await n.doAxiosRequest(e,t,i,s);return n.handleResponse(o.response)}throw n._logApiError(e,t,o),o}},this.get=(e,t)=>this.doAxiosRequest("get",e,null,{params:t}),this.put=(e,t,i)=>this.doAxiosRequest("put",e,t,{params:i}),this.post=(e,t,i)=>this.doAxiosRequest("post",e,t,{params:i}),this.patch=(e,t,i)=>this.doAxiosRequest("patch",e,t,{params:i}),this.delete=(e,t)=>this.doAxiosRequest("delete",e,null,{params:t}),this.errorFromResponse=e=>{let t;return t=new ey("Stream error HTTP code: ".concat(e.status)),e.data&&e.data.code&&((t=Error("Stream error code ".concat(e.data.code,": ").concat(e.data.message))).code=e.data.code),t.response=e,t.status=e.status,t},this.handleResponse=e=>{let t=e.data;if(!e.status||e.status<200||300<=e.status)throw this.errorFromResponse(e);return t},this.dispatchEvent=e=>{e.received_at||(e.received_at=new Date),this.logger("debug","Dispatching event: ".concat(e.type),e),this._callClientListeners(e)},this.handleEvent=e=>{let t=JSON.parse(e.data);this.dispatchEvent(t)},this._callClientListeners=e=>{let t=[];for(let i of(this.listeners.all&&t.push(...this.listeners.all),this.listeners[e.type]&&t.push(...this.listeners[e.type]),t))i(e)},this.connect=async()=>{if(!this.userID||!this._user)throw Error("Call connectUser or connectAnonymousUser before starting the connection");if(!this.wsBaseURL)throw Error("Websocket base url not set");if(!this.clientID)throw Error("clientID is not set");!this.wsConnection&&(this.options.warmUp||this.options.enableInsights)&&this._sayHi(),this.options.wsConnection&&this.node?(this.options.wsConnection.setClient(this),this.wsConnection=this.options.wsConnection):this.wsConnection=new sG(this);try{if(this.wsFallback)return await this.wsFallback.connect();return this.logger("info","StreamClient.connect: this.wsConnection.connect()"),await this.wsConnection.connect(this.options.enableWSFallback?this.defaultWSTimeoutWithFallback:this.defaultWSTimeout)}catch(e){if(this.options.enableWSFallback&&function(e){if("boolean"==typeof e.isWSFailure)return e.isWSFailure;try{return JSON.parse(e.message).isWSFailure}catch(e){return!1}}(e)&&function(e){let t="undefined"!=typeof navigator?navigator:window.navigator?window.navigator:void 0;return t?"boolean"!=typeof t.onLine||t.onLine:(e("warn","isOnline failed to access window.navigator and assume browser is online"),!0)}(this.logger))return this.logger("warn","client:connect() - WS failed, fallback to longpoll"),this.dispatchEvent({type:"transport.changed",mode:"longpoll"}),this.wsConnection._destroyCurrentWSConnection(),this.wsConnection.disconnect().then(),this.wsFallback=new s2(this),await this.wsFallback.connect();throw e}},this._sayHi=()=>{let e=nN(),t={headers:q.uu.from({"x-client-request-id":e})};this.doAxiosRequest("get",this.baseURL+"/hi",null,t).catch(t=>{this.options.enableInsights&&sH("http_hi_failed",{api_key:this.key,err:t,client_request_id:e})})},this.getUserAgent=()=>this.userAgent||"stream-video-javascript-client-".concat(this.node?"node":"browser","-").concat("0.5.9"),this.setUserAgent=e=>{this.userAgent=e},this._isUsingServerAuth=()=>!!this.secret,this._enrichAxiosOptions=function(){var e;let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{params:{},headers:{},config:{}},i=t.publicEndpoint&&!n.user?void 0:n._getToken(),s=null;return null!==n.nextRequestAbortController&&(s=n.nextRequestAbortController.signal,n.nextRequestAbortController=null),(null===(e=t.headers)||void 0===e?void 0:e["x-client-request-id"])||(t.headers={...t.headers,"x-client-request-id":nN()}),{params:{user_id:n.userID,connection_id:n._getConnectionID(),api_key:n.key,...t.params},headers:{...i?{Authorization:i}:void 0,"stream-auth-type":t.publicEndpoint&&!n.user?"anonymous":n.getAuthType(),"X-Stream-Client":n.getUserAgent(),...t.headers},...s?{signal:s}:{},...t.config,...n.options.axiosRequestConfig}},this._getToken=()=>this.tokenManager?this.tokenManager.getToken():null,this._buildWSPayload=e=>JSON.stringify({user_id:this.userID,user_details:this._user,client_request_id:e}),this.createAbortControllerForNextRequest=()=>this.nextRequestAbortController=new AbortController,this.createToken=(e,t,i,n)=>{if(null==this.secret)throw Error("tokens can only be created server-side using the API Secret");let s={};return t&&(s.exp=t),i&&(s.iat=i),n&&(s.call_cids=n),sX(this.secret,e,s,{})},this.key=e,this.listeners={},this.secret=null==t?void 0:t.secret;let s=t||{browser:!0};this.browser=s.browser||!0,this.node=!this.browser,this.browser&&(this.locationHint=s4(null==t?void 0:t.locationHintUrl,null==t?void 0:t.locationHintTimeout)),this.options={timeout:5e3,withCredentials:!1,warmUp:!1,...s},this.node&&!this.options.httpsAgent&&(this.options.httpsAgent=new null.Agent({keepAlive:!0,keepAliveMsecs:3e3})),this.setBaseURL(this.options.baseURL||"https://video.stream-io-api.com/video"),void 0!==em&&em.env.STREAM_LOCAL_TEST_RUN&&this.setBaseURL("http://localhost:3030/video"),void 0!==em&&em.env.STREAM_LOCAL_TEST_HOST&&this.setBaseURL("http://".concat(em.env.STREAM_LOCAL_TEST_HOST,"/video")),this.axiosInstance=z.default.create({...this.options,baseURL:this.baseURL}),this.wsConnection=null,this.wsPromise=null,this.setUserPromise=null,this.anonymous=!1,this.persistUserOnConnectionFailure=null===(i=this.options)||void 0===i?void 0:i.persistUserOnConnectionFailure,this.tokenManager=new sZ(this.secret),this.consecutiveFailures=0,this.insightMetrics=new sx,this.defaultWSTimeoutWithFallback=6e3,this.defaultWSTimeout=15e3,this.logger=nI(s.logger)?s.logger:()=>null}}class s6{get state(){return this.readOnlyStateStore}async connectUser(e,t){var i;if("anonymous"===e.type)return e.id="!anon",this.connectAnonymousUser(e,t);let n=()=>this.streamClient.connectUser(e,t);"guest"===e.type&&(n=async()=>this.streamClient.connectGuestUser(e)),this.connectionPromise=this.disconnectionPromise?this.disconnectionPromise.then(()=>n()):n(),null===(i=this.connectionPromise)||void 0===i||i.finally(()=>this.connectionPromise=void 0);let s=await this.connectionPromise;return(null==s?void 0:s.me)&&this.writeableStateStore.setConnectedUser(s.me),this.eventHandlersToUnregister.push(this.on("connection.changed",e=>{if(e.online){let e=this.writeableStateStore.calls.filter(e=>e.watching).map(e=>e.cid);this.logger("info","Rewatching calls after connection changed ".concat(e.join(", "))),e.length>0&&this.queryCalls({watch:!0,filter_conditions:{cid:{$in:e}},sort:[{field:"cid",direction:1}]}).catch(e=>{this.logger("error","Failed to re-watch calls",e)})}})),this.eventHandlersToUnregister.push(this.on("call.created",t=>{if("call.created"!==t.type)return;let{call:i,members:n}=t;if(e.id===i.created_by.id){this.logger("warn","Received `call.created` sent by the current user");return}this.logger("info","New call created and registered: ".concat(i.cid));let s=new sM({streamClient:this.streamClient,type:i.type,id:i.id,members:n,clientStore:this.writeableStateStore});s.state.updateFromCallResponse(i),this.writeableStateStore.registerCall(s)})),this.eventHandlersToUnregister.push(this.on("call.ring",async t=>{if("call.ring"!==t.type)return;let{call:i,members:n}=t;if(e.id===i.created_by.id){this.logger("debug","Received `call.ring` sent by the current user so ignoring the event");return}let s=this.writeableStateStore.findCall(i.type,i.id);await (null==s?void 0:s.leave());let a=new sM({streamClient:this.streamClient,type:i.type,id:i.id,members:n,clientStore:this.writeableStateStore,ringing:!0});a.state.updateFromCallResponse(i),await a.get(),this.writeableStateStore.registerCall(a)})),s}async addVoipDevice(e,t,i,n){return await this.addDevice(e,t,i,n,!0)}constructor(e,t){var i,n,s=this;this.logLevel="warn",this.eventHandlersToUnregister=[],this.disconnectUser=async e=>{if(!this.streamClient.user&&!this.connectionPromise)return;let t=()=>this.streamClient.disconnectUser(e);this.disconnectionPromise=this.connectionPromise?this.connectionPromise.then(()=>t()):t(),this.disconnectionPromise.finally(()=>this.disconnectionPromise=void 0),await this.disconnectionPromise,this.eventHandlersToUnregister.forEach(e=>e()),this.eventHandlersToUnregister=[],this.writeableStateStore.setConnectedUser(void 0)},this.on=(e,t)=>this.streamClient.on(e,t),this.off=(e,t)=>this.streamClient.off(e,t),this.call=(e,t)=>new sM({streamClient:this.streamClient,id:t,type:e,clientStore:this.writeableStateStore}),this.createGuestUser=async e=>this.streamClient.doAxiosRequest("post","/guest",e,{publicEndpoint:!0}),this.queryCalls=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=await s.streamClient.post("/calls",e),i=t.calls.map(t=>{let i=new sM({streamClient:s.streamClient,id:t.call.id,type:t.call.type,members:t.members,ownCapabilities:t.own_capabilities,watching:e.watch,clientStore:s.writeableStateStore});return i.state.updateFromCallResponse(t.call),i.applyDeviceConfig(),e.watch&&s.writeableStateStore.registerCall(i),i});return{...t,calls:i}},this.edges=async()=>this.streamClient.get("/edges"),this.addDevice=async(e,t,i,n,s)=>await this.streamClient.post("/devices",{id:e,push_provider:t,voip_token:s,...null!=n?{user_id:n}:{},...null!=i?{push_provider_name:i}:{}}),this.getDevices=async e=>await this.streamClient.get("/devices",e?{user_id:e}:{}),this.removeDevice=async(e,t)=>await this.streamClient.delete("/devices",{id:e,...t?{user_id:t}:{}}),this.onRingingCall=async e=>{let t=this.readOnlyStateStore.calls.find(t=>t.cid===e&&t.ringing);if(!t){let[i,n]=e.split(":");t=new sM({streamClient:this.streamClient,type:i,id:n,clientStore:this.writeableStateStore,ringing:!0}),await t.get()}return t},this.connectAnonymousUser=async(e,t)=>{let i=()=>this.streamClient.connectAnonymousUser(e,t);return this.connectionPromise=this.disconnectionPromise?this.disconnectionPromise.then(()=>i()):i(),this.connectionPromise.finally(()=>this.connectionPromise=void 0),this.connectionPromise};let a=iP,r="warn";if("string"==typeof e?(r=(null==t?void 0:t.logLevel)||r,a=(null==t?void 0:t.logger)||a):(r=(null===(i=e.options)||void 0===i?void 0:i.logLevel)||r,a=(null===(n=e.options)||void 0===n?void 0:n.logger)||a),iN(a,r),this.logger=iA(["client"]),"string"==typeof e)this.streamClient=new s5(e,{persistUserOnConnectionFailure:!0,...t,logLevel:r,logger:this.logger});else{this.streamClient=new s5(e.apiKey,{persistUserOnConnectionFailure:!0,...e.options,logLevel:r,logger:this.logger});let t=ix();t&&this.streamClient.setUserAgent(this.streamClient.getUserAgent()+"-video-".concat(D[t.type].toLowerCase(),"-sdk-").concat(t.major,".").concat(t.minor,".").concat(t.patch))}if(this.writeableStateStore=new nu,this.readOnlyStateStore=new np(this.writeableStateStore),"string"!=typeof e){let t=e.user,i=e.token||e.tokenProvider;t&&this.connectUser(t,i)}}}}}]);