(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[684],{28633:function(e,t,s){Promise.resolve().then(s.bind(s,48662))},13141:function(e,t,s){"use strict";var l=s(3827);s(64090),t.Z=e=>{var t,s,r,n,i;let{session:a,owner:o,isRoom:c,room:d,isLoadingRoom:u,participantCount:h}=e,x=c&&(null==d?void 0:d.name),m=c&&!u,v=(null==o?void 0:o.id)===(null==a?void 0:a.user.id);return(0,l.jsx)("nav",{className:"bg-white z-20 border border-slate-200 w-full p-4",children:(0,l.jsxs)("div",{className:"mx-auto flex justify-between items-center",children:[(0,l.jsxs)("section",{className:"flex gap-2 items-center",children:[(0,l.jsx)("a",{href:"/",className:"text-lg font-semibold md:text-2xl text-blue-500",children:"Guess Draw"}),x&&(0,l.jsxs)("div",{className:"hidden md:flex  gap-2",children:[(0,l.jsx)("span",{className:"text-slate-400",children:"\xb7"}),(0,l.jsx)("h3",{className:"text-slate-500",children:null==d?void 0:d.name})]}),m&&(0,l.jsxs)("div",{className:"hidden md:flex  gap-2",children:[(0,l.jsx)("span",{className:"text-slate-400",children:"\xb7"}),(0,l.jsx)("span",{className:"rounded-full text-xs font-medium bg-green-100 py-1 px-2 text-green-600",children:(null==d?void 0:d.isPublic)?"Public":"Private"})]}),o&&(0,l.jsxs)("div",{className:"hidden lg:flex gap-2",children:[(0,l.jsx)("span",{className:"text-slate-400",children:"\xb7"}),(0,l.jsxs)("h3",{className:"text-slate-500",children:["Owned by ",null==o?void 0:null===(t=o.user_metadata)||void 0===t?void 0:t.userName," ",v&&(0,l.jsx)(l.Fragment,{children:"(You)"})]})]}),h?(0,l.jsxs)("div",{className:"hidden md:flex  gap-2",children:[(0,l.jsx)("span",{className:"text-slate-400",children:"\xb7"}),(0,l.jsxs)("h3",{className:"text-slate-500",children:[h," participants"]})]}):null,!c&&a&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("span",{className:"text-slate-400",children:"\xb7"}),(0,l.jsxs)("h3",{className:"text-slate-500",children:["Welcome back @",null==a?void 0:null===(r=a.user)||void 0===r?void 0:null===(s=r.user_metadata)||void 0===s?void 0:s.userName]})]})]}),(0,l.jsxs)("section",{className:"flex items-center gap-2",children:[c&&(0,l.jsxs)("a",{href:"/",target:"_blank",className:"flex items-center font-semibold text-sm px-2.5 py-2 rounded-full gap-1 bg-blue-600 text-white hover:bg-blue-500",children:[(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-5 h-5",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M13.5 6H5.25A2.25 2.25 0 003 8.25v10.5A2.25 2.25 0 005.25 21h10.5A2.25 2.25 0 0018 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"})}),(0,l.jsx)("span",{children:"Dashboard"})]}),(0,l.jsx)("div",{className:"h-10 w-10 overflow-hidden rounded-full",style:{background:null==a?void 0:null===(i=a.user)||void 0===i?void 0:null===(n=i.user_metadata)||void 0===n?void 0:n.userColor}})]})]})})}},44239:function(e,t,s){"use strict";s.d(t,{O:function(){return n},c:function(){return i}});var l=s(67733);let r="https://ybxbwpwzpqtkqzytfjol.supabase.co",n=(0,l.eI)(r,"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlieGJ3cHd6cHF0a3F6eXRmam9sIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MDc3NDM0MzYsImV4cCI6MjAyMzMxOTQzNn0.JrNuycBKUf7-vMglBmuCY9kfSM8kwtMkIxibuonEAWE"),i=(0,l.eI)(r,"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlieGJ3cHd6cHF0a3F6eXRmam9sIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTcwNzc0MzQzNiwiZXhwIjoyMDIzMzE5NDM2fQ.PbNJ-I_loVTNYB0ScLrvSh-y4oH2QU_V1glI2CrxsPI",{auth:{autoRefreshToken:!1,persistSession:!1}}).auth.admin},48662:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return y}});var l=s(3827),r=s(64090),n=s(69767),i=s(47907),a=s(46201),o=s(13141);let c=["#000000","#FF0000","#00FF00","#0000FF","#FFFF00"],d=[{size:1,height:10,width:10},{size:2,height:15,width:15},{size:5,height:20,width:20},{size:10,height:25,width:25},{size:15,height:30,width:30},{size:20,height:35,width:35},{size:50,height:40,width:40}];var u=e=>{let{drawingPen:t,setDrawingPen:s}=e,[n,i]=(0,r.useState)(!1),[a,o]=(0,r.useState)("");return(0,l.jsxs)("div",{className:"fixed z-10 bottom-0 border-t mx-auto w-full justify-center items-center flex xl:w-auto xl:relative xl:flex-col gap-10 xl:justify-start bg-white xl:rounded-sm p-4",children:[(0,l.jsxs)("div",{className:"xl:flex flex-col max-w-[100px] gap-10  bg-white rounded-lg",children:[(0,l.jsx)("div",{className:"cursor-pointer flex items-center justify-center h-10 w-10 rounded-full border border-slate-400 opacity-90",style:{background:t.color},children:(0,l.jsx)("input",{type:"color",value:t.color,onChange:e=>{s(t=>({...t,color:e.target.value}))},className:"appearance-none bg-transparent opacity-90 cursor-pointer border-none h-10 w-10 [&::-webkit-color-swatch]:rounded-full [&::-webkit-color-swatch]:border-none"})}),c.map(e=>(0,l.jsx)("div",{className:"hidden xl:flex cursor-pointer h-10 w-10 rounded-full border border-slate-400 opacity-90",style:{background:e},onClick:()=>{s(t=>({...t,color:e}))}},e))]}),(0,l.jsxs)("div",{className:"relative group",children:[(0,l.jsx)("div",{className:"cursor-pointer rounded-full border border-slate-400 text-slate-800 opacity-90 h-10 w-10 flex items-center justify-center group-hover:bg-slate-300",children:(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.53 16.122a3 3 0 00-5.78 1.128 2.25 2.25 0 01-2.4 2.245 4.5 4.5 0 008.4-2.245c0-.399-.078-.78-.22-1.128zm0 0a15.998 15.998 0 003.388-1.62m-5.043-.025a15.994 15.994 0 011.622-3.395m3.42 3.42a15.995 15.995 0 004.764-4.648l3.876-5.814a1.151 1.151 0 00-1.597-1.597L14.146 6.32a15.996 15.996 0 00-4.649 4.763m3.42 3.42a6.776 6.776 0 00-3.42-3.42"})})}),(0,l.jsx)("div",{className:"hidden absolute z-10 bottom-10 p-3 rounded-lg border bg-slate-700 justify-center gap-2.5 items-center group-hover:flex flex-col",children:d.map(e=>{let{size:r,width:n,height:i}=e;return(0,l.jsxs)("div",{className:"flex gap-2 items-center text-slate-200 justify-start",children:[(0,l.jsx)("span",{className:"text-xs",children:r}),(0,l.jsx)("div",{className:"cursor-pointer rounded-full border border-slate-200 opacity-90",style:{width:n,height:i,background:t.size===r?t.color:"transparent"},onClick:()=>{s(e=>({...e,size:Number(r)}))}})]},r)})})]}),(0,l.jsx)("div",{className:"cursor-pointer rounded-full border border-slate-400 text-slate-800 opacity-90 h-10 w-10 flex items-center justify-center",style:{background:n?"#cbd5e1":"transparent"},onClick:()=>{n?(s(e=>({...e,color:a})),i(!1)):(o(t.color),s(e=>({...e,color:"#ffffff"})),i(!0))},children:(0,l.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor",className:"w-6 h-6",children:(0,l.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.25 7.5A2.25 2.25 0 017.5 5.25h9a2.25 2.25 0 012.25 2.25v9a2.25 2.25 0 01-2.25 2.25h-9a2.25 2.25 0 01-2.25-2.25v-9z"})})})]})},h=s(44239),x=function(e){var t,s,i,o;let{room:c,drawingPen:d}=e,u="cursor",[x,m]=(0,r.useState)(),[v,f]=(0,r.useState)(!1),[p,w]=(0,r.useState)(null),[g,j]=(0,r.useState)(null),b=(0,r.useRef)(null),N=(0,r.useRef)(null),y=(0,r.useRef)([]),I=document.querySelector("#board"),k=async e=>{var t;if(y.current.includes(e)||document.getElementById(e+"-cursor"))return;let s=document.createElement("div"),l=document.createElement("svg");l.innerHTML='\n<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-cursor-fill" viewBox="0 0 16 16">  \n  <path d="M14.082 2.182a.5.5 0 0 1 .103.557L8.528 15.467a.5.5 0 0 1-.917-.007L5.57 10.694.803 8.652a.5.5 0 0 1-.006-.916l12.728-5.657a.5.5 0 0 1 .556.103z"/>\n</svg>\n',s.id=e+"-cursor",s.classList.add("h-4","w-4","absolute","z-50","-scale-x-100");let{user:r}=await (0,n.Mi)(e);s.style.color=null==r?void 0:null===(t=r.user_metadata)||void 0===t?void 0:t.userColor,s.appendChild(l),b&&b.current.appendChild(s),y.current.push(e)},z=e=>{let{payload:t}=e,{userId:s,x:l,y:r}=t||{},n=document.getElementById(s+"-cursor");n?(n.style.left=l+"px",n.style.top=r+"px"):k(s)},C=(e,t,s,l)=>e.send({type:"broadcast",event:u,payload:{userId:t,x:s,y:l}});return(0,r.useEffect)(()=>{var e;null==b||null===(e=b.current)||void 0===e||e.addEventListener("mousemove",e=>{if(v&&p){var t;let s=document.querySelector("#container").getBoundingClientRect(),l=e.clientX-s.left,r=e.clientY-s.top;C(p,null==x?void 0:null===(t=x.user)||void 0===t?void 0:t.id,l,r)}})},[v,p,null==x?void 0:null===(t=x.user)||void 0===t?void 0:t.id]),(0,r.useEffect)(()=>{p&&p.on("broadcast",{event:u},e=>{z(e)}).subscribe()},[p]),(0,r.useEffect)(()=>{if(v&&c.id){let e=h.O;w(e.channel(c.id)),e.channel("any").on("postgres_changes",{event:"*",schema:"public",table:"drawing-rooms"},e=>{j(e.new.drawing)}).subscribe()}},[v,c.id]),(0,r.useEffect)(()=>{(0,n.cw)().then(e=>{var t;(null==e?void 0:null===(t=e.user)||void 0===t?void 0:t.id)?(m(e),f(!0)):f(!1)})},[null==x?void 0:null===(s=x.user)||void 0===s?void 0:s.id,null==x?void 0:null===(o=x.user)||void 0===o?void 0:null===(i=o.user_metadata)||void 0===i?void 0:i.userColor]),(0,r.useEffect)(()=>{c.drawing&&j(c.drawing)},[c.drawing]),(0,r.useEffect)(()=>{if(!I)return;let e=document.querySelector("#sketch"),t=getComputedStyle(e);I.width=parseInt(t.getPropertyValue("width")),I.height=parseInt(t.getPropertyValue("height"));let s={x:0,y:0},l={x:0,y:0},r=()=>{let e=I.getBoundingClientRect();return{left:e.left,top:e.top}},n=I.getContext("2d");if(!n)return;if(n.lineJoin="round",n.lineCap="round",n.lineWidth=d.size,n.strokeStyle=d.color,g){let e=new Image;e.onload=()=>{n.drawImage(e,0,0)},e.src=g}let i=()=>{n.beginPath(),n.moveTo(l.x,l.y),n.lineTo(s.x,s.y),n.closePath(),n.stroke(),null!==N.current&&clearTimeout(N.current),N.current=setTimeout(()=>{let e=I.toDataURL("image/png");(0,a.Dv)(null==c?void 0:c.id,e)},1e3)};I.addEventListener("mousemove",e=>{let t=r();l.x=s.x,l.y=s.y,s.x=e.clientX-t.left,s.y=e.clientY-t.top}),I.addEventListener("mousedown",()=>{I.addEventListener("mousemove",i)}),I.addEventListener("mouseup",()=>{I.removeEventListener("mousemove",i)})},[null==c?void 0:c.id,g,c.drawing,I]),(0,r.useEffect)(()=>{if(!I)return;let e=I.getContext("2d");e&&(e.lineWidth=d.size,e.strokeStyle=d.color)},[d.size,d.color,I]),(0,l.jsx)("div",{className:"my-auto w-full h-full border p-2",children:(0,l.jsx)("div",{className:"w-full h-full relative",id:"sketch",ref:b,children:(0,l.jsx)("div",{id:"container",className:"w-full h-full",children:(0,l.jsx)("canvas",{className:"w-full h-full",id:"board"})})})})},m=e=>{let{room:t}=e,[s,n]=(0,r.useState)({color:"#000000",size:5});return(0,l.jsxs)("section",{className:"relative flex flex-col xl:flex-row gap-1 bg-white h-screen",children:[(0,l.jsx)(u,{drawingPen:s,setDrawingPen:n}),(0,l.jsx)(x,{drawingPen:s,room:t})]})},v=s(62e3),f=()=>(0,l.jsxs)("svg",{className:"animate-spin h-5 w-5 text-white",fill:"none",viewBox:"0 0 24 24",children:[(0,l.jsx)("circle",{className:"opacity-25",cx:12,cy:12,r:10,stroke:"currentColor",strokeWidth:4}),(0,l.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),p=e=>{let{children:t,userData:s,callId:i}=e,[a,o]=(0,r.useState)(null),[c,d]=(0,r.useState)(null),u=async()=>{try{var e,t,l;let{token:r}=await (0,n.Jx)(null==s?void 0:s.id),a={id:null==s?void 0:s.id,name:null==s?void 0:null===(e=s.user_metadata)||void 0===e?void 0:e.userName,image:"https://getstream.io/random_svg/?id=".concat(null==s?void 0:null===(t=s.user_metadata)||void 0===t?void 0:t.userName,"&name=").concat(null==s?void 0:null===(l=s.user_metadata)||void 0===l?void 0:l.userName)},c=new v.GRk({apiKey:"cvjb9mxeqrhj",user:a,token:r});o(c);let u=c.call("development",i);u.join({create:!0}),d(u)}catch(e){console.log(e)}};return((0,r.useEffect)(()=>{s&&u()},[s]),a&&c)?(0,l.jsx)(v.hbc,{client:a,children:(0,l.jsx)(v.N_D,{call:c,children:t})}):(0,l.jsx)("div",{className:"mt-2 h-32 flex justify-center items-center",children:(0,l.jsx)(f,{})})};let w=()=>(0,l.jsx)("div",{className:"absolute inset-0 bg-slate-700 z-[1] text-center text-slate-300 flex items-center justify-center",children:(0,l.jsx)(f,{})});var g=e=>{let{participant:t}=e;return(0,l.jsx)("div",{className:"relative h-32 w-32 xl:w-full",children:(0,l.jsx)(v.xbF,{participant:t,VideoPlaceholder:w})})};let j=e=>{let{participant:t}=e;return(0,l.jsxs)("div",{className:"absolute inset-0 bg-slate-700 z-[1] text-center text-slate-300 flex items-center justify-center",children:[(0,l.jsxs)("div",{className:"hidden xl:flex items-center justify-center",children:[(0,l.jsx)("span",{className:"capitalize",children:t.name}),(0,l.jsx)("p",{className:"lowercase ml-1",children:" is joining"})]}),(0,l.jsx)("div",{className:"xl:hidden",children:(0,l.jsx)(f,{})})]})};var b=e=>{let{participants:t}=e;return(0,l.jsx)("div",{className:"relative h-32 w-32 xl:w-full",children:t.map(e=>(0,l.jsx)(v.xbF,{participant:e,VideoPlaceholder:j},e.sessionId))})},N=e=>{let{useCallCallingState:t,useParticipantCount:s,useLocalParticipant:n,useRemoteParticipants:i}=(0,v.dvl)(),a=t(),o=n(),c=i(),d=s();return((0,r.useEffect)(()=>{e.setParticipantCount(d)},[d,e]),a!==v.Uq0.JOINED)?(0,l.jsx)("div",{className:"mt-2 h-32 w-full flex justify-center items-center",children:(0,l.jsx)(f,{})}):(0,l.jsx)(v.c3T,{children:(0,l.jsxs)("div",{className:"grid grid-cols-2 xl:grid-cols-1 gap-10 xl:gap-4 text-white capitalize",children:[(0,l.jsx)(g,{participant:o}),(0,l.jsx)(b,{participants:c})]})})},y=()=>{let{roomId:e}=(0,i.useParams)(),[t,s]=(0,r.useState)(null),[c,d]=(0,r.useState)([]),[u,h]=(0,r.useState)({}),[x,v]=(0,r.useState)(),[f,w]=(0,r.useState)(!0),[g,j]=(0,r.useState)(0);return(0,r.useEffect)(()=>{(0,n.cw)().then(t=>{v(t),h(null==t?void 0:t.user),(0,a.rc)(e).then(e=>{var l;if(!(e[0].isPublic||e[0].owner===(null==t?void 0:null===(l=t.user)||void 0===l?void 0:l.id)))return window.location.href="/";d(e[0]),w(!1),(0,n.Mi)(e[0].owner).then(e=>{"user"in e?s(e.user):console.log(e)})})})},[]),(0,l.jsxs)("main",{children:[(0,l.jsx)(o.Z,{session:x,owner:t,room:c,isRoom:!0,isLoadingRoom:f,participantCount:g}),(0,l.jsx)("div",{className:"relative w-full h-full",style:{background:"linear-gradient(45deg, #03A9F4, #4CAF50)"},children:f?(0,l.jsx)("div",{className:"flex justify-center items-center h-screen text-white",children:(0,l.jsx)("p",{children:"One moment. Please..."})}):(0,l.jsxs)("div",{className:"w-full flex flex-col-reverse xl:flex-row",children:[(0,l.jsx)(m,{room:c}),(0,l.jsx)("section",{className:"min-w-[15rem] max-w-[15rem] xl:min-h-0 relative mx-auto flex items-center xl:flex-col gap-3 text-white",children:(0,l.jsx)(p,{userData:u,callId:null==c?void 0:c.id,children:(0,l.jsx)(N,{setParticipantCount:j})})})]})})]})}},46201:function(e,t,s){"use strict";s.d(t,{Dv:function(){return o},f6:function(){return n},fz:function(){return i},rc:function(){return a}});var l=s(44239);let r="drawing-rooms",n=async(e,t,s)=>{let{data:n,error:i}=await l.O.from(r).insert({name:e,owner:t,isPublic:s,isPasswordProtected:!1,password:null,created_at:new Date().toISOString()}).select();return i||n},i=async e=>{let{data:t}=await l.O.from(r).select().eq("owner",e).order("created_at",{ascending:!1});return t},a=async e=>{let{data:t,error:s}=await l.O.from(r).select().eq("id",e);return s||t},o=async(e,t)=>{await l.O.from(r).update({drawing:t}).eq("id",e).select()}},69767:function(e,t,s){"use strict";s.d(t,{Jx:function(){return i},Mi:function(){return n},cw:function(){return r}});var l=s(44239);let r=async()=>{let{data:e,error:t}=await l.O.auth.getSession();return e.session},n=async e=>{let{data:t}=await l.c.getUserById(e);return t},i=async e=>{let t=await fetch("/api/generate-user-video-instance",{method:"POST",body:JSON.stringify({userId:e})});return await t.json()}}},function(e){e.O(0,[501,463,733,616,971,69,744],function(){return e(e.s=28633)}),_N_E=e.O()}]);